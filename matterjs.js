/*! For license information please see matterjs.js.LICENSE.txt */
(()=>{var t={4035:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var o=i(7537),r=i.n(o),n=i(3645),s=i.n(n)()(r());s.push([t.id,"body {\n    background-color: #000;\n}\n","",{version:3,sources:["webpack://./src/default-style.css"],names:[],mappings:"AAAA;IACI,sBAAsB;AAC1B",sourcesContent:["body {\n    background-color: #000;\n}\n"],sourceRoot:""}]);const a=s},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",o=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),o&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),o&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,o,r,n){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(s[h]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);o&&s[l[0]]||(void 0!==n&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=n),i&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=i):l[2]=i),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),e.push(l))}},e}},7537:t=>{"use strict";t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),n="/*# ".concat(r," */");return[e].concat([n]).join("\n")}return[e].join("\n")}},9842:function(t,e,i){var o;o=function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e){var o={};t.exports=o,function(){o._baseDelta=1e3/60,o._nextId=0,o._seed=0,o._nowStartTime=+new Date,o._warnedOnce={},o._decomp=null,o.extend=function(t,e){var i,r;"boolean"==typeof e?(i=2,r=e):(i=1,r=!0);for(var n=i;n<arguments.length;n++){var s=arguments[n];if(s)for(var a in s)r&&s[a]&&s[a].constructor===Object?t[a]&&t[a].constructor!==Object?t[a]=s[a]:(t[a]=t[a]||{},o.extend(t[a],r,s[a])):t[a]=s[a]}return t},o.clone=function(t,e){return o.extend({},e,t)},o.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)e.push(i);return e},o.values=function(t){var e=[];if(Object.keys){for(var i=Object.keys(t),o=0;o<i.length;o++)e.push(t[i[o]]);return e}for(var r in t)e.push(t[r]);return e},o.get=function(t,e,i,o){e=e.split(".").slice(i,o);for(var r=0;r<e.length;r+=1)t=t[e[r]];return t},o.set=function(t,e,i,r,n){var s=e.split(".").slice(r,n);return o.get(t,e,0,-1)[s[s.length-1]]=i,i},o.shuffle=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(o.random()*(e+1)),r=t[e];t[e]=t[i],t[i]=r}return t},o.choose=function(t){return t[Math.floor(o.random()*t.length)]},o.isElement=function(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},o.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o.isFunction=function(t){return"function"==typeof t},o.isPlainObject=function(t){return"object"==typeof t&&t.constructor===Object},o.isString=function(t){return"[object String]"===toString.call(t)},o.clamp=function(t,e,i){return t<e?e:t>i?i:t},o.sign=function(t){return t<0?-1:1},o.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-o._nowStartTime},o.random=function(e,i){return i=void 0!==i?i:1,(e=void 0!==e?e:0)+t()*(i-e)};var t=function(){return o._seed=(9301*o._seed+49297)%233280,o._seed/233280};o.colorToNumber=function(t){return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},o.logLevel=1,o.log=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.info=function(){console&&o.logLevel>0&&o.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.warn=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.warnOnce=function(){var t=Array.prototype.slice.call(arguments).join(" ");o._warnedOnce[t]||(o.warn(t),o._warnedOnce[t]=!0)},o.deprecated=function(t,e,i){t[e]=o.chain((function(){o.warnOnce("🔅 deprecated 🔅",i)}),t[e])},o.nextId=function(){return o._nextId++},o.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},o.map=function(t,e){if(t.map)return t.map(e);for(var i=[],o=0;o<t.length;o+=1)i.push(e(t[o]));return i},o.topologicalSort=function(t){var e=[],i=[],r=[];for(var n in t)i[n]||r[n]||o._topologicalSort(n,i,r,t,e);return e},o._topologicalSort=function(t,e,i,r,n){var s=r[t]||[];i[t]=!0;for(var a=0;a<s.length;a+=1){var h=s[a];i[h]||e[h]||o._topologicalSort(h,e,i,r,n)}i[t]=!1,e[t]=!0,n.push(t)},o.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var i=arguments[e];i._chained?t.push.apply(t,i._chained):t.push(i)}var o=function(){for(var e,i=new Array(arguments.length),o=0,r=arguments.length;o<r;o++)i[o]=arguments[o];for(o=0;o<t.length;o+=1){var n=t[o].apply(e,i);void 0!==n&&(e=n)}return e};return o._chained=t,o},o.chainPathBefore=function(t,e,i){return o.set(t,e,o.chain(i,o.get(t,e)))},o.chainPathAfter=function(t,e,i){return o.set(t,e,o.chain(o.get(t,e),i))},o.setDecomp=function(t){o._decomp=t},o.getDecomp=function(){var t=o._decomp;try{t||"undefined"==typeof window||(t=window.decomp),t||void 0===i.g||(t=i.g.decomp)}catch(e){t=null}return t}}()},function(t,e){var i={};t.exports=i,i.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(e,t),e},i.update=function(t,e,i){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var o=0;o<e.length;o++){var r=e[o];r.x>t.max.x&&(t.max.x=r.x),r.x<t.min.x&&(t.min.x=r.x),r.y>t.max.y&&(t.max.y=r.y),r.y<t.min.y&&(t.min.y=r.y)}i&&(i.x>0?t.max.x+=i.x:t.min.x+=i.x,i.y>0?t.max.y+=i.y:t.min.y+=i.y)},i.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},i.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},i.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},i.shift=function(t,e){var i=t.max.x-t.min.x,o=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+i,t.min.y=e.y,t.max.y=e.y+o}},function(t,e){var i={};t.exports=i,i.create=function(t,e){return{x:t||0,y:e||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,e,i){var o=Math.cos(e),r=Math.sin(e);i||(i={});var n=t.x*o-t.y*r;return i.y=t.x*r+t.y*o,i.x=n,i},i.rotateAbout=function(t,e,i,o){var r=Math.cos(e),n=Math.sin(e);o||(o={});var s=i.x+((t.x-i.x)*r-(t.y-i.y)*n);return o.y=i.y+((t.x-i.x)*n+(t.y-i.y)*r),o.x=s,o},i.normalise=function(t){var e=i.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},i.cross3=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},i.add=function(t,e,i){return i||(i={}),i.x=t.x+e.x,i.y=t.y+e.y,i},i.sub=function(t,e,i){return i||(i={}),i.x=t.x-e.x,i.y=t.y-e.y,i},i.mult=function(t,e){return{x:t.x*e,y:t.y*e}},i.div=function(t,e){return{x:t.x/e,y:t.y/e}},i.perp=function(t,e){return{x:(e=!0===e?-1:1)*-t.y,y:e*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]},function(t,e,i){var o={};t.exports=o;var r=i(2),n=i(0);o.create=function(t,e){for(var i=[],o=0;o<t.length;o++){var r=t[o],n={x:r.x,y:r.y,index:o,body:e,isInternal:!1};i.push(n)}return i},o.fromPath=function(t,e){var i=[];return t.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(t,e,o){i.push({x:parseFloat(e),y:parseFloat(o)})})),o.create(i,e)},o.centre=function(t){for(var e,i,n,s=o.area(t,!0),a={x:0,y:0},h=0;h<t.length;h++)n=(h+1)%t.length,e=r.cross(t[h],t[n]),i=r.mult(r.add(t[h],t[n]),e),a=r.add(a,i);return r.div(a,6*s)},o.mean=function(t){for(var e={x:0,y:0},i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y;return r.div(e,t.length)},o.area=function(t,e){for(var i=0,o=t.length-1,r=0;r<t.length;r++)i+=(t[o].x-t[r].x)*(t[o].y+t[r].y),o=r;return e?i/2:Math.abs(i)/2},o.inertia=function(t,e){for(var i,o,n=0,s=0,a=t,h=0;h<a.length;h++)o=(h+1)%a.length,n+=(i=Math.abs(r.cross(a[o],a[h])))*(r.dot(a[o],a[o])+r.dot(a[o],a[h])+r.dot(a[h],a[h])),s+=i;return e/6*(n/s)},o.translate=function(t,e,i){i=void 0!==i?i:1;var o,r=t.length,n=e.x*i,s=e.y*i;for(o=0;o<r;o++)t[o].x+=n,t[o].y+=s;return t},o.rotate=function(t,e,i){if(0!==e){var o,r,n,s,a=Math.cos(e),h=Math.sin(e),c=i.x,l=i.y,u=t.length;for(s=0;s<u;s++)r=(o=t[s]).x-c,n=o.y-l,o.x=c+(r*a-n*h),o.y=l+(r*h+n*a);return t}},o.contains=function(t,e){for(var i,o=e.x,r=e.y,n=t.length,s=t[n-1],a=0;a<n;a++){if(i=t[a],(o-s.x)*(i.y-s.y)+(r-s.y)*(s.x-i.x)>0)return!1;s=i}return!0},o.scale=function(t,e,i,n){if(1===e&&1===i)return t;var s,a;n=n||o.centre(t);for(var h=0;h<t.length;h++)s=t[h],a=r.sub(s,n),t[h].x=n.x+a.x*e,t[h].y=n.y+a.y*i;return t},o.chamfer=function(t,e,i,o,s){e="number"==typeof e?[e]:e||[8],i=void 0!==i?i:-1,o=o||2,s=s||14;for(var a=[],h=0;h<t.length;h++){var c=t[h-1>=0?h-1:t.length-1],l=t[h],u=t[(h+1)%t.length],m=e[h<e.length?h:e.length-1];if(0!==m){var d=r.normalise({x:l.y-c.y,y:c.x-l.x}),p=r.normalise({x:u.y-l.y,y:l.x-u.x}),f=Math.sqrt(2*Math.pow(m,2)),x=r.mult(n.clone(d),m),y=r.normalise(r.mult(r.add(d,p),.5)),g=r.sub(l,r.mult(y,f)),v=i;-1===i&&(v=1.75*Math.pow(m,.32)),(v=n.clamp(v,o,s))%2==1&&(v+=1);for(var b=Math.acos(r.dot(d,p))/v,w=0;w<v;w++)a.push(r.add(r.rotate(x,b*w),g))}else a.push(l)}return a},o.clockwiseSort=function(t){var e=o.mean(t);return t.sort((function(t,i){return r.angle(e,t)-r.angle(e,i)})),t},o.isConvex=function(t){var e,i,o,r,n=0,s=t.length;if(s<3)return null;for(e=0;e<s;e++)if(o=(e+2)%s,r=(t[i=(e+1)%s].x-t[e].x)*(t[o].y-t[i].y),(r-=(t[i].y-t[e].y)*(t[o].x-t[i].x))<0?n|=1:r>0&&(n|=2),3===n)return!1;return 0!==n||null},o.hull=function(t){var e,i,o=[],n=[];for((t=t.slice(0)).sort((function(t,e){var i=t.x-e.x;return 0!==i?i:t.y-e.y})),i=0;i<t.length;i+=1){for(e=t[i];n.length>=2&&r.cross3(n[n.length-2],n[n.length-1],e)<=0;)n.pop();n.push(e)}for(i=t.length-1;i>=0;i-=1){for(e=t[i];o.length>=2&&r.cross3(o[o.length-2],o[o.length-1],e)<=0;)o.pop();o.push(e)}return o.pop(),n.pop(),o.concat(n)}},function(t,e,i){var o={};t.exports=o;var r=i(3),n=i(2),s=i(7),a=i(0),h=i(1),c=i(11);!function(){o._timeCorrection=!0,o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o._baseDelta=1e3/60,o.create=function(e){var i={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:1e3/60,_original:null},o=a.extend(i,e);return t(o,e),o},o.nextGroup=function(t){return t?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var t=function(t,e){e=e||{},o.set(t,{bounds:t.bounds||h.create(t.vertices),positionPrev:t.positionPrev||n.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),c.rotate(t.axes,t.angle),h.update(t.bounds,t.vertices,t.velocity),o.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var i=t.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),s=t.isStatic?"#555":"#ccc",l=t.isStatic&&null===t.render.fillStyle?1:0;t.render.fillStyle=t.render.fillStyle||i,t.render.strokeStyle=t.render.strokeStyle||s,t.render.lineWidth=t.render.lineWidth||l,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};o.set=function(t,e,i){var r;for(r in"string"==typeof e&&(r=e,(e={})[r]=i),e)if(Object.prototype.hasOwnProperty.call(e,r))switch(i=e[r],r){case"isStatic":o.setStatic(t,i);break;case"isSleeping":s.set(t,i);break;case"mass":o.setMass(t,i);break;case"density":o.setDensity(t,i);break;case"inertia":o.setInertia(t,i);break;case"vertices":o.setVertices(t,i);break;case"position":o.setPosition(t,i);break;case"angle":o.setAngle(t,i);break;case"velocity":o.setVelocity(t,i);break;case"angularVelocity":o.setAngularVelocity(t,i);break;case"speed":o.setSpeed(t,i);break;case"angularSpeed":o.setAngularSpeed(t,i);break;case"parts":o.setParts(t,i);break;case"centre":o.setCentre(t,i);break;default:t[r]=i}},o.setStatic=function(t,e){for(var i=0;i<t.parts.length;i++){var o=t.parts[i];e?(o.isStatic||(o._original={restitution:o.restitution,friction:o.friction,mass:o.mass,inertia:o.inertia,density:o.density,inverseMass:o.inverseMass,inverseInertia:o.inverseInertia}),o.restitution=0,o.friction=1,o.mass=o.inertia=o.density=1/0,o.inverseMass=o.inverseInertia=0,o.positionPrev.x=o.position.x,o.positionPrev.y=o.position.y,o.anglePrev=o.angle,o.angularVelocity=0,o.speed=0,o.angularSpeed=0,o.motion=0):o._original&&(o.restitution=o._original.restitution,o.friction=o._original.friction,o.mass=o._original.mass,o.inertia=o._original.inertia,o.density=o._original.density,o.inverseMass=o._original.inverseMass,o.inverseInertia=o._original.inverseInertia,o._original=null),o.isStatic=e}},o.setMass=function(t,e){var i=t.inertia/(t.mass/6);t.inertia=i*(e/6),t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},o.setDensity=function(t,e){o.setMass(t,e*t.area),t.density=e},o.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},o.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=r.create(e,t),t.axes=c.fromVertices(t.vertices),t.area=r.area(t.vertices),o.setMass(t,t.density*t.area);var i=r.centre(t.vertices);r.translate(t.vertices,i,-1),o.setInertia(t,o._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),h.update(t.bounds,t.vertices,t.velocity)},o.setParts=function(t,e,i){var n;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,n=0;n<e.length;n++){var s=e[n];s!==t&&(s.parent=t,t.parts.push(s))}if(1!==t.parts.length){if(i=void 0===i||i){var a=[];for(n=0;n<e.length;n++)a=a.concat(e[n].vertices);r.clockwiseSort(a);var h=r.hull(a),c=r.centre(h);o.setVertices(t,h),r.translate(t.vertices,c)}var l=o._totalProperties(t);t.area=l.area,t.parent=t,t.position.x=l.centre.x,t.position.y=l.centre.y,t.positionPrev.x=l.centre.x,t.positionPrev.y=l.centre.y,o.setMass(t,l.mass),o.setInertia(t,l.inertia),o.setPosition(t,l.centre)}},o.setCentre=function(t,e,i){i?(t.positionPrev.x+=e.x,t.positionPrev.y+=e.y,t.position.x+=e.x,t.position.y+=e.y):(t.positionPrev.x=e.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=e.y-(t.position.y-t.positionPrev.y),t.position.x=e.x,t.position.y=e.y)},o.setPosition=function(t,e,i){var o=n.sub(e,t.position);i?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=o.x,t.velocity.y=o.y,t.speed=n.magnitude(o)):(t.positionPrev.x+=o.x,t.positionPrev.y+=o.y);for(var s=0;s<t.parts.length;s++){var a=t.parts[s];a.position.x+=o.x,a.position.y+=o.y,r.translate(a.vertices,o),h.update(a.bounds,a.vertices,t.velocity)}},o.setAngle=function(t,e,i){var o=e-t.angle;i?(t.anglePrev=t.angle,t.angularVelocity=o,t.angularSpeed=Math.abs(o)):t.anglePrev+=o;for(var s=0;s<t.parts.length;s++){var a=t.parts[s];a.angle+=o,r.rotate(a.vertices,o,t.position),c.rotate(a.axes,o),h.update(a.bounds,a.vertices,t.velocity),s>0&&n.rotateAbout(a.position,o,t.position,a.position)}},o.setVelocity=function(t,e){var i=t.deltaTime/o._baseDelta;t.positionPrev.x=t.position.x-e.x*i,t.positionPrev.y=t.position.y-e.y*i,t.velocity.x=(t.position.x-t.positionPrev.x)/i,t.velocity.y=(t.position.y-t.positionPrev.y)/i,t.speed=n.magnitude(t.velocity)},o.getVelocity=function(t){var e=o._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*e,y:(t.position.y-t.positionPrev.y)*e}},o.getSpeed=function(t){return n.magnitude(o.getVelocity(t))},o.setSpeed=function(t,e){o.setVelocity(t,n.mult(n.normalise(o.getVelocity(t)),e))},o.setAngularVelocity=function(t,e){var i=t.deltaTime/o._baseDelta;t.anglePrev=t.angle-e*i,t.angularVelocity=(t.angle-t.anglePrev)/i,t.angularSpeed=Math.abs(t.angularVelocity)},o.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*o._baseDelta/t.deltaTime},o.getAngularSpeed=function(t){return Math.abs(o.getAngularVelocity(t))},o.setAngularSpeed=function(t,e){o.setAngularVelocity(t,a.sign(o.getAngularVelocity(t))*e)},o.translate=function(t,e,i){o.setPosition(t,n.add(t.position,e),i)},o.rotate=function(t,e,i,r){if(i){var n=Math.cos(e),s=Math.sin(e),a=t.position.x-i.x,h=t.position.y-i.y;o.setPosition(t,{x:i.x+(a*n-h*s),y:i.y+(a*s+h*n)},r),o.setAngle(t,t.angle+e,r)}else o.setAngle(t,t.angle+e,r)},o.scale=function(t,e,i,n){var s=0,a=0;n=n||t.position;for(var l=0;l<t.parts.length;l++){var u=t.parts[l];r.scale(u.vertices,e,i,n),u.axes=c.fromVertices(u.vertices),u.area=r.area(u.vertices),o.setMass(u,t.density*u.area),r.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),o.setInertia(u,o._inertiaScale*r.inertia(u.vertices,u.mass)),r.translate(u.vertices,{x:u.position.x,y:u.position.y}),l>0&&(s+=u.area,a+=u.inertia),u.position.x=n.x+(u.position.x-n.x)*e,u.position.y=n.y+(u.position.y-n.y)*i,h.update(u.bounds,u.vertices,t.velocity)}t.parts.length>1&&(t.area=s,t.isStatic||(o.setMass(t,t.density*s),o.setInertia(t,a))),t.circleRadius&&(e===i?t.circleRadius*=e:t.circleRadius=null)},o.update=function(t,e){var i=(e=(void 0!==e?e:1e3/60)*t.timeScale)*e,s=o._timeCorrection?e/(t.deltaTime||e):1,l=1-t.frictionAir*(e/a._baseDelta),u=(t.position.x-t.positionPrev.x)*s,m=(t.position.y-t.positionPrev.y)*s;t.velocity.x=u*l+t.force.x/t.mass*i,t.velocity.y=m*l+t.force.y/t.mass*i,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=e,t.angularVelocity=(t.angle-t.anglePrev)*l*s+t.torque/t.inertia*i,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var d=0;d<t.parts.length;d++){var p=t.parts[d];r.translate(p.vertices,t.velocity),d>0&&(p.position.x+=t.velocity.x,p.position.y+=t.velocity.y),0!==t.angularVelocity&&(r.rotate(p.vertices,t.angularVelocity,t.position),c.rotate(p.axes,t.angularVelocity),d>0&&n.rotateAbout(p.position,t.angularVelocity,t.position,p.position)),h.update(p.bounds,p.vertices,t.velocity)}},o.updateVelocities=function(t){var e=o._baseDelta/t.deltaTime,i=t.velocity;i.x=(t.position.x-t.positionPrev.x)*e,i.y=(t.position.y-t.positionPrev.y)*e,t.speed=Math.sqrt(i.x*i.x+i.y*i.y),t.angularVelocity=(t.angle-t.anglePrev)*e,t.angularSpeed=Math.abs(t.angularVelocity)},o.applyForce=function(t,e,i){var o=e.x-t.position.x,r=e.y-t.position.y;t.force.x+=i.x,t.force.y+=i.y,t.torque+=o*i.y-r*i.x},o._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},i=1===t.parts.length?0:1;i<t.parts.length;i++){var o=t.parts[i],r=o.mass!==1/0?o.mass:1;e.mass+=r,e.area+=o.area,e.inertia+=o.inertia,e.centre=n.add(e.centre,n.mult(o.position,r))}return e.centre=n.div(e.centre,e.mass),e}}()},function(t,e,i){var o={};t.exports=o;var r=i(0);o.on=function(t,e,i){for(var o,r=e.split(" "),n=0;n<r.length;n++)o=r[n],t.events=t.events||{},t.events[o]=t.events[o]||[],t.events[o].push(i);return i},o.off=function(t,e,i){if(e){"function"==typeof e&&(i=e,e=r.keys(t.events).join(" "));for(var o=e.split(" "),n=0;n<o.length;n++){var s=t.events[o[n]],a=[];if(i&&s)for(var h=0;h<s.length;h++)s[h]!==i&&a.push(s[h]);t.events[o[n]]=a}}else t.events={}},o.trigger=function(t,e,i){var o,n,s,a,h=t.events;if(h&&r.keys(h).length>0){i||(i={}),o=e.split(" ");for(var c=0;c<o.length;c++)if(s=h[n=o[c]]){(a=r.clone(i,!1)).name=n,a.source=t;for(var l=0;l<s.length;l++)s[l].apply(t,[a])}}}},function(t,e,i){var o={};t.exports=o;var r=i(5),n=i(0),s=i(1),a=i(4);o.create=function(t){return n.extend({id:n.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},t)},o.setModified=function(t,e,i,r){if(t.isModified=e,e&&t.cache&&(t.cache.allBodies=null,t.cache.allConstraints=null,t.cache.allComposites=null),i&&t.parent&&o.setModified(t.parent,e,i,r),r)for(var n=0;n<t.composites.length;n++){var s=t.composites[n];o.setModified(s,e,i,r)}},o.add=function(t,e){var i=[].concat(e);r.trigger(t,"beforeAdd",{object:e});for(var s=0;s<i.length;s++){var a=i[s];switch(a.type){case"body":if(a.parent!==a){n.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(t,a);break;case"constraint":o.addConstraint(t,a);break;case"composite":o.addComposite(t,a);break;case"mouseConstraint":o.addConstraint(t,a.constraint)}}return r.trigger(t,"afterAdd",{object:e}),t},o.remove=function(t,e,i){var n=[].concat(e);r.trigger(t,"beforeRemove",{object:e});for(var s=0;s<n.length;s++){var a=n[s];switch(a.type){case"body":o.removeBody(t,a,i);break;case"constraint":o.removeConstraint(t,a,i);break;case"composite":o.removeComposite(t,a,i);break;case"mouseConstraint":o.removeConstraint(t,a.constraint)}}return r.trigger(t,"afterRemove",{object:e}),t},o.addComposite=function(t,e){return t.composites.push(e),e.parent=t,o.setModified(t,!0,!0,!1),t},o.removeComposite=function(t,e,i){var r=n.indexOf(t.composites,e);if(-1!==r){var s=o.allBodies(e);o.removeCompositeAt(t,r);for(var a=0;a<s.length;a++)s[a].sleepCounter=0}if(i)for(a=0;a<t.composites.length;a++)o.removeComposite(t.composites[a],e,!0);return t},o.removeCompositeAt=function(t,e){return t.composites.splice(e,1),o.setModified(t,!0,!0,!1),t},o.addBody=function(t,e){return t.bodies.push(e),o.setModified(t,!0,!0,!1),t},o.removeBody=function(t,e,i){var r=n.indexOf(t.bodies,e);if(-1!==r&&(o.removeBodyAt(t,r),e.sleepCounter=0),i)for(var s=0;s<t.composites.length;s++)o.removeBody(t.composites[s],e,!0);return t},o.removeBodyAt=function(t,e){return t.bodies.splice(e,1),o.setModified(t,!0,!0,!1),t},o.addConstraint=function(t,e){return t.constraints.push(e),o.setModified(t,!0,!0,!1),t},o.removeConstraint=function(t,e,i){var r=n.indexOf(t.constraints,e);if(-1!==r&&o.removeConstraintAt(t,r),i)for(var s=0;s<t.composites.length;s++)o.removeConstraint(t.composites[s],e,!0);return t},o.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),o.setModified(t,!0,!0,!1),t},o.clear=function(t,e,i){if(i)for(var r=0;r<t.composites.length;r++)o.clear(t.composites[r],e,!0);return e?t.bodies=t.bodies.filter((function(t){return t.isStatic})):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,o.setModified(t,!0,!0,!1),t},o.allBodies=function(t){if(t.cache&&t.cache.allBodies)return t.cache.allBodies;for(var e=[].concat(t.bodies),i=0;i<t.composites.length;i++)e=e.concat(o.allBodies(t.composites[i]));return t.cache&&(t.cache.allBodies=e),e},o.allConstraints=function(t){if(t.cache&&t.cache.allConstraints)return t.cache.allConstraints;for(var e=[].concat(t.constraints),i=0;i<t.composites.length;i++)e=e.concat(o.allConstraints(t.composites[i]));return t.cache&&(t.cache.allConstraints=e),e},o.allComposites=function(t){if(t.cache&&t.cache.allComposites)return t.cache.allComposites;for(var e=[].concat(t.composites),i=0;i<t.composites.length;i++)e=e.concat(o.allComposites(t.composites[i]));return t.cache&&(t.cache.allComposites=e),e},o.get=function(t,e,i){var r,n;switch(i){case"body":r=o.allBodies(t);break;case"constraint":r=o.allConstraints(t);break;case"composite":r=o.allComposites(t).concat(t)}return r?0===(n=r.filter((function(t){return t.id.toString()===e.toString()}))).length?null:n[0]:null},o.move=function(t,e,i){return o.remove(t,e),o.add(i,e),t},o.rebase=function(t){for(var e=o.allBodies(t).concat(o.allConstraints(t)).concat(o.allComposites(t)),i=0;i<e.length;i++)e[i].id=n.nextId();return t},o.translate=function(t,e,i){for(var r=i?o.allBodies(t):t.bodies,n=0;n<r.length;n++)a.translate(r[n],e);return t},o.rotate=function(t,e,i,r){for(var n=Math.cos(e),s=Math.sin(e),h=r?o.allBodies(t):t.bodies,c=0;c<h.length;c++){var l=h[c],u=l.position.x-i.x,m=l.position.y-i.y;a.setPosition(l,{x:i.x+(u*n-m*s),y:i.y+(u*s+m*n)}),a.rotate(l,e)}return t},o.scale=function(t,e,i,r,n){for(var s=n?o.allBodies(t):t.bodies,h=0;h<s.length;h++){var c=s[h],l=c.position.x-r.x,u=c.position.y-r.y;a.setPosition(c,{x:r.x+l*e,y:r.y+u*i}),a.scale(c,e,i)}return t},o.bounds=function(t){for(var e=o.allBodies(t),i=[],r=0;r<e.length;r+=1){var n=e[r];i.push(n.bounds.min,n.bounds.max)}return s.create(i)}},function(t,e,i){var o={};t.exports=o;var r=i(4),n=i(5),s=i(0);o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(t,e){for(var i=e/s._baseDelta,n=o._motionSleepThreshold,a=0;a<t.length;a++){var h=t[a],c=r.getSpeed(h),l=r.getAngularSpeed(h),u=c*c+l*l;if(0===h.force.x&&0===h.force.y){var m=Math.min(h.motion,u),d=Math.max(h.motion,u);h.motion=o._minBias*m+(1-o._minBias)*d,h.sleepThreshold>0&&h.motion<n?(h.sleepCounter+=1,h.sleepCounter>=h.sleepThreshold/i&&o.set(h,!0)):h.sleepCounter>0&&(h.sleepCounter-=1)}else o.set(h,!1)}},o.afterCollisions=function(t){for(var e=o._motionSleepThreshold,i=0;i<t.length;i++){var r=t[i];if(r.isActive){var n=r.collision,s=n.bodyA.parent,a=n.bodyB.parent;if(!(s.isSleeping&&a.isSleeping||s.isStatic||a.isStatic)&&(s.isSleeping||a.isSleeping)){var h=s.isSleeping&&!s.isStatic?s:a,c=h===s?a:s;!h.isStatic&&c.motion>e&&o.set(h,!1)}}}},o.set=function(t,e){var i=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,i||n.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,i&&n.trigger(t,"sleepEnd"))}},function(t,e,i){var o={};t.exports=o;var r,n,s,a=i(3),h=i(9);r=[],n={overlap:0,axis:null},s={overlap:0,axis:null},o.create=function(t,e){return{pair:null,collided:!1,bodyA:t,bodyB:e,parentA:t.parent,parentB:e.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},o.collides=function(t,e,i){if(o._overlapAxes(n,t.vertices,e.vertices,t.axes),n.overlap<=0)return null;if(o._overlapAxes(s,e.vertices,t.vertices,e.axes),s.overlap<=0)return null;var r,c,l=i&&i.table[h.id(t,e)];l?r=l.collision:((r=o.create(t,e)).collided=!0,r.bodyA=t.id<e.id?t:e,r.bodyB=t.id<e.id?e:t,r.parentA=r.bodyA.parent,r.parentB=r.bodyB.parent),t=r.bodyA,e=r.bodyB,c=n.overlap<s.overlap?n:s;var u=r.normal,m=r.tangent,d=r.penetration,p=r.supports,f=c.overlap,x=c.axis,y=x.x,g=x.y;y*(e.position.x-t.position.x)+g*(e.position.y-t.position.y)>=0&&(y=-y,g=-g),u.x=y,u.y=g,m.x=-g,m.y=y,d.x=y*f,d.y=g*f,r.depth=f;var v=o._findSupports(t,e,u,1),b=0;if(a.contains(t.vertices,v[0])&&(p[b++]=v[0]),a.contains(t.vertices,v[1])&&(p[b++]=v[1]),b<2){var w=o._findSupports(e,t,u,-1);a.contains(e.vertices,w[0])&&(p[b++]=w[0]),b<2&&a.contains(e.vertices,w[1])&&(p[b++]=w[1])}return 0===b&&(p[b++]=v[0]),r.supportCount=b,r},o._overlapAxes=function(t,e,i,o){var r,n,s,a,h,c,l=e.length,u=i.length,m=e[0].x,d=e[0].y,p=i[0].x,f=i[0].y,x=o.length,y=Number.MAX_VALUE,g=0;for(h=0;h<x;h++){var v=o[h],b=v.x,w=v.y,M=m*b+d*w,j=p*b+f*w,C=M,P=j;for(c=1;c<l;c+=1)(a=e[c].x*b+e[c].y*w)>C?C=a:a<M&&(M=a);for(c=1;c<u;c+=1)(a=i[c].x*b+i[c].y*w)>P?P=a:a<j&&(j=a);if((r=(n=C-j)<(s=P-M)?n:s)<y&&(y=r,g=h,r<=0))break}t.axis=o[g],t.overlap=y},o._findSupports=function(t,e,i,o){var n,s,a,h=e.vertices,c=h.length,l=t.position.x,u=t.position.y,m=i.x*o,d=i.y*o,p=h[0],f=p,x=m*(l-f.x)+d*(u-f.y);for(a=1;a<c;a+=1)(s=m*(l-(f=h[a]).x)+d*(u-f.y))<x&&(x=s,p=f);return x=m*(l-(n=h[(c+p.index-1)%c]).x)+d*(u-n.y),m*(l-(f=h[(p.index+1)%c]).x)+d*(u-f.y)<x?(r[0]=p,r[1]=f,r):(r[0]=p,r[1]=n,r)}},function(t,e,i){var o={};t.exports=o;var r=i(16);o.create=function(t,e){var i=t.bodyA,n=t.bodyB,s={id:o.id(i,n),bodyA:i,bodyB:n,collision:t,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:i.isSensor||n.isSensor,timeCreated:e,timeUpdated:e,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return o.update(s,t,e),s},o.update=function(t,e,i){var o=e.supports,r=e.supportCount,n=t.contacts,s=e.parentA,a=e.parentB;t.isActive=!0,t.timeUpdated=i,t.collision=e,t.separation=e.depth,t.inverseMass=s.inverseMass+a.inverseMass,t.friction=s.friction<a.friction?s.friction:a.friction,t.frictionStatic=s.frictionStatic>a.frictionStatic?s.frictionStatic:a.frictionStatic,t.restitution=s.restitution>a.restitution?s.restitution:a.restitution,t.slop=s.slop>a.slop?s.slop:a.slop,t.contactCount=r,e.pair=t;var h=o[0],c=n[0],l=o[1],u=n[1];u.vertex!==h&&c.vertex!==l||(n[1]=c,n[0]=c=u,u=n[1]),c.vertex=h,u.vertex=l},o.setActive=function(t,e,i){e?(t.isActive=!0,t.timeUpdated=i):(t.isActive=!1,t.contactCount=0)},o.id=function(t,e){return t.id<e.id?t.id.toString(36)+":"+e.id.toString(36):e.id.toString(36)+":"+t.id.toString(36)}},function(t,e,i){var o={};t.exports=o;var r=i(3),n=i(2),s=i(7),a=i(1),h=i(11),c=i(0);o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var i=e.bodyA?n.add(e.bodyA.position,e.pointA):e.pointA,o=e.bodyB?n.add(e.bodyB.position,e.pointB):e.pointB,r=n.magnitude(n.sub(i,o));e.length=void 0!==e.length?e.length:r,e.id=e.id||c.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&e.stiffness>.1?(s.type="pin",s.anchors=!1):e.stiffness<.9&&(s.type="spring"),e.render=c.extend(s,e.render),e},o.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var i=t[e],o=i.constraintImpulse;i.isStatic||0===o.x&&0===o.y&&0===o.angle||(i.position.x+=o.x,i.position.y+=o.y,i.angle+=o.angle)}},o.solveAll=function(t,e){for(var i=c.clamp(e/c._baseDelta,0,1),r=0;r<t.length;r+=1){var n=t[r],s=!n.bodyA||n.bodyA&&n.bodyA.isStatic,a=!n.bodyB||n.bodyB&&n.bodyB.isStatic;(s||a)&&o.solve(t[r],i)}for(r=0;r<t.length;r+=1)s=!(n=t[r]).bodyA||n.bodyA&&n.bodyA.isStatic,a=!n.bodyB||n.bodyB&&n.bodyB.isStatic,s||a||o.solve(t[r],i)},o.solve=function(t,e){var i=t.bodyA,r=t.bodyB,s=t.pointA,a=t.pointB;if(i||r){i&&!i.isStatic&&(n.rotate(s,i.angle-t.angleA,s),t.angleA=i.angle),r&&!r.isStatic&&(n.rotate(a,r.angle-t.angleB,a),t.angleB=r.angle);var h=s,c=a;if(i&&(h=n.add(i.position,s)),r&&(c=n.add(r.position,a)),h&&c){var l=n.sub(h,c),u=n.magnitude(l);u<o._minLength&&(u=o._minLength);var m,d,p,f,x,y=(u-t.length)/u,g=t.stiffness>=1||0===t.length?t.stiffness*e:t.stiffness*e*e,v=t.damping*e,b=n.mult(l,y*g),w=(i?i.inverseMass:0)+(r?r.inverseMass:0),M=w+((i?i.inverseInertia:0)+(r?r.inverseInertia:0));if(v>0){var j=n.create();p=n.div(l,u),x=n.sub(r&&n.sub(r.position,r.positionPrev)||j,i&&n.sub(i.position,i.positionPrev)||j),f=n.dot(p,x)}i&&!i.isStatic&&(d=i.inverseMass/w,i.constraintImpulse.x-=b.x*d,i.constraintImpulse.y-=b.y*d,i.position.x-=b.x*d,i.position.y-=b.y*d,v>0&&(i.positionPrev.x-=v*p.x*f*d,i.positionPrev.y-=v*p.y*f*d),m=n.cross(s,b)/M*o._torqueDampen*i.inverseInertia*(1-t.angularStiffness),i.constraintImpulse.angle-=m,i.angle-=m),r&&!r.isStatic&&(d=r.inverseMass/w,r.constraintImpulse.x+=b.x*d,r.constraintImpulse.y+=b.y*d,r.position.x+=b.x*d,r.position.y+=b.y*d,v>0&&(r.positionPrev.x+=v*p.x*f*d,r.positionPrev.y+=v*p.y*f*d),m=n.cross(a,b)/M*o._torqueDampen*r.inverseInertia*(1-t.angularStiffness),r.constraintImpulse.angle+=m,r.angle+=m)}}},o.postSolveAll=function(t){for(var e=0;e<t.length;e++){var i=t[e],c=i.constraintImpulse;if(!(i.isStatic||0===c.x&&0===c.y&&0===c.angle)){s.set(i,!1);for(var l=0;l<i.parts.length;l++){var u=i.parts[l];r.translate(u.vertices,c),l>0&&(u.position.x+=c.x,u.position.y+=c.y),0!==c.angle&&(r.rotate(u.vertices,c.angle,i.position),h.rotate(u.axes,c.angle),l>0&&n.rotateAbout(u.position,c.angle,i.position,u.position)),a.update(u.bounds,u.vertices,i.velocity)}c.angle*=o._warming,c.x*=o._warming,c.y*=o._warming}}},o.pointAWorld=function(t){return{x:(t.bodyA?t.bodyA.position.x:0)+(t.pointA?t.pointA.x:0),y:(t.bodyA?t.bodyA.position.y:0)+(t.pointA?t.pointA.y:0)}},o.pointBWorld=function(t){return{x:(t.bodyB?t.bodyB.position.x:0)+(t.pointB?t.pointB.x:0),y:(t.bodyB?t.bodyB.position.y:0)+(t.pointB?t.pointB.y:0)}},o.currentLength=function(t){var e=(t.bodyA?t.bodyA.position.x:0)+(t.pointA?t.pointA.x:0),i=(t.bodyA?t.bodyA.position.y:0)+(t.pointA?t.pointA.y:0),o=e-((t.bodyB?t.bodyB.position.x:0)+(t.pointB?t.pointB.x:0)),r=i-((t.bodyB?t.bodyB.position.y:0)+(t.pointB?t.pointB.y:0));return Math.sqrt(o*o+r*r)}},function(t,e,i){var o={};t.exports=o;var r=i(2),n=i(0);o.fromVertices=function(t){for(var e={},i=0;i<t.length;i++){var o=(i+1)%t.length,s=r.normalise({x:t[o].y-t[i].y,y:t[i].x-t[o].x}),a=0===s.y?1/0:s.x/s.y;e[a=a.toFixed(3).toString()]=s}return n.values(e)},o.rotate=function(t,e){if(0!==e)for(var i=Math.cos(e),o=Math.sin(e),r=0;r<t.length;r++){var n,s=t[r];n=s.x*i-s.y*o,s.y=s.x*o+s.y*i,s.x=n}}},function(t,e,i){var o={};t.exports=o;var r=i(3),n=i(0),s=i(4),a=i(1),h=i(2);o.rectangle=function(t,e,i,o,a){a=a||{};var h={label:"Rectangle Body",position:{x:t,y:e},vertices:r.fromPath("L 0 0 L "+i+" 0 L "+i+" "+o+" L 0 "+o)};if(a.chamfer){var c=a.chamfer;h.vertices=r.chamfer(h.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return s.create(n.extend({},h,a))},o.trapezoid=function(t,e,i,o,a,h){h=h||{},a>=1&&n.warn("Bodies.trapezoid: slope parameter must be < 1.");var c,l=i*(a*=.5),u=l+(1-2*a)*i,m=u+l;c=a<.5?"L 0 0 L "+l+" "+-o+" L "+u+" "+-o+" L "+m+" 0":"L 0 0 L "+u+" "+-o+" L "+m+" 0";var d={label:"Trapezoid Body",position:{x:t,y:e},vertices:r.fromPath(c)};if(h.chamfer){var p=h.chamfer;d.vertices=r.chamfer(d.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete h.chamfer}return s.create(n.extend({},d,h))},o.circle=function(t,e,i,r,s){r=r||{};var a={label:"Circle Body",circleRadius:i};s=s||25;var h=Math.ceil(Math.max(10,Math.min(s,i)));return h%2==1&&(h+=1),o.polygon(t,e,h,i,n.extend({},a,r))},o.polygon=function(t,e,i,a,h){if(h=h||{},i<3)return o.circle(t,e,a,h);for(var c=2*Math.PI/i,l="",u=.5*c,m=0;m<i;m+=1){var d=u+m*c,p=Math.cos(d)*a,f=Math.sin(d)*a;l+="L "+p.toFixed(3)+" "+f.toFixed(3)+" "}var x={label:"Polygon Body",position:{x:t,y:e},vertices:r.fromPath(l)};if(h.chamfer){var y=h.chamfer;x.vertices=r.chamfer(x.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete h.chamfer}return s.create(n.extend({},x,h))},o.fromVertices=function(t,e,i,o,c,l,u,m){var d,p,f,x,y,g,v,b,w,M,j=n.getDecomp();for(d=Boolean(j&&j.quickDecomp),o=o||{},f=[],c=void 0!==c&&c,l=void 0!==l?l:.01,u=void 0!==u?u:10,m=void 0!==m?m:.01,n.isArray(i[0])||(i=[i]),w=0;w<i.length;w+=1)if(y=i[w],!(x=r.isConvex(y))&&!d&&n.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),x||!d)y=x?r.clockwiseSort(y):r.hull(y),f.push({position:{x:t,y:e},vertices:y});else{var C=y.map((function(t){return[t.x,t.y]}));j.makeCCW(C),!1!==l&&j.removeCollinearPoints(C,l),!1!==m&&j.removeDuplicatePoints&&j.removeDuplicatePoints(C,m);var P=j.quickDecomp(C);for(g=0;g<P.length;g++){var S=P[g].map((function(t){return{x:t[0],y:t[1]}}));u>0&&r.area(S)<u||f.push({position:r.centre(S),vertices:S})}}for(g=0;g<f.length;g++)f[g]=s.create(n.extend(f[g],o));if(c)for(g=0;g<f.length;g++){var z=f[g];for(v=g+1;v<f.length;v++){var A=f[v];if(a.overlaps(z.bounds,A.bounds)){var B=z.vertices,_=A.vertices;for(b=0;b<z.vertices.length;b++)for(M=0;M<A.vertices.length;M++){var I=h.magnitudeSquared(h.sub(B[(b+1)%B.length],_[M])),R=h.magnitudeSquared(h.sub(B[b],_[(M+1)%_.length]));I<5&&R<5&&(B[b].isInternal=!0,_[M].isInternal=!0)}}}}return f.length>1?(p=s.create(n.extend({parts:f.slice(0)},o)),s.setPosition(p,{x:t,y:e}),p):f[0]}},function(t,e,i){var o={};t.exports=o;var r=i(0),n=i(8);o.create=function(t){return r.extend({bodies:[],collisions:[],pairs:null},t)},o.setBodies=function(t,e){t.bodies=e.slice(0)},o.clear=function(t){t.bodies=[],t.collisions=[]},o.collisions=function(t){var e,i,r=t.pairs,s=t.bodies,a=s.length,h=o.canCollide,c=n.collides,l=t.collisions,u=0;for(s.sort(o._compareBoundsX),e=0;e<a;e++){var m=s[e],d=m.bounds,p=m.bounds.max.x,f=m.bounds.max.y,x=m.bounds.min.y,y=m.isStatic||m.isSleeping,g=m.parts.length,v=1===g;for(i=e+1;i<a;i++){var b=s[i];if((A=b.bounds).min.x>p)break;if(!(f<A.min.y||x>A.max.y)&&(!y||!b.isStatic&&!b.isSleeping)&&h(m.collisionFilter,b.collisionFilter)){var w=b.parts.length;if(v&&1===w)(S=c(m,b,r))&&(l[u++]=S);else for(var M=w>1?1:0,j=g>1?1:0;j<g;j++)for(var C=m.parts[j],P=(d=C.bounds,M);P<w;P++){var S,z=b.parts[P],A=z.bounds;d.min.x>A.max.x||d.max.x<A.min.x||d.max.y<A.min.y||d.min.y>A.max.y||(S=c(C,z,r))&&(l[u++]=S)}}}}return l.length!==u&&(l.length=u),l},o.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:0!=(t.mask&e.category)&&0!=(e.mask&t.category)},o._compareBoundsX=function(t,e){return t.bounds.min.x-e.bounds.min.x}},function(t,e,i){var o={};t.exports=o;var r=i(0);o.create=function(t){var e={};return t||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=parseInt(e.element.getAttribute("data-pixel-ratio"),10)||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(t){var i=o._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&(e.button=0,t.preventDefault()),e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var i=o._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var i=o._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&t.preventDefault(),e.button=-1,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault(),e.sourceEvents.mousewheel=t},o.setElement(e,e.element),e},o.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove,{passive:!0}),e.addEventListener("mousedown",t.mousedown,{passive:!0}),e.addEventListener("mouseup",t.mouseup,{passive:!0}),e.addEventListener("wheel",t.mousewheel,{passive:!1}),e.addEventListener("touchmove",t.mousemove,{passive:!1}),e.addEventListener("touchstart",t.mousedown,{passive:!1}),e.addEventListener("touchend",t.mouseup,{passive:!1})},o.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},o.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},o.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},o._getRelativeMousePosition=function(t,e,i){var o,r,n=e.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,h=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=t.changedTouches;return c?(o=c[0].pageX-n.left-a,r=c[0].pageY-n.top-h):(o=t.pageX-n.left-a,r=t.pageY-n.top-h),{x:o/(e.clientWidth/(e.width||e.clientWidth)*i),y:r/(e.clientHeight/(e.height||e.clientHeight)*i)}}},function(t,e,i){var o={};t.exports=o;var r=i(0);o._registry={},o.register=function(t){if(o.isPlugin(t)||r.warn("Plugin.register:",o.toString(t),"does not implement all required fields."),t.name in o._registry){var e=o._registry[t.name],i=o.versionParse(t.version).number,n=o.versionParse(e.version).number;i>n?(r.warn("Plugin.register:",o.toString(e),"was upgraded to",o.toString(t)),o._registry[t.name]=t):i<n?r.warn("Plugin.register:",o.toString(e),"can not be downgraded to",o.toString(t)):t!==e&&r.warn("Plugin.register:",o.toString(t),"is already registered to different plugin object")}else o._registry[t.name]=t;return t},o.resolve=function(t){return o._registry[o.dependencyParse(t).name]},o.toString=function(t){return"string"==typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},o.isPlugin=function(t){return t&&t.name&&t.version&&t.install},o.isUsed=function(t,e){return t.used.indexOf(e)>-1},o.isFor=function(t,e){var i=t.for&&o.dependencyParse(t.for);return!t.for||e.name===i.name&&o.versionSatisfies(e.version,i.range)},o.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var i=o.dependencies(t),n=r.topologicalSort(i),s=[],a=0;a<n.length;a+=1)if(n[a]!==t.name){var h=o.resolve(n[a]);h?o.isUsed(t,h.name)||(o.isFor(h,t)||(r.warn("Plugin.use:",o.toString(h),"is for",h.for,"but installed on",o.toString(t)+"."),h._warned=!0),h.install?h.install(t):(r.warn("Plugin.use:",o.toString(h),"does not specify an install function."),h._warned=!0),h._warned?(s.push("🔶 "+o.toString(h)),delete h._warned):s.push("✅ "+o.toString(h)),t.used.push(h.name)):s.push("❌ "+n[a])}s.length>0&&r.info(s.join("  "))}else r.warn("Plugin.use:",o.toString(t),"does not specify any dependencies to install.")},o.dependencies=function(t,e){var i=o.dependencyParse(t),n=i.name;if(!(n in(e=e||{}))){t=o.resolve(t)||t,e[n]=r.map(t.uses||[],(function(e){o.isPlugin(e)&&o.register(e);var n=o.dependencyParse(e),s=o.resolve(e);return s&&!o.versionSatisfies(s.version,n.range)?(r.warn("Plugin.dependencies:",o.toString(s),"does not satisfy",o.toString(n),"used by",o.toString(i)+"."),s._warned=!0,t._warned=!0):s||(r.warn("Plugin.dependencies:",o.toString(e),"used by",o.toString(i),"could not be resolved."),t._warned=!0),n.name}));for(var s=0;s<e[n].length;s+=1)o.dependencies(e[n][s],e);return e}},o.dependencyParse=function(t){return r.isString(t)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(t)||r.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}):{name:t.name,range:t.range||t.version}},o.versionParse=function(t){var e=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;e.test(t)||r.warn("Plugin.versionParse:",t,"is not a valid version or range.");var i=e.exec(t),o=Number(i[4]),n=Number(i[5]),s=Number(i[6]);return{isRange:Boolean(i[1]||i[2]),version:i[3],range:t,operator:i[1]||i[2]||"",major:o,minor:n,patch:s,parts:[o,n,s],prerelease:i[7],number:1e8*o+1e4*n+s}},o.versionSatisfies=function(t,e){e=e||"*";var i=o.versionParse(e),r=o.versionParse(t);if(i.isRange){if("*"===i.operator||"*"===t)return!0;if(">"===i.operator)return r.number>i.number;if(">="===i.operator)return r.number>=i.number;if("~"===i.operator)return r.major===i.major&&r.minor===i.minor&&r.patch>=i.patch;if("^"===i.operator)return i.major>0?r.major===i.major&&r.number>=i.number:i.minor>0?r.minor===i.minor&&r.patch>=i.patch:r.patch===i.patch}return t===e||"*"===t}},function(t,e){var i={};t.exports=i,i.create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}},function(t,e,i){var o={};t.exports=o;var r=i(7),n=i(18),s=i(13),a=i(19),h=i(5),c=i(6),l=i(10),u=i(0),m=i(4);o._deltaMax=1e3/60,o.create=function(t){t=t||{};var e=u.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},t);return e.world=t.world||c.create({label:"World"}),e.pairs=t.pairs||a.create(),e.detector=t.detector||s.create(),e.detector.pairs=e.pairs,e.grid={buckets:[]},e.world.gravity=e.gravity,e.broadphase=e.grid,e.metrics={},e},o.update=function(t,e){var i,m=u.now(),d=t.world,p=t.detector,f=t.pairs,x=t.timing,y=x.timestamp;e>o._deltaMax&&u.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",o._deltaMax.toFixed(3),"ms."),e=void 0!==e?e:u._baseDelta,e*=x.timeScale,x.timestamp+=e,x.lastDelta=e;var g={timestamp:x.timestamp,delta:e};h.trigger(t,"beforeUpdate",g);var v=c.allBodies(d),b=c.allConstraints(d);for(d.isModified&&(s.setBodies(p,v),c.setModified(d,!1,!1,!0)),t.enableSleeping&&r.update(v,e),o._bodiesApplyGravity(v,t.gravity),e>0&&o._bodiesUpdate(v,e),h.trigger(t,"beforeSolve",g),l.preSolveAll(v),i=0;i<t.constraintIterations;i++)l.solveAll(b,e);l.postSolveAll(v);var w=s.collisions(p);a.update(f,w,y),t.enableSleeping&&r.afterCollisions(f.list),f.collisionStart.length>0&&h.trigger(t,"collisionStart",{pairs:f.collisionStart,timestamp:x.timestamp,delta:e});var M=u.clamp(20/t.positionIterations,0,1);for(n.preSolvePosition(f.list),i=0;i<t.positionIterations;i++)n.solvePosition(f.list,e,M);for(n.postSolvePosition(v),l.preSolveAll(v),i=0;i<t.constraintIterations;i++)l.solveAll(b,e);for(l.postSolveAll(v),n.preSolveVelocity(f.list),i=0;i<t.velocityIterations;i++)n.solveVelocity(f.list,e);return o._bodiesUpdateVelocities(v),f.collisionActive.length>0&&h.trigger(t,"collisionActive",{pairs:f.collisionActive,timestamp:x.timestamp,delta:e}),f.collisionEnd.length>0&&h.trigger(t,"collisionEnd",{pairs:f.collisionEnd,timestamp:x.timestamp,delta:e}),o._bodiesClearForces(v),h.trigger(t,"afterUpdate",g),t.timing.lastElapsed=u.now()-m,t},o.merge=function(t,e){if(u.extend(t,e),e.world){t.world=e.world,o.clear(t);for(var i=c.allBodies(t.world),n=0;n<i.length;n++){var s=i[n];r.set(s,!1),s.id=u.nextId()}}},o.clear=function(t){a.clear(t.pairs),s.clear(t.detector)},o._bodiesClearForces=function(t){for(var e=t.length,i=0;i<e;i++){var o=t[i];o.force.x=0,o.force.y=0,o.torque=0}},o._bodiesApplyGravity=function(t,e){var i=void 0!==e.scale?e.scale:.001,o=t.length;if((0!==e.x||0!==e.y)&&0!==i)for(var r=0;r<o;r++){var n=t[r];n.isStatic||n.isSleeping||(n.force.y+=n.mass*e.y*i,n.force.x+=n.mass*e.x*i)}},o._bodiesUpdate=function(t,e){for(var i=t.length,o=0;o<i;o++){var r=t[o];r.isStatic||r.isSleeping||m.update(r,e)}},o._bodiesUpdateVelocities=function(t){for(var e=t.length,i=0;i<e;i++)m.updateVelocities(t[i])}},function(t,e,i){var o={};t.exports=o;var r=i(3),n=i(0),s=i(1);o._restingThresh=2,o._restingThreshTangent=Math.sqrt(6),o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o._frictionMaxStatic=Number.MAX_VALUE,o.preSolvePosition=function(t){var e,i,o,r=t.length;for(e=0;e<r;e++)(i=t[e]).isActive&&(o=i.contactCount,i.collision.parentA.totalContacts+=o,i.collision.parentB.totalContacts+=o)},o.solvePosition=function(t,e,i){var r,s,a,h,c,l,u,m,d=o._positionDampen*(i||1),p=n.clamp(e/n._baseDelta,0,1),f=t.length;for(r=0;r<f;r++)(s=t[r]).isActive&&!s.isSensor&&(h=(a=s.collision).parentA,c=a.parentB,l=a.normal,s.separation=a.depth+l.x*(c.positionImpulse.x-h.positionImpulse.x)+l.y*(c.positionImpulse.y-h.positionImpulse.y));for(r=0;r<f;r++)(s=t[r]).isActive&&!s.isSensor&&(h=(a=s.collision).parentA,c=a.parentB,l=a.normal,m=s.separation-s.slop*p,(h.isStatic||c.isStatic)&&(m*=2),h.isStatic||h.isSleeping||(u=d/h.totalContacts,h.positionImpulse.x+=l.x*m*u,h.positionImpulse.y+=l.y*m*u),c.isStatic||c.isSleeping||(u=d/c.totalContacts,c.positionImpulse.x-=l.x*m*u,c.positionImpulse.y-=l.y*m*u))},o.postSolvePosition=function(t){for(var e=o._positionWarming,i=t.length,n=r.translate,a=s.update,h=0;h<i;h++){var c=t[h],l=c.positionImpulse,u=l.x,m=l.y,d=c.velocity;if(c.totalContacts=0,0!==u||0!==m){for(var p=0;p<c.parts.length;p++){var f=c.parts[p];n(f.vertices,l),a(f.bounds,f.vertices,d),f.position.x+=u,f.position.y+=m}c.positionPrev.x+=u,c.positionPrev.y+=m,u*d.x+m*d.y<0?(l.x=0,l.y=0):(l.x*=e,l.y*=e)}}},o.preSolveVelocity=function(t){var e,i,o=t.length;for(e=0;e<o;e++){var r=t[e];if(r.isActive&&!r.isSensor){var n=r.contacts,s=r.contactCount,a=r.collision,h=a.parentA,c=a.parentB,l=a.normal,u=a.tangent;for(i=0;i<s;i++){var m=n[i],d=m.vertex,p=m.normalImpulse,f=m.tangentImpulse;if(0!==p||0!==f){var x=l.x*p+u.x*f,y=l.y*p+u.y*f;h.isStatic||h.isSleeping||(h.positionPrev.x+=x*h.inverseMass,h.positionPrev.y+=y*h.inverseMass,h.anglePrev+=h.inverseInertia*((d.x-h.position.x)*y-(d.y-h.position.y)*x)),c.isStatic||c.isSleeping||(c.positionPrev.x-=x*c.inverseMass,c.positionPrev.y-=y*c.inverseMass,c.anglePrev-=c.inverseInertia*((d.x-c.position.x)*y-(d.y-c.position.y)*x))}}}}},o.solveVelocity=function(t,e){var i,r,s,a,h=e/n._baseDelta,c=h*h*h,l=-o._restingThresh*h,u=o._restingThreshTangent,m=o._frictionNormalMultiplier*h,d=o._frictionMaxStatic,p=t.length;for(s=0;s<p;s++){var f=t[s];if(f.isActive&&!f.isSensor){var x=f.collision,y=x.parentA,g=x.parentB,v=x.normal.x,b=x.normal.y,w=x.tangent.x,M=x.tangent.y,j=f.inverseMass,C=f.friction*f.frictionStatic*m,P=f.contacts,S=f.contactCount,z=1/S,A=y.position.x-y.positionPrev.x,B=y.position.y-y.positionPrev.y,_=y.angle-y.anglePrev,I=g.position.x-g.positionPrev.x,R=g.position.y-g.positionPrev.y,T=g.angle-g.anglePrev;for(a=0;a<S;a++){var E=P[a],k=E.vertex,D=k.x-y.position.x,W=k.y-y.position.y,F=k.x-g.position.x,L=k.y-g.position.y,O=A-W*_-(I-L*T),N=B+D*_-(R+F*T),V=v*O+b*N,G=w*O+M*N,H=f.separation+V,q=Math.min(H,1),U=(q=H<0?0:q)*C;G<-U||G>U?(r=G>0?G:-G,(i=f.friction*(G>0?1:-1)*c)<-r?i=-r:i>r&&(i=r)):(i=G,r=d);var Y=D*b-W*v,X=F*b-L*v,Z=z/(j+y.inverseInertia*Y*Y+g.inverseInertia*X*X),K=(1+f.restitution)*V*Z;if(i*=Z,V<l)E.normalImpulse=0;else{var Q=E.normalImpulse;E.normalImpulse+=K,E.normalImpulse>0&&(E.normalImpulse=0),K=E.normalImpulse-Q}if(G<-u||G>u)E.tangentImpulse=0;else{var $=E.tangentImpulse;E.tangentImpulse+=i,E.tangentImpulse<-r&&(E.tangentImpulse=-r),E.tangentImpulse>r&&(E.tangentImpulse=r),i=E.tangentImpulse-$}var J=v*K+w*i,tt=b*K+M*i;y.isStatic||y.isSleeping||(y.positionPrev.x+=J*y.inverseMass,y.positionPrev.y+=tt*y.inverseMass,y.anglePrev+=(D*tt-W*J)*y.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=J*g.inverseMass,g.positionPrev.y-=tt*g.inverseMass,g.anglePrev-=(F*tt-L*J)*g.inverseInertia)}}}}},function(t,e,i){var o={};t.exports=o;var r=i(9),n=i(0);o.create=function(t){return n.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},o.update=function(t,e,i){var o,n,s,a=r.update,h=r.create,c=r.setActive,l=t.table,u=t.list,m=u.length,d=m,p=t.collisionStart,f=t.collisionEnd,x=t.collisionActive,y=e.length,g=0,v=0,b=0;for(s=0;s<y;s++)(n=(o=e[s]).pair)?(n.isActive&&(x[b++]=n),a(n,o,i)):(l[(n=h(o,i)).id]=n,p[g++]=n,u[d++]=n);for(d=0,m=u.length,s=0;s<m;s++)(n=u[s]).timeUpdated>=i?u[d++]=n:(c(n,!1,i),n.collision.bodyA.sleepCounter>0&&n.collision.bodyB.sleepCounter>0?u[d++]=n:(f[v++]=n,delete l[n.id]));u.length!==d&&(u.length=d),p.length!==g&&(p.length=g),f.length!==v&&(f.length=v),x.length!==b&&(x.length=b)},o.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}},function(t,e,i){var o=t.exports=i(21);o.Axes=i(11),o.Bodies=i(12),o.Body=i(4),o.Bounds=i(1),o.Collision=i(8),o.Common=i(0),o.Composite=i(6),o.Composites=i(22),o.Constraint=i(10),o.Contact=i(16),o.Detector=i(13),o.Engine=i(17),o.Events=i(5),o.Grid=i(23),o.Mouse=i(14),o.MouseConstraint=i(24),o.Pair=i(9),o.Pairs=i(19),o.Plugin=i(15),o.Query=i(25),o.Render=i(26),o.Resolver=i(18),o.Runner=i(27),o.SAT=i(28),o.Sleeping=i(7),o.Svg=i(29),o.Vector=i(2),o.Vertices=i(3),o.World=i(30),o.Engine.run=o.Runner.run,o.Common.deprecated(o.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(t,e,i){var o={};t.exports=o;var r=i(15),n=i(0);o.name="matter-js",o.version="0.20.0",o.uses=[],o.used=[],o.use=function(){r.use(o,Array.prototype.slice.call(arguments))},o.before=function(t,e){return t=t.replace(/^Matter./,""),n.chainPathBefore(o,t,e)},o.after=function(t,e){return t=t.replace(/^Matter./,""),n.chainPathAfter(o,t,e)}},function(t,e,i){var o={};t.exports=o;var r=i(6),n=i(10),s=i(0),a=i(4),h=i(12),c=s.deprecated;o.stack=function(t,e,i,o,n,s,h){for(var c,l=r.create({label:"Stack"}),u=t,m=e,d=0,p=0;p<o;p++){for(var f=0,x=0;x<i;x++){var y=h(u,m,x,p,c,d);if(y){var g=y.bounds.max.y-y.bounds.min.y,v=y.bounds.max.x-y.bounds.min.x;g>f&&(f=g),a.translate(y,{x:.5*v,y:.5*g}),u=y.bounds.max.x+n,r.addBody(l,y),c=y,d+=1}else u+=n}m+=f+s,u=t}return l},o.chain=function(t,e,i,o,a,h){for(var c=t.bodies,l=1;l<c.length;l++){var u=c[l-1],m=c[l],d=u.bounds.max.y-u.bounds.min.y,p=u.bounds.max.x-u.bounds.min.x,f=m.bounds.max.y-m.bounds.min.y,x={bodyA:u,pointA:{x:p*e,y:d*i},bodyB:m,pointB:{x:(m.bounds.max.x-m.bounds.min.x)*o,y:f*a}},y=s.extend(x,h);r.addConstraint(t,n.create(y))}return t.label+=" Chain",t},o.mesh=function(t,e,i,o,a){var h,c,l,u,m,d=t.bodies;for(h=0;h<i;h++){for(c=1;c<e;c++)l=d[c-1+h*e],u=d[c+h*e],r.addConstraint(t,n.create(s.extend({bodyA:l,bodyB:u},a)));if(h>0)for(c=0;c<e;c++)l=d[c+(h-1)*e],u=d[c+h*e],r.addConstraint(t,n.create(s.extend({bodyA:l,bodyB:u},a))),o&&c>0&&(m=d[c-1+(h-1)*e],r.addConstraint(t,n.create(s.extend({bodyA:m,bodyB:u},a)))),o&&c<e-1&&(m=d[c+1+(h-1)*e],r.addConstraint(t,n.create(s.extend({bodyA:m,bodyB:u},a))))}return t.label+=" Mesh",t},o.pyramid=function(t,e,i,r,n,s,h){return o.stack(t,e,i,r,n,s,(function(e,o,s,c,l,u){var m=Math.min(r,Math.ceil(i/2)),d=l?l.bounds.max.x-l.bounds.min.x:0;if(!(c>m||s<(c=m-c)||s>i-1-c))return 1===u&&a.translate(l,{x:(s+(i%2==1?1:-1))*d,y:0}),h(t+(l?s*d:0)+s*n,o,s,c,l,u)}))},o.newtonsCradle=function(t,e,i,o,s){for(var a=r.create({label:"Newtons Cradle"}),c=0;c<i;c++){var l=h.circle(t+c*(1.9*o),e+s,o,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=n.create({pointA:{x:t+c*(1.9*o),y:e},bodyB:l});r.addBody(a,l),r.addConstraint(a,u)}return a},c(o,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),o.car=function(t,e,i,o,s){var c=a.nextGroup(!0),l=.5*-i+20,u=.5*i-20,m=r.create({label:"Car"}),d=h.rectangle(t,e,i,o,{collisionFilter:{group:c},chamfer:{radius:.5*o},density:2e-4}),p=h.circle(t+l,e+0,s,{collisionFilter:{group:c},friction:.8}),f=h.circle(t+u,e+0,s,{collisionFilter:{group:c},friction:.8}),x=n.create({bodyB:d,pointB:{x:l,y:0},bodyA:p,stiffness:1,length:0}),y=n.create({bodyB:d,pointB:{x:u,y:0},bodyA:f,stiffness:1,length:0});return r.addBody(m,d),r.addBody(m,p),r.addBody(m,f),r.addConstraint(m,x),r.addConstraint(m,y),m},c(o,"car","Composites.car ➤ moved to car example"),o.softBody=function(t,e,i,r,n,a,c,l,u,m){u=s.extend({inertia:1/0},u),m=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},m);var d=o.stack(t,e,i,r,n,a,(function(t,e){return h.circle(t,e,l,u)}));return o.mesh(d,i,r,c,m),d.label="Soft Body",d},c(o,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(t,e,i){var o={};t.exports=o;var r=i(9),n=i(0),s=n.deprecated;o.create=function(t){return n.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},t)},o.update=function(t,e,i,r){var n,s,a,h,c,l=i.world,u=t.buckets,m=!1;for(n=0;n<e.length;n++){var d=e[n];if((!d.isSleeping||r)&&(!l.bounds||!(d.bounds.max.x<l.bounds.min.x||d.bounds.min.x>l.bounds.max.x||d.bounds.max.y<l.bounds.min.y||d.bounds.min.y>l.bounds.max.y))){var p=o._getRegion(t,d);if(!d.region||p.id!==d.region.id||r){d.region&&!r||(d.region=p);var f=o._regionUnion(p,d.region);for(s=f.startCol;s<=f.endCol;s++)for(a=f.startRow;a<=f.endRow;a++){h=u[c=o._getBucketId(s,a)];var x=s>=p.startCol&&s<=p.endCol&&a>=p.startRow&&a<=p.endRow,y=s>=d.region.startCol&&s<=d.region.endCol&&a>=d.region.startRow&&a<=d.region.endRow;!x&&y&&y&&h&&o._bucketRemoveBody(t,h,d),(d.region===p||x&&!y||r)&&(h||(h=o._createBucket(u,c)),o._bucketAddBody(t,h,d))}d.region=p,m=!0}}}m&&(t.pairsList=o._createActivePairsList(t))},s(o,"update","Grid.update ➤ replaced by Matter.Detector"),o.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},s(o,"clear","Grid.clear ➤ replaced by Matter.Detector"),o._regionUnion=function(t,e){var i=Math.min(t.startCol,e.startCol),r=Math.max(t.endCol,e.endCol),n=Math.min(t.startRow,e.startRow),s=Math.max(t.endRow,e.endRow);return o._createRegion(i,r,n,s)},o._getRegion=function(t,e){var i=e.bounds,r=Math.floor(i.min.x/t.bucketWidth),n=Math.floor(i.max.x/t.bucketWidth),s=Math.floor(i.min.y/t.bucketHeight),a=Math.floor(i.max.y/t.bucketHeight);return o._createRegion(r,n,s,a)},o._createRegion=function(t,e,i,o){return{id:t+","+e+","+i+","+o,startCol:t,endCol:e,startRow:i,endRow:o}},o._getBucketId=function(t,e){return"C"+t+"R"+e},o._createBucket=function(t,e){return t[e]=[]},o._bucketAddBody=function(t,e,i){var o,n=t.pairs,s=r.id,a=e.length;for(o=0;o<a;o++){var h=e[o];if(!(i.id===h.id||i.isStatic&&h.isStatic)){var c=s(i,h),l=n[c];l?l[2]+=1:n[c]=[i,h,1]}}e.push(i)},o._bucketRemoveBody=function(t,e,i){var o,s=t.pairs,a=r.id;e.splice(n.indexOf(e,i),1);var h=e.length;for(o=0;o<h;o++){var c=s[a(i,e[o])];c&&(c[2]-=1)}},o._createActivePairsList=function(t){var e,i,o=t.pairs,r=n.keys(o),s=r.length,a=[];for(i=0;i<s;i++)(e=o[r[i]])[2]>0?a.push(e):delete o[r[i]];return a}},function(t,e,i){var o={};t.exports=o;var r=i(3),n=i(7),s=i(14),a=i(5),h=i(13),c=i(10),l=i(6),u=i(0),m=i(1);o.create=function(t,e){var i=(t?t.mouse:null)||(e?e.mouse:null);i||(t&&t.render&&t.render.canvas?i=s.create(t.render.canvas):e&&e.element?i=s.create(e.element):(i=s.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r={type:"mouseConstraint",mouse:i,element:null,body:null,constraint:c.create({label:"Mouse Constraint",pointA:i.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},n=u.extend(r,e);return a.on(t,"beforeUpdate",(function(){var e=l.allBodies(t.world);o.update(n,e),o._triggerEvents(n)})),n},o.update=function(t,e){var i=t.mouse,o=t.constraint,s=t.body;if(0===i.button){if(o.bodyB)n.set(o.bodyB,!1),o.pointA=i.position;else for(var c=0;c<e.length;c++)if(s=e[c],m.contains(s.bounds,i.position)&&h.canCollide(s.collisionFilter,t.collisionFilter))for(var l=s.parts.length>1?1:0;l<s.parts.length;l++){var u=s.parts[l];if(r.contains(u.vertices,i.position)){o.pointA=i.position,o.bodyB=t.body=s,o.pointB={x:i.position.x-s.position.x,y:i.position.y-s.position.y},o.angleB=s.angle,n.set(s,!1),a.trigger(t,"startdrag",{mouse:i,body:s});break}}}else o.bodyB=t.body=null,o.pointB=null,s&&a.trigger(t,"enddrag",{mouse:i,body:s})},o._triggerEvents=function(t){var e=t.mouse,i=e.sourceEvents;i.mousemove&&a.trigger(t,"mousemove",{mouse:e}),i.mousedown&&a.trigger(t,"mousedown",{mouse:e}),i.mouseup&&a.trigger(t,"mouseup",{mouse:e}),s.clearSourceEvents(e)}},function(t,e,i){var o={};t.exports=o;var r=i(2),n=i(8),s=i(1),a=i(12),h=i(3);o.collides=function(t,e){for(var i=[],o=e.length,r=t.bounds,a=n.collides,h=s.overlaps,c=0;c<o;c++){var l=e[c],u=l.parts.length,m=1===u?0:1;if(h(l.bounds,r))for(var d=m;d<u;d++){var p=l.parts[d];if(h(p.bounds,r)){var f=a(p,t);if(f){i.push(f);break}}}}return i},o.ray=function(t,e,i,n){n=n||1e-100;for(var s=r.angle(e,i),h=r.magnitude(r.sub(e,i)),c=.5*(i.x+e.x),l=.5*(i.y+e.y),u=a.rectangle(c,l,h,n,{angle:s}),m=o.collides(u,t),d=0;d<m.length;d+=1){var p=m[d];p.body=p.bodyB=p.bodyA}return m},o.region=function(t,e,i){for(var o=[],r=0;r<t.length;r++){var n=t[r],a=s.overlaps(n.bounds,e);(a&&!i||!a&&i)&&o.push(n)}return o},o.point=function(t,e){for(var i=[],o=0;o<t.length;o++){var r=t[o];if(s.contains(r.bounds,e))for(var n=1===r.parts.length?0:1;n<r.parts.length;n++){var a=r.parts[n];if(s.contains(a.bounds,e)&&h.contains(a.vertices,e)){i.push(r);break}}}return i}},function(t,e,i){var o={};t.exports=o;var r=i(4),n=i(0),s=i(6),a=i(1),h=i(5),c=i(2),l=i(14);!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout((function(){t(n.now())}),1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o._goodFps=30,o._goodDelta=1e3/60,o.create=function(t){var e={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},i=n.extend(e,t);return i.canvas&&(i.canvas.width=i.options.width||i.canvas.width,i.canvas.height=i.options.height||i.canvas.height),i.mouse=t.mouse,i.engine=t.engine,i.canvas=i.canvas||m(i.options.width,i.options.height),i.context=i.canvas.getContext("2d"),i.textures={},i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.canvas.width,y:i.canvas.height}},i.controller=o,i.options.showBroadphase=!1,1!==i.options.pixelRatio&&o.setPixelRatio(i,i.options.pixelRatio),n.isElement(i.element)&&i.element.appendChild(i.canvas),i},o.run=function(e){!function r(n){e.frameRequestId=t(r),i(e,n),o.world(e,n),e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0),(e.options.showStats||e.options.showDebug)&&o.stats(e,e.context,n),(e.options.showPerformance||e.options.showDebug)&&o.performance(e,e.context,n),e.context.setTransform(1,0,0,1,0,0)}()},o.stop=function(t){e(t.frameRequestId)},o.setPixelRatio=function(t,e){var i=t.options,o=t.canvas;"auto"===e&&(e=d(o)),i.pixelRatio=e,o.setAttribute("data-pixel-ratio",e),o.width=i.width*e,o.height=i.height*e,o.style.width=i.width+"px",o.style.height=i.height+"px"},o.setSize=function(t,e,i){t.options.width=e,t.options.height=i,t.bounds.max.x=t.bounds.min.x+e,t.bounds.max.y=t.bounds.min.y+i,1!==t.options.pixelRatio?o.setPixelRatio(t,t.options.pixelRatio):(t.canvas.width=e,t.canvas.height=i)},o.lookAt=function(t,e,i,o){o=void 0===o||o,e=n.isArray(e)?e:[e],i=i||{x:0,y:0};for(var r={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<e.length;s+=1){var a=e[s],h=a.bounds?a.bounds.min:a.min||a.position||a,c=a.bounds?a.bounds.max:a.max||a.position||a;h&&c&&(h.x<r.min.x&&(r.min.x=h.x),c.x>r.max.x&&(r.max.x=c.x),h.y<r.min.y&&(r.min.y=h.y),c.y>r.max.y&&(r.max.y=c.y))}var u=r.max.x-r.min.x+2*i.x,m=r.max.y-r.min.y+2*i.y,d=t.canvas.height,p=t.canvas.width/d,f=u/m,x=1,y=1;f>p?y=f/p:x=p/f,t.options.hasBounds=!0,t.bounds.min.x=r.min.x,t.bounds.max.x=r.min.x+u*x,t.bounds.min.y=r.min.y,t.bounds.max.y=r.min.y+m*y,o&&(t.bounds.min.x+=.5*u-u*x*.5,t.bounds.max.x+=.5*u-u*x*.5,t.bounds.min.y+=.5*m-m*y*.5,t.bounds.max.y+=.5*m-m*y*.5),t.bounds.min.x-=i.x,t.bounds.max.x-=i.x,t.bounds.min.y-=i.y,t.bounds.max.y-=i.y,t.mouse&&(l.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),l.setOffset(t.mouse,t.bounds.min))},o.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,i=t.bounds.max.y-t.bounds.min.y,o=e/t.options.width,r=i/t.options.height;t.context.setTransform(t.options.pixelRatio/o,0,0,t.options.pixelRatio/r,0,0),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},o.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},o.world=function(t,e){var i,r=n.now(),u=t.engine,m=u.world,d=t.canvas,p=t.context,x=t.options,y=t.timing,g=s.allBodies(m),v=s.allConstraints(m),b=x.wireframes?x.wireframeBackground:x.background,w=[],M=[],j={timestamp:u.timing.timestamp};if(h.trigger(t,"beforeRender",j),t.currentBackground!==b&&f(t,b),p.globalCompositeOperation="source-in",p.fillStyle="transparent",p.fillRect(0,0,d.width,d.height),p.globalCompositeOperation="source-over",x.hasBounds){for(i=0;i<g.length;i++){var C=g[i];a.overlaps(C.bounds,t.bounds)&&w.push(C)}for(i=0;i<v.length;i++){var P=v[i],S=P.bodyA,z=P.bodyB,A=P.pointA,B=P.pointB;S&&(A=c.add(S.position,P.pointA)),z&&(B=c.add(z.position,P.pointB)),A&&B&&(a.contains(t.bounds,A)||a.contains(t.bounds,B))&&M.push(P)}o.startViewTransform(t),t.mouse&&(l.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),l.setOffset(t.mouse,t.bounds.min))}else M=v,w=g,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!x.wireframes||u.enableSleeping&&x.showSleeping?o.bodies(t,w,p):(x.showConvexHulls&&o.bodyConvexHulls(t,w,p),o.bodyWireframes(t,w,p)),x.showBounds&&o.bodyBounds(t,w,p),(x.showAxes||x.showAngleIndicator)&&o.bodyAxes(t,w,p),x.showPositions&&o.bodyPositions(t,w,p),x.showVelocity&&o.bodyVelocity(t,w,p),x.showIds&&o.bodyIds(t,w,p),x.showSeparations&&o.separations(t,u.pairs.list,p),x.showCollisions&&o.collisions(t,u.pairs.list,p),x.showVertexNumbers&&o.vertexNumbers(t,w,p),x.showMousePosition&&o.mousePosition(t,t.mouse,p),o.constraints(M,p),x.hasBounds&&o.endViewTransform(t),h.trigger(t,"afterRender",j),y.lastElapsed=n.now()-r},o.stats=function(t,e,i){for(var o=t.engine,r=o.world,n=s.allBodies(r),a=0,h=0,c=0;c<n.length;c+=1)a+=n[c].parts.length;var l={Part:a,Body:n.length,Cons:s.allConstraints(r).length,Comp:s.allComposites(r).length,Pair:o.pairs.list.length};for(var u in e.fillStyle="#0e0f19",e.fillRect(h,0,302.5,44),e.font="12px Arial",e.textBaseline="top",e.textAlign="right",l){var m=l[u];e.fillStyle="#aaa",e.fillText(u,h+55,8),e.fillStyle="#eee",e.fillText(m,h+55,26),h+=55}},o.performance=function(t,e){var i=t.engine,r=t.timing,s=r.deltaHistory,a=r.elapsedHistory,h=r.timestampElapsedHistory,c=r.engineDeltaHistory,l=r.engineUpdatesHistory,m=r.engineElapsedHistory,d=i.timing.lastUpdatesPerFrame,p=i.timing.lastDelta,f=u(s),x=u(a),y=u(c),g=u(l),v=u(m),b=u(h)/f||0,w=Math.round(f/p),M=1e3/f||0,j=60,C=69;e.fillStyle="#0e0f19",e.fillRect(0,50,442,34),o.status(e,10,C,j,4,s.length,Math.round(M)+" fps",M/o._goodFps,(function(t){return s[t]/f-1})),o.status(e,82,C,j,4,c.length,p.toFixed(2)+" dt",o._goodDelta/p,(function(t){return c[t]/y-1})),o.status(e,154,C,j,4,l.length,d+" upf",Math.pow(n.clamp(g/w||1,0,1),4),(function(t){return l[t]/g-1})),o.status(e,226,C,j,4,m.length,v.toFixed(2)+" ut",1-d*v/o._goodFps,(function(t){return m[t]/v-1})),o.status(e,298,C,j,4,a.length,x.toFixed(2)+" rt",1-x/o._goodFps,(function(t){return a[t]/x-1})),o.status(e,370,C,j,4,h.length,b.toFixed(2)+" x",b*b*b,(function(t){return(h[t]/s[t]/b||0)-1}))},o.status=function(t,e,i,o,r,s,a,h,c){t.strokeStyle="#888",t.fillStyle="#444",t.lineWidth=1,t.fillRect(e,i+7,o,1),t.beginPath(),t.moveTo(e,i+7-r*n.clamp(.4*c(0),-2,2));for(var l=0;l<o;l+=1)t.lineTo(e+l,i+7-(l<s?r*n.clamp(.4*c(l),-2,2):0));t.stroke(),t.fillStyle="hsl("+n.clamp(25+95*h,0,120)+",100%,60%)",t.fillRect(e,i-7,4,4),t.font="12px Arial",t.textBaseline="middle",t.textAlign="right",t.fillStyle="#eee",t.fillText(a,e+o,i-5)},o.constraints=function(t,e){for(var i=e,o=0;o<t.length;o++){var r=t[o];if(r.render.visible&&r.pointA&&r.pointB){var s,a,h=r.bodyA,l=r.bodyB;if(s=h?c.add(h.position,r.pointA):r.pointA,"pin"===r.render.type)i.beginPath(),i.arc(s.x,s.y,3,0,2*Math.PI),i.closePath();else{if(a=l?c.add(l.position,r.pointB):r.pointB,i.beginPath(),i.moveTo(s.x,s.y),"spring"===r.render.type)for(var u,m=c.sub(a,s),d=c.perp(c.normalise(m)),p=Math.ceil(n.clamp(r.length/5,12,20)),f=1;f<p;f+=1)u=f%2==0?1:-1,i.lineTo(s.x+m.x*(f/p)+d.x*u*4,s.y+m.y*(f/p)+d.y*u*4);i.lineTo(a.x,a.y)}r.render.lineWidth&&(i.lineWidth=r.render.lineWidth,i.strokeStyle=r.render.strokeStyle,i.stroke()),r.render.anchors&&(i.fillStyle=r.render.strokeStyle,i.beginPath(),i.arc(s.x,s.y,3,0,2*Math.PI),i.arc(a.x,a.y,3,0,2*Math.PI),i.closePath(),i.fill())}}},o.bodies=function(t,e,i){var o,r,n,s,a=i,h=(t.engine,t.options),c=h.showInternalEdges||!h.wireframes;for(n=0;n<e.length;n++)if((o=e[n]).render.visible)for(s=o.parts.length>1?1:0;s<o.parts.length;s++)if((r=o.parts[s]).render.visible){if(h.showSleeping&&o.isSleeping?a.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(a.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!h.wireframes){var l=r.render.sprite,u=p(t,l.texture);a.translate(r.position.x,r.position.y),a.rotate(r.angle),a.drawImage(u,u.width*-l.xOffset*l.xScale,u.height*-l.yOffset*l.yScale,u.width*l.xScale,u.height*l.yScale),a.rotate(-r.angle),a.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)a.beginPath(),a.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(r.vertices[0].x,r.vertices[0].y);for(var m=1;m<r.vertices.length;m++)!r.vertices[m-1].isInternal||c?a.lineTo(r.vertices[m].x,r.vertices[m].y):a.moveTo(r.vertices[m].x,r.vertices[m].y),r.vertices[m].isInternal&&!c&&a.moveTo(r.vertices[(m+1)%r.vertices.length].x,r.vertices[(m+1)%r.vertices.length].y);a.lineTo(r.vertices[0].x,r.vertices[0].y),a.closePath()}h.wireframes?(a.lineWidth=1,a.strokeStyle=t.options.wireframeStrokeStyle,a.stroke()):(a.fillStyle=r.render.fillStyle,r.render.lineWidth&&(a.lineWidth=r.render.lineWidth,a.strokeStyle=r.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},o.bodyWireframes=function(t,e,i){var o,r,n,s,a,h=i,c=t.options.showInternalEdges;for(h.beginPath(),n=0;n<e.length;n++)if((o=e[n]).render.visible)for(a=o.parts.length>1?1:0;a<o.parts.length;a++){for(r=o.parts[a],h.moveTo(r.vertices[0].x,r.vertices[0].y),s=1;s<r.vertices.length;s++)!r.vertices[s-1].isInternal||c?h.lineTo(r.vertices[s].x,r.vertices[s].y):h.moveTo(r.vertices[s].x,r.vertices[s].y),r.vertices[s].isInternal&&!c&&h.moveTo(r.vertices[(s+1)%r.vertices.length].x,r.vertices[(s+1)%r.vertices.length].y);h.lineTo(r.vertices[0].x,r.vertices[0].y)}h.lineWidth=1,h.strokeStyle=t.options.wireframeStrokeStyle,h.stroke()},o.bodyConvexHulls=function(t,e,i){var o,r,n,s=i;for(s.beginPath(),r=0;r<e.length;r++)if((o=e[r]).render.visible&&1!==o.parts.length){for(s.moveTo(o.vertices[0].x,o.vertices[0].y),n=1;n<o.vertices.length;n++)s.lineTo(o.vertices[n].x,o.vertices[n].y);s.lineTo(o.vertices[0].x,o.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},o.vertexNumbers=function(t,e,i){var o,r,n,s=i;for(o=0;o<e.length;o++){var a=e[o].parts;for(n=a.length>1?1:0;n<a.length;n++){var h=a[n];for(r=0;r<h.vertices.length;r++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(o+"_"+r,h.position.x+.8*(h.vertices[r].x-h.position.x),h.position.y+.8*(h.vertices[r].y-h.position.y))}}},o.mousePosition=function(t,e,i){var o=i;o.fillStyle="rgba(255,255,255,0.8)",o.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},o.bodyBounds=function(t,e,i){var o=i,r=(t.engine,t.options);o.beginPath();for(var n=0;n<e.length;n++)if(e[n].render.visible)for(var s=e[n].parts,a=s.length>1?1:0;a<s.length;a++){var h=s[a];o.rect(h.bounds.min.x,h.bounds.min.y,h.bounds.max.x-h.bounds.min.x,h.bounds.max.y-h.bounds.min.y)}r.wireframes?o.strokeStyle="rgba(255,255,255,0.08)":o.strokeStyle="rgba(0,0,0,0.1)",o.lineWidth=1,o.stroke()},o.bodyAxes=function(t,e,i){var o,r,n,s,a=i,h=(t.engine,t.options);for(a.beginPath(),r=0;r<e.length;r++){var c=e[r],l=c.parts;if(c.render.visible)if(h.showAxes)for(n=l.length>1?1:0;n<l.length;n++)for(o=l[n],s=0;s<o.axes.length;s++){var u=o.axes[s];a.moveTo(o.position.x,o.position.y),a.lineTo(o.position.x+20*u.x,o.position.y+20*u.y)}else for(n=l.length>1?1:0;n<l.length;n++)for(o=l[n],s=0;s<o.axes.length;s++)a.moveTo(o.position.x,o.position.y),a.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2)}h.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},o.bodyPositions=function(t,e,i){var o,r,n,s,a=i,h=(t.engine,t.options);for(a.beginPath(),n=0;n<e.length;n++)if((o=e[n]).render.visible)for(s=0;s<o.parts.length;s++)r=o.parts[s],a.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),a.closePath();for(h.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),n=0;n<e.length;n++)(o=e[n]).render.visible&&(a.arc(o.positionPrev.x,o.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},o.bodyVelocity=function(t,e,i){var o=i;o.beginPath();for(var n=0;n<e.length;n++){var s=e[n];if(s.render.visible){var a=r.getVelocity(s);o.moveTo(s.position.x,s.position.y),o.lineTo(s.position.x+a.x,s.position.y+a.y)}}o.lineWidth=3,o.strokeStyle="cornflowerblue",o.stroke()},o.bodyIds=function(t,e,i){var o,r,n=i;for(o=0;o<e.length;o++)if(e[o].render.visible){var s=e[o].parts;for(r=s.length>1?1:0;r<s.length;r++){var a=s[r];n.font="12px Arial",n.fillStyle="rgba(255,255,255,0.5)",n.fillText(a.id,a.position.x+10,a.position.y-10)}}},o.collisions=function(t,e,i){var o,r,n,s,a=i,h=t.options;for(a.beginPath(),n=0;n<e.length;n++)if((o=e[n]).isActive)for(r=o.collision,s=0;s<o.contactCount;s++){var c=o.contacts[s].vertex;a.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(h.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),n=0;n<e.length;n++)if((o=e[n]).isActive&&(r=o.collision,o.contactCount>0)){var l=o.contacts[0].vertex.x,u=o.contacts[0].vertex.y;2===o.contactCount&&(l=(o.contacts[0].vertex.x+o.contacts[1].vertex.x)/2,u=(o.contacts[0].vertex.y+o.contacts[1].vertex.y)/2),r.bodyB===r.supports[0].body||!0===r.bodyA.isStatic?a.moveTo(l-8*r.normal.x,u-8*r.normal.y):a.moveTo(l+8*r.normal.x,u+8*r.normal.y),a.lineTo(l,u)}h.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},o.separations=function(t,e,i){var o,r,n,s,a,h=i,c=t.options;for(h.beginPath(),a=0;a<e.length;a++)if((o=e[a]).isActive){n=(r=o.collision).bodyA;var l=1;(s=r.bodyB).isStatic||n.isStatic||(l=.5),s.isStatic&&(l=0),h.moveTo(s.position.x,s.position.y),h.lineTo(s.position.x-r.penetration.x*l,s.position.y-r.penetration.y*l),l=1,s.isStatic||n.isStatic||(l=.5),n.isStatic&&(l=0),h.moveTo(n.position.x,n.position.y),h.lineTo(n.position.x+r.penetration.x*l,n.position.y+r.penetration.y*l)}c.wireframes?h.strokeStyle="rgba(255,165,0,0.5)":h.strokeStyle="orange",h.stroke()},o.inspector=function(t,e){t.engine;var i,o=t.selected,r=t.render,n=r.options;if(n.hasBounds){var s=r.bounds.max.x-r.bounds.min.x,a=r.bounds.max.y-r.bounds.min.y,h=s/r.options.width,c=a/r.options.height;e.scale(1/h,1/c),e.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var l=0;l<o.length;l++){var u=o[l].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":i=u.bounds,e.beginPath(),e.rect(Math.floor(i.min.x-3),Math.floor(i.min.y-3),Math.floor(i.max.x-i.min.x+6),Math.floor(i.max.y-i.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var m=u.pointA;u.bodyA&&(m=u.pointB),e.beginPath(),e.arc(m.x,m.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",i=t.selectBounds,e.beginPath(),e.rect(Math.floor(i.min.x),Math.floor(i.min.y),Math.floor(i.max.x-i.min.x),Math.floor(i.max.y-i.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),n.hasBounds&&e.setTransform(1,0,0,1,0,0)};var i=function(t,e){var i=t.engine,r=t.timing,n=r.historySize,s=i.timing.timestamp;r.delta=e-r.lastTime||o._goodDelta,r.lastTime=e,r.timestampElapsed=s-r.lastTimestamp||0,r.lastTimestamp=s,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,n),r.engineDeltaHistory.unshift(i.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,n),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,n),r.engineUpdatesHistory.unshift(i.timing.lastUpdatesPerFrame),r.engineUpdatesHistory.length=Math.min(r.engineUpdatesHistory.length,n),r.engineElapsedHistory.unshift(i.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,n),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,n)},u=function(t){for(var e=0,i=0;i<t.length;i+=1)e+=t[i];return e/t.length||0},m=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i},d=function(t){var e=t.getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},p=function(t,e){var i=t.textures[e];return i||((i=t.textures[e]=new Image).src=e,i)},f=function(t,e){var i=e;/(jpg|gif|png)$/.test(e)&&(i="url("+e+")"),t.canvas.style.background=i,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},function(t,e,i){var o={};t.exports=o;var r=i(5),n=i(17),s=i(0);!function(){o._maxFrameDelta=1e3/15,o._frameDeltaFallback=1e3/60,o._timeBufferMargin=1.5,o._elapsedNextEstimate=1,o._smoothingLowerBound=.1,o._smoothingUpperBound=.9,o.create=function(t){var e=s.extend({delta:1e3/60,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:1e3/30,lastUpdatesDeferred:0,enabled:!0},t);return e.fps=0,e},o.run=function(t,e){return t.timeBuffer=o._frameDeltaFallback,function i(r){t.frameRequestId=o._onNextFrame(t,i),r&&t.enabled&&o.tick(t,e,r)}(),t},o.tick=function(e,i,a){var h=s.now(),c=e.delta,l=0,u=a-e.timeLastTick;if((!u||!e.timeLastTick||u>Math.max(o._maxFrameDelta,e.maxFrameTime))&&(u=e.frameDelta||o._frameDeltaFallback),e.frameDeltaSmoothing){e.frameDeltaHistory.push(u),e.frameDeltaHistory=e.frameDeltaHistory.slice(-e.frameDeltaHistorySize);var m=e.frameDeltaHistory.slice(0).sort(),d=e.frameDeltaHistory.slice(m.length*o._smoothingLowerBound,m.length*o._smoothingUpperBound);u=t(d)||u}e.frameDeltaSnapping&&(u=1e3/Math.round(1e3/u)),e.frameDelta=u,e.timeLastTick=a,e.timeBuffer+=e.frameDelta,e.timeBuffer=s.clamp(e.timeBuffer,0,e.frameDelta+c*o._timeBufferMargin),e.lastUpdatesDeferred=0;var p=e.maxUpdates||Math.ceil(e.maxFrameTime/c),f={timestamp:i.timing.timestamp};r.trigger(e,"beforeTick",f),r.trigger(e,"tick",f);for(var x=s.now();c>0&&e.timeBuffer>=c*o._timeBufferMargin;){r.trigger(e,"beforeUpdate",f),n.update(i,c),r.trigger(e,"afterUpdate",f),e.timeBuffer-=c,l+=1;var y=s.now()-h,g=s.now()-x,v=y+o._elapsedNextEstimate*g/l;if(l>=p||v>e.maxFrameTime){e.lastUpdatesDeferred=Math.round(Math.max(0,e.timeBuffer/c-o._timeBufferMargin));break}}i.timing.lastUpdatesPerFrame=l,r.trigger(e,"afterTick",f),e.frameDeltaHistory.length>=100&&(e.lastUpdatesDeferred&&Math.round(e.frameDelta/c)>p?s.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):e.lastUpdatesDeferred&&s.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),void 0!==e.isFixed&&s.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(e.deltaMin||e.deltaMax)&&s.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),0!==e.fps&&s.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},o.stop=function(t){o._cancelNextFrame(t)},o._onNextFrame=function(t,e){if("undefined"==typeof window||!window.requestAnimationFrame)throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return t.frameRequestId=window.requestAnimationFrame(e),t.frameRequestId},o._cancelNextFrame=function(t){if("undefined"==typeof window||!window.cancelAnimationFrame)throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.");window.cancelAnimationFrame(t.frameRequestId)};var t=function(t){for(var e=0,i=t.length,o=0;o<i;o+=1)e+=t[o];return e/i||0}}()},function(t,e,i){var o={};t.exports=o;var r=i(8),n=i(0).deprecated;o.collides=function(t,e){return r.collides(t,e)},n(o,"collides","SAT.collides ➤ replaced by Collision.collides")},function(t,e,i){var o={};t.exports=o,i(1);var r=i(0);o.pathToVertices=function(t,e){"undefined"==typeof window||"SVGPathSeg"in window||r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var i,n,s,a,h,c,l,u,m,d,p,f=[],x=0,y=0,g=0;e=e||15;var v=function(t,e,i){var o=i%2==1&&i>1;if(!m||t!=m.x||e!=m.y){m&&o?(d=m.x,p=m.y):(d=0,p=0);var r={x:d+t,y:p+e};!o&&m||(m=r),f.push(r),y=d+t,g=p+e}},b=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":y=t.x,g=t.y;break;case"H":y=t.x;break;case"V":g=t.y}v(y,g,t.pathSegType)}};for(o._svgPathToAbsolute(t),s=t.getTotalLength(),c=[],i=0;i<t.pathSegList.numberOfItems;i+=1)c.push(t.pathSegList.getItem(i));for(l=c.concat();x<s;){if((h=c[t.getPathSegAtLength(x)])!=u){for(;l.length&&l[0]!=h;)b(l.shift());u=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=t.getPointAtLength(x),v(a.x,a.y,0)}x+=e}for(i=0,n=l.length;i<n;++i)b(l[i]);return f},o._svgPathToAbsolute=function(t){for(var e,i,o,r,n,s,a=t.pathSegList,h=0,c=0,l=a.numberOfItems,u=0;u<l;++u){var m=a.getItem(u),d=m.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(d))"x"in m&&(h=m.x),"y"in m&&(c=m.y);else switch("x1"in m&&(o=h+m.x1),"x2"in m&&(n=h+m.x2),"y1"in m&&(r=c+m.y1),"y2"in m&&(s=c+m.y2),"x"in m&&(h+=m.x),"y"in m&&(c+=m.y),d){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(h,c),u);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(h,c),u);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(h),u);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(c),u);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(h,c,o,r,n,s),u);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(h,c,n,s),u);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(h,c,o,r),u);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(h,c),u);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(h,c,m.r1,m.r2,m.angle,m.largeArcFlag,m.sweepFlag),u);break;case"z":case"Z":h=e,c=i}"M"!=d&&"m"!=d||(e=h,i=c)}}},function(t,e,i){var o={};t.exports=o;var r=i(6);i(0),o.create=r.create,o.add=r.add,o.remove=r.remove,o.clear=r.clear,o.addComposite=r.addComposite,o.addBody=r.addBody,o.addConstraint=r.addConstraint}])},t.exports=o()},3379:t=>{"use strict";var e=[];function i(t){for(var i=-1,o=0;o<e.length;o++)if(e[o].identifier===t){i=o;break}return i}function o(t,o){for(var n={},s=[],a=0;a<t.length;a++){var h=t[a],c=o.base?h[0]+o.base:h[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var m=i(u),d={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==m)e[m].references++,e[m].updater(d);else{var p=r(d,o);o.byIndex=a,e.splice(a,0,{identifier:u,updater:p,references:1})}s.push(u)}return s}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var n=o(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<n.length;s++){var a=i(n[s]);e[a].references--}for(var h=o(t,r),c=0;c<n.length;c++){var l=i(n[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}n=h}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var o=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(i)}},9216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var o="";i.supports&&(o+="@supports (".concat(i.supports,") {")),i.media&&(o+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(o+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),o+=i.css,r&&(o+="}"),i.media&&(o+="}"),i.supports&&(o+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1285:(t,e,i)=>{"use strict";t.exports=i.p+"cce12025cc74c4a3f237.png"},2485:(t,e,i)=>{"use strict";t.exports=i.p+"5211260c15f95de001ff.png"},4078:(t,e,i)=>{"use strict";t.exports=i.p+"8e76aee714043ed30ee6.png"},7237:(t,e,i)=>{"use strict";t.exports=i.p+"450dfab3a8956394b066.png"},2068:(t,e,i)=>{"use strict";t.exports=i.p+"5bf04c075d73df18fb50.png"},5876:(t,e,i)=>{"use strict";t.exports=i.p+"61b8f94c3d10dc51cc0c.png"},1957:(t,e,i)=>{"use strict";t.exports=i.p+"34cdc41d99d105216922.png"},5454:(t,e,i)=>{"use strict";t.exports=i.p+"d7e612ab999575bf86a4.png"},6938:(t,e,i)=>{"use strict";t.exports=i.p+"61878ed1e693b942ff2f.png"},217:(t,e,i)=>{"use strict";t.exports=i.p+"7a775b8d177c36216f96.png"},1610:(t,e,i)=>{"use strict";t.exports=i.p+"7dbc68c8a6e4ad80dd1d.png"},4709:(t,e,i)=>{"use strict";t.exports=i.p+"9933a950b70bac46608d.png"},1846:(t,e,i)=>{"use strict";t.exports=i.p+"e31776e18938024b046a.png"},9163:(t,e,i)=>{"use strict";t.exports=i.p+"aa7de138ef8bb463460a.png"}},e={};function i(o){var r=e[o];if(void 0!==r)return r.exports;var n=e[o]={id:o,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&!t;)t=o[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),i.nc=void 0,(()=>{"use strict";class t{framebuffer;constructor(t){this.framebuffer=t}drawScaledTextureClip(t,e,i,o,r,n){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.framebuffer.height-1||t+i<0||t>this.framebuffer.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.framebuffer.height,0),l=0):(l=e,h=o-Math.max(e+o-this.framebuffer.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.framebuffer.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.framebuffer.width,0));const f=1/255*n;let x=u+l*this.framebuffer.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){const t=(0|d)+(0|p)*r.width,e=(r.texture[t]>>24&255)*f,i=1-e,o=this.framebuffer.framebuffer[x],n=r.texture[t],a=(o>>0&255)*i+(n>>0&255)*e,h=(o>>8&255)*i+(n>>8&255)*e,c=(o>>16&255)*i+(n>>16&255)*e;this.framebuffer.framebuffer[x]=a|h<<8|c<<16|255<<24,d+=s,x++}p+=a,d=m,x+=-c+this.framebuffer.width}}}class e{r;g;b;a;static BLACK=new e(0,0,0,255);static WHITE=new e(255,255,255,255);static RED=new e(255,0,0,255);static GREEN=new e(0,255,0,255);static LIME=new e(0,255,0,255);static BLUE=new e(0,0,255,255);static DARK_BLUE=new e(0,0,64,255);static YELLOW=new e(255,255,0,255);static CYAN=new e(0,255,255,255);static MAGENTA=new e(255,0,255,255);static SLATE_GRAY=new e(112,128,144,255);static DARK_GRAY=new e(19,19,20,255);static ORANGE=new e(255,160,122);constructor(t=0,e=0,i=0,o=255){this.r=t,this.g=e,this.b=i,this.a=o}toPackedFormat(){return this.r|this.g<<8|this.b<<16|this.a<<24}sub(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,255)}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,255)}div(t){return new e(this.r/t,this.g/t,this.b/t,255)}mul(t){return new e(this.r*t,this.g*t,this.b*t,255)}}var o;!function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.DISABLED=2]="DISABLED"}(o||(o={}));class r{x;y;z;w;constructor(t,e,i,o=1){this.x=t,this.y=e,this.z=i,this.w=o}sub(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}cross(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,0)}normalize(){const t=1/this.length();return this.mul(t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}sub2(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}add2(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}mul(t){return new r(this.x*t,this.y*t,this.z*t,this.w)}componentWiseMul(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross2(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}normalize2(){const t=1/this.length();this.x*=t,this.y*=t,this.z*=t}}class n{mesh;inverse;buildMesh(t,e,i=!1){this.inverse=i;const o=new Array;for(let i=0;i<e.length;i+=3){const r=t[e[i+1]].sub(t[e[i]]).cross(t[e[i+2]].sub(t[e[i]]));o.push(this.inverse?r.normalize().mul(-1):r.normalize())}const n=new Array;for(let t=0;t<e.length;t+=3)n.push({n1:t/3,n2:t/3,n3:t/3,v1:e[0+t],v2:e[1+t],v3:e[2+t]});this.mesh={points:t,normals:o,faces:n,transformedPoints:t.map((()=>new r(0,0,0,0))),transformedNormals:o.map((()=>new r(0,0,0,0)))}}getMesh(){return this.mesh}}class s{x;y;z;constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}mult(t){return new s(this.x*t,this.y*t,this.z*t)}sub(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}sub2(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}mul(t){return new s(this.x*t,this.y*t,this.z*t)}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}add2(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}cross(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}cross2(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const t=1/this.length();return this.mul(t)}normalize2(){const t=1/this.length();this.x*=t,this.y*=t,this.z*=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}class a extends n{constructor(t=!1){super();const e=[],i=12;this.inverse=t;for(let t=0;t<15;t++){const o=this.torusFunction(2*t*Math.PI/15),n=this.torusFunction(2*t*Math.PI/15+.1),a=new s(0,4,0),h=n.sub(o).cross(a);for(let t=0;t<i;t++){const n=a.mul(Math.sin(2*t*Math.PI/i)).add(h.mul(Math.cos(2*t*Math.PI/i))).add(o);e.push(new r(n.x,n.y,n.z,1))}}const o=[];for(let t=0;t<15;t++)for(let r=0;r<i;r++)o.push((i*t+(1+r)%i)%e.length),o.push((i*t+(0+r)%i)%e.length),o.push((i*t+i+(1+r)%i)%e.length),o.push((i*t+i+(0+r)%i)%e.length),o.push((i*t+i+(1+r)%i)%e.length),o.push((i*t+(0+r)%i)%e.length);this.buildMesh(e,o)}torusFunction(t){return new s(10*Math.sin(t),0,10*Math.cos(t))}}class h{x;y;constructor(t,e){this.x=t,this.y=e}perp(){return new h(-this.y,this.x)}sub(t){return new h(this.x-t.x,this.y-t.y)}mul(t){return new h(this.x*t,this.y*t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=1/this.length();return this.mul(t)}dot(t){return this.x*t.x+this.y*t.y}}class c{m11;m12;m13;m14;m21;m22;m23;m24;m31;m32;m33;m34;m41;m42;m43;m44;static constructIdentityMatrix(){const t=new c;return t.m11=1,t.m12=0,t.m13=0,t.m14=0,t.m21=0,t.m22=1,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m33=1,t.m34=0,t.m41=0,t.m42=0,t.m43=0,t.m44=1,t}setIdentityMatrix(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}transpose(){const t=new c;return t.m11=this.m11,t.m12=this.m21,t.m13=this.m31,t.m14=this.m41,t.m21=this.m12,t.m22=this.m22,t.m23=this.m32,t.m24=this.m42,t.m31=this.m13,t.m32=this.m23,t.m33=this.m33,t.m34=this.m43,t.m41=this.m14,t.m42=this.m24,t.m43=this.m34,t.m44=this.m44,t}computeNormalMatrix(){return this.inverse().transpose()}inverse(){const t=c.constructIdentityMatrix();t.m14=-this.m14,t.m24=-this.m24,t.m34=-this.m34;const e=1/Math.sqrt(this.m11*this.m11+this.m12*this.m12+this.m13*this.m13),i=1/Math.sqrt(this.m21*this.m21+this.m22*this.m22+this.m23*this.m23),o=1/Math.sqrt(this.m31*this.m31+this.m32*this.m32+this.m33*this.m33),r=c.constructIdentityMatrix();return r.m11=this.m11*e,r.m21=this.m12*e,r.m31=this.m13*e,r.m12=this.m21*i,r.m22=this.m22*i,r.m32=this.m23*i,r.m13=this.m31*o,r.m23=this.m32*o,r.m33=this.m33*o,r.multiplyMatrix(t)}getInverseRotation(){const t=c.constructIdentityMatrix();return t.m11=1*this.m11,t.m21=1*this.m12,t.m31=1*this.m13,t.m12=1*this.m21,t.m22=1*this.m22,t.m32=1*this.m23,t.m13=1*this.m31,t.m23=1*this.m32,t.m33=1*this.m33,t}getRotation(){const t=c.constructIdentityMatrix();return t.m11=this.m11,t.m21=this.m21,t.m31=this.m31,t.m12=this.m12,t.m22=this.m22,t.m32=this.m32,t.m13=this.m13,t.m23=this.m23,t.m33=this.m33,t}static constructShadowMatrix(){const t=new s(0,-1.5,0),e=new s(0,1,0),i=new s(0,11,0),o=-t.dot(e),r=e.x*i.x+e.y*i.y+e.z*i.z,n=new c;return n.m11=r+o-i.x*e.x,n.m12=-i.x*e.y,n.m13=-i.x*e.z,n.m14=-i.x*o,n.m21=-i.y*e.x,n.m22=r+o-i.y*e.y,n.m23=-i.y*e.z,n.m24=-i.y*o,n.m31=-i.z*e.x,n.m32=-i.z*e.y,n.m33=r+o-i.z*e.z,n.m34=-i.z*o,n.m41=-e.x,n.m42=-e.y,n.m43=-e.z,n.m44=r,n}static constructTranslationMatrix(t,e,i){const o=new c;return o.m11=1,o.m12=0,o.m13=0,o.m14=t,o.m21=0,o.m22=1,o.m23=0,o.m24=e,o.m31=0,o.m32=0,o.m33=1,o.m34=i,o.m41=0,o.m42=0,o.m43=0,o.m44=1,o}setTranslationMatrix(t,e,i){this.m11=1,this.m12=0,this.m13=0,this.m14=t,this.m21=0,this.m22=1,this.m23=0,this.m24=e,this.m31=0,this.m32=0,this.m33=1,this.m34=i,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructXRotationMatrix(t){const e=new c;return e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=Math.cos(t),e.m23=-Math.sin(t),e.m24=0,e.m31=0,e.m32=Math.sin(t),e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}setXRotationMatrix(t){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=Math.cos(t),this.m23=-Math.sin(t),this.m24=0,this.m31=0,this.m32=Math.sin(t),this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setZRotationMatrix(t){this.m11=Math.cos(t),this.m12=-Math.sin(t),this.m13=0,this.m14=0,this.m21=Math.sin(t),this.m22=Math.cos(t),this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setScaleMatrix(t,e,i){this.m11=t,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=e,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=i,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setYRotationMatrix(t){this.m11=Math.cos(t),this.m12=0,this.m13=Math.sin(t),this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=-Math.sin(t),this.m32=0,this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setRotationMatrix(t,e,i,o){const r=Math.cos(2*Math.PI*o/360),n=Math.sin(2*Math.PI*o/360),a=new s(t,e,i);a.normalize2(),this.m11=(1-r)*a.x*a.x+r,this.m12=(1-r)*a.x*a.y-n*a.z,this.m13=(1-r)*a.x*a.z+n*a.y,this.m14=0,this.m21=(1-r)*a.x*a.y+n*a.z,this.m22=(1-r)*a.y*a.y+r,this.m23=(1-r)*a.y*a.z-n*a.x,this.m24=0,this.m31=(1-r)*a.x*a.z-n*a.y,this.m32=(1-r)*a.y*a.z+n*a.x,this.m33=(1-r)*a.z*a.z+r,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructYRotationMatrix(t){const e=new c;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructZRotationMatrix(t){const e=new c;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m14=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructScaleMatrix(t,e=t,i=e){const o=new c;return o.m11=t,o.m12=0,o.m13=0,o.m14=0,o.m21=0,o.m22=e,o.m23=0,o.m24=0,o.m31=0,o.m32=0,o.m33=i,o.m34=0,o.m41=0,o.m42=0,o.m43=0,o.m44=1,o}multiplyMatrix(t){const e=new c;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31+this.m14*t.m41,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31+this.m24*t.m41,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31+this.m34*t.m41,e.m41=this.m41*t.m11+this.m42*t.m21+this.m43*t.m31+this.m44*t.m41,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32+this.m14*t.m42,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32+this.m24*t.m42,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32+this.m34*t.m42,e.m42=this.m41*t.m12+this.m42*t.m22+this.m43*t.m32+this.m44*t.m42,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33+this.m14*t.m43,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33+this.m24*t.m43,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33+this.m34*t.m43,e.m43=this.m41*t.m13+this.m42*t.m23+this.m43*t.m33+this.m44*t.m43,e.m14=this.m11*t.m14+this.m12*t.m24+this.m13*t.m34+this.m14*t.m44,e.m24=this.m21*t.m14+this.m22*t.m24+this.m23*t.m34+this.m24*t.m44,e.m34=this.m31*t.m14+this.m32*t.m24+this.m33*t.m34+this.m34*t.m44,e.m44=this.m41*t.m14+this.m42*t.m24+this.m43*t.m34+this.m44*t.m44,e}multiply2(t,e){this.m11=t.m11*e.m11+t.m12*e.m21+t.m13*e.m31+t.m14*e.m41,this.m21=t.m21*e.m11+t.m22*e.m21+t.m23*e.m31+t.m24*e.m41,this.m31=t.m31*e.m11+t.m32*e.m21+t.m33*e.m31+t.m34*e.m41,this.m41=t.m41*e.m11+t.m42*e.m21+t.m43*e.m31+t.m44*e.m41,this.m12=t.m11*e.m12+t.m12*e.m22+t.m13*e.m32+t.m14*e.m42,this.m22=t.m21*e.m12+t.m22*e.m22+t.m23*e.m32+t.m24*e.m42,this.m32=t.m31*e.m12+t.m32*e.m22+t.m33*e.m32+t.m34*e.m42,this.m42=t.m41*e.m12+t.m42*e.m22+t.m43*e.m32+t.m44*e.m42,this.m13=t.m11*e.m13+t.m12*e.m23+t.m13*e.m33+t.m14*e.m43,this.m23=t.m21*e.m13+t.m22*e.m23+t.m23*e.m33+t.m24*e.m43,this.m33=t.m31*e.m13+t.m32*e.m23+t.m33*e.m33+t.m34*e.m43,this.m43=t.m41*e.m13+t.m42*e.m23+t.m43*e.m33+t.m44*e.m43,this.m14=t.m11*e.m14+t.m12*e.m24+t.m13*e.m34+t.m14*e.m44,this.m24=t.m21*e.m14+t.m22*e.m24+t.m23*e.m34+t.m24*e.m44,this.m34=t.m31*e.m14+t.m32*e.m24+t.m33*e.m34+t.m34*e.m44,this.m44=t.m41*e.m14+t.m42*e.m24+t.m43*e.m34+t.m44*e.m44}multiply(t){return new s(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34)}multiplyHom(t){return new r(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w)}multiplyHomArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w}multiplyHomArr2(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,e.w=this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w,e.x/=e.w,e.y/=e.w,e.z/=e.w}multiplyArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34}}class l{m11;m12;m13;m21;m22;m23;m31;m32;m33;static constructXRotationMatrix(t){const e=new l,i=Math.cos(t),o=Math.sin(t);return e.m11=1,e.m12=0,e.m13=0,e.m21=0,e.m22=i,e.m23=-o,e.m31=0,e.m32=o,e.m33=i,e}static constructYRotationMatrix(t){const e=new l;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m21=0,e.m22=1,e.m23=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e}static constructZRotationMatrix(t){const e=new l;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m31=0,e.m32=0,e.m33=1,e}static constructScaleMatrix(t,e,i){const o=new l;return o.m11=t,o.m12=0,o.m13=0,o.m21=0,o.m22=e,o.m23=0,o.m31=0,o.m32=0,o.m33=i,o}multiplyMatrix(t){const e=new l;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33,e}multiply(t){return new s(this.m11*t.x+this.m12*t.y+this.m13*t.z,this.m21*t.x+this.m22*t.y+this.m23*t.z,this.m31*t.x+this.m32*t.y+this.m33*t.z)}}class u{static interpolate(t,e,i){return i<=t?0:i>=e?1:(i-t)/(e-t)}static cosineInterpolate(t,e,i){if(i<=t)return 0;if(i>=e)return 1;const o=(i-t)/(e-t);return(1-Math.cos(o*Math.PI))/2}}class m{seed;constructor(){this.seed=6}getFloat(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}setSeed(t){this.seed=t}}class d{}class p extends d{temp=null;drawTriangleDDA(t,e,i,o){e.projection.y>o.projection.y&&(this.temp=e,e=o,o=this.temp),e.projection.y>i.projection.y&&(this.temp=e,e=i,i=this.temp),i.projection.y>o.projection.y&&(this.temp=i,i=o,o=this.temp),e.projection.y!==o.projection.y&&((o.projection.x-e.projection.x)*(i.projection.y-e.projection.y)/(o.projection.y-e.projection.y)+e.projection.x>i.projection.x?this.fillLongRightTriangle(t,e,i,o):this.fillLongLeftTriangle(t,e,i,o))}}class f extends p{framebuffer;slope1;slope2;zslope1;zslope2;curz1;curz2;xPosition;xPosition2;yPosition;constructor(t){super(),this.framebuffer=t}fillLongRightTriangle(t,e,i,o){const r=e.color.toPackedFormat();let n=i.projection.y-e.projection.y;const s=o.projection.y-e.projection.y;this.slope1=(i.projection.x-e.projection.x)/n,this.slope2=(o.projection.x-e.projection.x)/s,this.zslope1=(1/i.projection.z-1/e.projection.z)/n,this.zslope2=(1/o.projection.z-1/e.projection.z)/s,this.curz1=1/e.projection.z,this.curz2=1/e.projection.z,this.xPosition=e.projection.x,this.xPosition2=e.projection.x,this.yPosition=e.projection.y,this.drawSpan(t,n,r),n=o.projection.y-i.projection.y,this.slope1=(o.projection.x-i.projection.x)/n,this.zslope1=(1/o.projection.z-1/i.projection.z)/n,this.xPosition=i.projection.x,this.yPosition=i.projection.y,this.drawSpan(t,n,r)}fillLongLeftTriangle(t,e,i,o){const r=e.color.toPackedFormat();let n=i.projection.y-e.projection.y;const s=o.projection.y-e.projection.y;this.slope2=(i.projection.x-e.projection.x)/n,this.slope1=(o.projection.x-e.projection.x)/s,this.zslope2=(1/i.projection.z-1/e.projection.z)/n,this.zslope1=(1/o.projection.z-1/e.projection.z)/s,this.curz1=1/e.projection.z,this.curz2=1/e.projection.z,this.xPosition=e.projection.x,this.xPosition2=e.projection.x,this.yPosition=e.projection.y,this.drawSpan(t,n,r),n=o.projection.y-i.projection.y,this.slope2=(o.projection.x-i.projection.x)/n,this.zslope2=(1/o.projection.z-1/i.projection.z)/n,this.curz2=1/i.projection.z,this.xPosition2=i.projection.x,this.yPosition=i.projection.y,this.drawSpan(t,n,r)}drawSpan(t,e,i){for(let o=0;o<e;o++){const e=this.xPosition2-this.xPosition,o=Math.round(this.curz2-this.curz1)/e;let r=this.curz1;for(let n=0;n<e;n++){const e=Math.round(this.yPosition)*t.width+Math.round(this.xPosition+n);r<t.wBuffer[e]&&(t.wBuffer[e]=r,t.framebuffer[e]=i),r+=o}this.xPosition+=this.slope1,this.xPosition2+=this.slope2,this.yPosition++,this.curz1+=this.zslope1,this.curz2+=this.zslope2}}}class x{framebuffer;constructor(t){this.framebuffer=t}drawLineDDA(t,e,i){const o=e.x-t.x,r=e.y-t.y;let n,s,a;Math.abs(o)>Math.abs(r)?(n=Math.sign(o),s=r/Math.abs(o),a=Math.abs(o)):(n=o/Math.abs(r),s=Math.sign(r),a=Math.abs(r));let h=t.x,c=t.y,l=1/t.z;const u=(1/e.z-1/t.z)/a;for(let t=0;t<=a;t++)l<this.framebuffer.wBuffer[Math.round(h)+Math.round(c)*this.framebuffer.width]&&(this.framebuffer.wBuffer[Math.round(h)+Math.round(c)*this.framebuffer.width]=l,this.framebuffer.drawPixel(Math.round(h),Math.round(c),i)),h+=n,c+=s,l+=u}}class y{framebuffer;constructor(t){this.framebuffer=t}drawLineDDANoZ(t,e,i){const o=e.x-t.x,r=e.y-t.y;let n,s,a;Math.abs(o)>Math.abs(r)?(n=Math.sign(o),s=r/Math.abs(o),a=Math.abs(o)):(n=o/Math.abs(r),s=Math.sign(r),a=Math.abs(r));let h=t.x,c=t.y;for(let t=0;t<=a;t++)this.framebuffer.drawPixel(Math.round(h),Math.round(c),i),h+=n,c+=s}}class g extends p{framebuffer;constructor(t){super(),this.framebuffer=t}fillLongRightTriangle(t,e,i,o){let r=i.projection.y-e.projection.y,n=(i.projection.x-e.projection.x)/r,s=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/r,a=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/r,h=(1/i.projection.z-1/e.projection.z)/r,c=1/e.projection.z,l=e.textureCoordinate.u/e.projection.z,u=e.textureCoordinate.v/e.projection.z,m=e.projection.x;const d=o.projection.y-e.projection.y,p=(o.projection.x-e.projection.x)/d,f=(o.textureCoordinate.u/o.projection.z-e.textureCoordinate.u/e.projection.z)/d,x=(o.textureCoordinate.v/o.projection.z-e.textureCoordinate.v/e.projection.z)/d,y=(1/o.projection.z-1/e.projection.z)/d;let g=1/e.projection.z,v=e.textureCoordinate.u/e.projection.z,b=e.textureCoordinate.v/e.projection.z,w=e.projection.x,M=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(m);let i=Math.round(M)*t.width+Math.round(m);const o=(g-c)/e,r=(v-l)/e,d=(b-u)/e;let j=c,C=l,P=u;for(let n=0;n<e;n++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),r=0|Math.max(Math.min(P*e*t.bob.height,t.bob.height-1),0),n=t.bob.texture[o+r*t.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),t.framebuffer[i]=n}i++,j+=o,C+=r,P+=d}m+=n,w+=p,M++,c+=h,g+=y,l+=s,v+=f,u+=a,b+=x}if(r=o.projection.y-i.projection.y,0!==r){n=(o.projection.x-i.projection.x)/r,h=(1/o.projection.z-1/i.projection.z)/r,s=(o.textureCoordinate.u/o.projection.z-i.textureCoordinate.u/i.projection.z)/r,a=(o.textureCoordinate.v/o.projection.z-i.textureCoordinate.v/i.projection.z)/r,c=1/i.projection.z,l=i.textureCoordinate.u/i.projection.z,u=i.textureCoordinate.v/i.projection.z,m=i.projection.x,M=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(m);let i=Math.round(M)*t.width+Math.round(m);const o=(g-c)/e,r=(v-l)/e,d=(b-u)/e;let j=c,C=l,P=u;for(let n=0;n<e;n++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),r=0|Math.max(Math.min(P*e*t.bob.height,t.bob.height-1),0),n=t.bob.texture[o+r*t.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),t.framebuffer[i]=n}i++,j+=o,C+=r,P+=d}m+=n,w+=p,M++,c+=h,g+=y,l+=s,v+=f,u+=a,b+=x}}}fillLongLeftTriangle(t,e,i,o){let r=i.projection.y-e.projection.y;const n=o.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/r;const a=(o.projection.x-e.projection.x)/n,h=(o.textureCoordinate.u/o.projection.z-e.textureCoordinate.u/e.projection.z)/n;let c=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/r;const l=(o.textureCoordinate.v/o.projection.z-e.textureCoordinate.v/e.projection.z)/n;let u=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/r,m=(1/i.projection.z-1/e.projection.z)/r;const d=(1/o.projection.z-1/e.projection.z)/n;let p=1/e.projection.z,f=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*t.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),r=0|Math.max(Math.min(P*e*t.bob.height,t.bob.height-1),0),n=t.bob.texture[o+r*t.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),t.framebuffer[i]=n}i++,j+=o,C+=r,P+=n}b+=a,w+=s,M++,p+=d,f+=m,x+=h,g+=c,y+=l,v+=u}r=o.projection.y-i.projection.y,s=(o.projection.x-i.projection.x)/r,m=(1/o.projection.z-1/i.projection.z)/r,c=(o.textureCoordinate.u/o.projection.z-i.textureCoordinate.u/i.projection.z)/r,u=(o.textureCoordinate.v/o.projection.z-i.textureCoordinate.v/i.projection.z)/r,f=1/i.projection.z,g=i.textureCoordinate.u/i.projection.z,v=i.textureCoordinate.v/i.projection.z,w=i.projection.x,M=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*t.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),r=0|Math.max(Math.min(P*e*t.bob.height,t.bob.height-1),0),n=t.bob.texture[o+r*t.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),t.framebuffer[i]=n}i++,j+=o,C+=r,P+=n}b+=a,w+=s,M++,p+=d,f+=m,x+=h,g+=c,y+=l,v+=u}}}class v extends p{framebuffer;pipeline;constructor(t,e){super(),this.framebuffer=t,this.pipeline=e}fillLongRightTriangle(t,e,i,o){let r=i.projection.y-e.projection.y;const n=o.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/r;const a=(o.projection.x-e.projection.x)/n;let h=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/r;const c=(o.textureCoordinate.u/o.projection.z-e.textureCoordinate.u/e.projection.z)/n;let l=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/r;const u=(o.textureCoordinate.v/o.projection.z-e.textureCoordinate.v/e.projection.z)/n;let m=(1/i.projection.z-1/e.projection.z)/r;const d=(1/o.projection.z-1/e.projection.z)/n;let p=1/e.projection.z,f=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){const e=this.framebuffer.framebuffer[i];if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const o=1/j;let r=0|Math.max(Math.min(C*o*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),n=0|Math.max(Math.min(P*o*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),s=this.framebuffer.bob.texture[r+n*this.framebuffer.bob.width];r=C*o*(t.bob.width-1),n=P*o*(t.bob.height-1),s=t.bob.getBilinearFilteredPixelRasterizer(r,n);const a=this.pipeline.alpha*(s>>24&255)/255,h=1-a,c=(e>>0&255)*h+(s>>0&255)*a,l=(e>>8&255)*h+(s>>8&255)*a,u=(e>>16&255)*h+(s>>16&255)*a;this.framebuffer.framebuffer[i]=c|l<<8|u<<16|255<<24}i++,j+=o,C+=r,P+=n}b+=s,w+=a,M++,p+=m,f+=d,x+=h,g+=c,y+=l,v+=u}if(r=o.projection.y-i.projection.y,0!==r){s=(o.projection.x-i.projection.x)/r,m=(1/o.projection.z-1/i.projection.z)/r,h=(o.textureCoordinate.u/o.projection.z-i.textureCoordinate.u/i.projection.z)/r,l=(o.textureCoordinate.v/o.projection.z-i.textureCoordinate.v/i.projection.z)/r,p=1/i.projection.z,x=i.textureCoordinate.u/i.projection.z,y=i.textureCoordinate.v/i.projection.z,b=i.projection.x,M=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(P*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),n=this.framebuffer.bob.texture[o+r*this.framebuffer.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),n=t.bob.getBilinearFilteredPixelRasterizer(o,r);const s=this.pipeline.alpha*(n>>24&255)/255,a=1-s,h=(this.framebuffer.framebuffer[i]>>0&255)*a+(n>>0&255)*s,c=(this.framebuffer.framebuffer[i]>>8&255)*a+(n>>8&255)*s,l=(this.framebuffer.framebuffer[i]>>16&255)*a+(n>>16&255)*s;this.framebuffer.framebuffer[i]=h|c<<8|l<<16|255<<24}i++,j+=o,C+=r,P+=n}b+=s,w+=a,M++,p+=m,f+=d,x+=h,g+=c,y+=l,v+=u}}}fillLongLeftTriangle(t,e,i,o){let r=i.projection.y-e.projection.y;const n=o.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/r;const a=(o.projection.x-e.projection.x)/n,h=(o.textureCoordinate.u/o.projection.z-e.textureCoordinate.u/e.projection.z)/n;let c=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/r;const l=(o.textureCoordinate.v/o.projection.z-e.textureCoordinate.v/e.projection.z)/n;let u=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/r,m=(1/i.projection.z-1/e.projection.z)/r;const d=(1/o.projection.z-1/e.projection.z)/n;let p=1/e.projection.z,f=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(P*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),n=this.framebuffer.bob.texture[o+r*this.framebuffer.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),n=t.bob.getBilinearFilteredPixelRasterizer(o,r);const s=this.pipeline.alpha*(n>>24&255)/255,a=1-s,h=(this.framebuffer.framebuffer[i]>>0&255)*a+(n>>0&255)*s,c=(this.framebuffer.framebuffer[i]>>8&255)*a+(n>>8&255)*s,l=(this.framebuffer.framebuffer[i]>>16&255)*a+(n>>16&255)*s;this.framebuffer.framebuffer[i]=h|c<<8|l<<16|255<<24}i++,j+=o,C+=r,P+=n}b+=a,w+=s,M++,p+=d,f+=m,x+=h,g+=c,y+=l,v+=u}r=o.projection.y-i.projection.y,s=(o.projection.x-i.projection.x)/r,m=(1/o.projection.z-1/i.projection.z)/r,c=(o.textureCoordinate.u/o.projection.z-i.textureCoordinate.u/i.projection.z)/r,u=(o.textureCoordinate.v/o.projection.z-i.textureCoordinate.v/i.projection.z)/r,f=1/i.projection.z,g=i.textureCoordinate.u/i.projection.z,v=i.textureCoordinate.v/i.projection.z,w=i.projection.x,M=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const o=(f-p)/e,r=(g-x)/e,n=(v-y)/e;let j=p,C=x,P=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let o=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(P*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),n=this.framebuffer.bob.texture[o+r*this.framebuffer.bob.width];o=C*e*(t.bob.width-1),r=P*e*(t.bob.height-1),n=t.bob.getBilinearFilteredPixelRasterizer(o,r);const s=this.pipeline.alpha*(n>>24&255)/255,a=1-s,h=(this.framebuffer.framebuffer[i]>>0&255)*a+(n>>0&255)*s,c=(this.framebuffer.framebuffer[i]>>8&255)*a+(n>>8&255)*s,l=(this.framebuffer.framebuffer[i]>>16&255)*a+(n>>16&255)*s;this.framebuffer.framebuffer[i]=h|c<<8|l<<16|255<<24}i++,j+=o,C+=r,P+=n}b+=a,w+=s,M++,p+=d,f+=m,x+=h,g+=c,y+=l,v+=u}}}class b{u;v;constructor(t,e){this.u=t,this.v=e}}class w{position;projection=new r(0,0,0);normal;color;textureCoordinate=new b}class M{framebuffer;NEAR_PLANE_Z=-1.7;alpha;cullMode=o.BACK;constructor(t){this.framebuffer=t}setCullFace(t){this.cullMode=t}setAlpha(t){this.alpha=Math.max(Math.min(t,1),0)}isInFrontOfNearPlane(t){return t.z<this.NEAR_PLANE_Z}isTriangleCCW(t,e,i){if(this.cullMode==o.DISABLED)return!0;const r=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode==o.BACK?r<0:r>0}isTriangleCCW2(t,e,i,r){if(this.cullMode==o.DISABLED)return!0;const n=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*r.y-r.x*i.y+r.x*t.y-t.x*r.y;return this.cullMode===o.BACK?n<0:n>0}}class j extends M{sphereMapping=!1;triangleRasterizer=null;vertexArray=new Array(new w,new w,new w);setSphereMapping(t){this.sphereMapping=t}modelViewMatrix;projectedVertices=new Array(new r(0,0,0,1),new r(0,0,0,1),new r(0,0,0,1));constructor(t){super(t),this.setAlpha(1),this.triangleRasterizer=new g(t)}setFramebuffer(t){this.framebuffer=t}enableAlphaBlending(){this.triangleRasterizer=new v(this.framebuffer,this)}disableAlphaBlending(){this.triangleRasterizer=new g(this.framebuffer)}setModelViewMatrix(t){this.modelViewMatrix=t}drawMeshArray(t,e){for(let i=0;i<e.length;i++){const o=e[i];this.draw(t,o)}}draw(t,e){if(e.normals){const t=this.modelViewMatrix.computeNormalMatrix();for(let i=0;i<e.normals.length;i++)t.multiplyHomArr(e.normals[i],e.normals2[i])}for(let t=0;t<e.points.length;t++)this.modelViewMatrix.multiplyHomArr(e.points[t],e.points2[t]);for(let i=0;i<e.faces.length;i++){const o=e.points2[e.faces[i].vertices[0]],r=e.points2[e.faces[i].vertices[1]],n=e.points2[e.faces[i].vertices[2]];if(this.isInFrontOfNearPlane(o)&&this.isInFrontOfNearPlane(r)&&this.isInFrontOfNearPlane(n)){if(this.project2(o,this.projectedVertices[0]),this.project2(r,this.projectedVertices[1]),this.project2(n,this.projectedVertices[2]),this.isTriangleCCW(this.projectedVertices[0],this.projectedVertices[1],this.projectedVertices[2])){if(this.vertexArray[0].projection=this.projectedVertices[0],this.vertexArray[1].projection=this.projectedVertices[1],this.vertexArray[2].projection=this.projectedVertices[2],this.sphereMapping){const o=e.normals2[e.faces[i].normals[0]],r=e.normals2[e.faces[i].normals[1]],n=e.normals2[e.faces[i].normals[2]];t.fakeSphere(o,this.vertexArray[0]),t.fakeSphere(r,this.vertexArray[1]),t.fakeSphere(n,this.vertexArray[2])}else this.vertexArray[0].textureCoordinate=e.uv[e.faces[i].uv[0]],this.vertexArray[1].textureCoordinate=e.uv[e.faces[i].uv[1]],this.vertexArray[2].textureCoordinate=e.uv[e.faces[i].uv[2]];this.clipConvexPolygon(t,this.vertexArray)}}else{if(!(this.isInFrontOfNearPlane(o)||this.isInFrontOfNearPlane(r)||this.isInFrontOfNearPlane(n)))continue;this.vertexArray[0].position=o,this.vertexArray[0].textureCoordinate=e.uv[e.faces[i].uv[0]],this.vertexArray[1].position=r,this.vertexArray[1].textureCoordinate=e.uv[e.faces[i].uv[1]],this.vertexArray[2].position=n,this.vertexArray[2].textureCoordinate=e.uv[e.faces[i].uv[2]],this.zClipTriangle(t,this.vertexArray)}}}project2(t,e){e.x=Math.round(this.framebuffer.width/2+292*t.x/-t.z),e.y=Math.round(this.framebuffer.height/2-292*t.y/-t.z),e.z=t.z}computeNearPlaneIntersection(t,e){const i=(this.NEAR_PLANE_Z-t.position.z)/(e.position.z-t.position.z),o=new w;return o.position=new r(i*(e.position.x-t.position.x)+t.position.x,i*(e.position.y-t.position.y)+t.position.y,this.NEAR_PLANE_Z),o.textureCoordinate=new b(i*(e.textureCoordinate.u-t.textureCoordinate.u)+t.textureCoordinate.u,i*(e.textureCoordinate.v-t.textureCoordinate.v)+t.textureCoordinate.v),o}zClipTriangle(t,e){const i=e,o=new Array;let r=i[i.length-1];for(let t=0;t<i.length;t++){const e=i[t];this.isInFrontOfNearPlane(e.position)?(this.isInFrontOfNearPlane(r.position)||o.push(this.computeNearPlaneIntersection(r,e)),o.push(e)):this.isInFrontOfNearPlane(r.position)&&o.push(this.computeNearPlaneIntersection(r,e)),r=e}if(!(o.length<3)){for(let t=0;t<o.length;t++)this.project2(o[t].position,o[t].projection);(3!==o.length||this.isTriangleCCW(o[0].projection,o[1].projection,o[2].projection))&&(4!==o.length||this.isTriangleCCW2(o[0].projection,o[1].projection,o[2].projection,o[3].projection))&&this.clipConvexPolygon(t,o)}}clipConvexPolygon(t,e){let i=e;for(let e=0;e<t.clipRegion.length;e++){const o=t.clipRegion[e],r=i;i=new Array;let n=r[r.length-1];for(let t=0;t<r.length;t++){const e=r[t];o.isInside2(e)?(o.isInside2(n)||i.push(o.computeIntersection2(n,e)),i.push(e)):o.isInside2(n)&&i.push(o.computeIntersection2(n,e)),n=e}}if(!(i.length<3))for(let e=0;e<i.length-2;e++)this.triangleRasterizer.drawTriangleDDA(t,i[0],i[1+e],i[2+e])}}class C{}class P extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.y>=this.framebuffer.minWindow.y}isInside2(t){return t.projection.y>=this.framebuffer.minWindow.y}computeIntersection(t,e){const i=new w,o=(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(o).add(t.color),i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*o),this.framebuffer.minWindow.y,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*o)),i}computeIntersection2(t,e){const i=new w;i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.minWindow.y,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y)));const o=new b,n=i.projection.z;return o.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y))*n,o.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y))*n,i.textureCoordinate=o,i}computeIntersection3(t,e){const i=new w;i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.minWindow.y,0);const o=new b;return o.u=t.textureCoordinate.u+(e.textureCoordinate.u-t.textureCoordinate.u)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y),o.v=t.textureCoordinate.v+(e.textureCoordinate.v-t.textureCoordinate.v)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y),i.textureCoordinate=o,i}}class S{framebuffer;static REGION_CODE_CENTER=0;static REGION_CODE_LEFT=1;static REGION_CODE_RIGHT=2;static REGION_CODE_BOTTOM=4;static REGION_CODE_TOP=8;constructor(t){this.framebuffer=t}cohenSutherlandLineClipper(t,e,i){let o=new s(t.x,t.y,t.z),r=new s(e.x,e.y,e.z),n=this.computeRegionCode(o),a=this.computeRegionCode(r),h=!1,c=!1;for(;!c;)if(this.isTrivialAccept(n,a))h=!0,c=!0;else if(this.isTrivialReject(n,a))c=!0;else{if(n===S.REGION_CODE_CENTER){const t=n;n=a,a=t;const e=o;o=r,r=e}(n&S.REGION_CODE_TOP)!==S.REGION_CODE_CENTER?(o.x=o.x+(r.x-o.x)*(this.framebuffer.maxWindow.y-o.y)/(r.y-o.y),o.y=this.framebuffer.maxWindow.y):(n&S.REGION_CODE_BOTTOM)!==S.REGION_CODE_CENTER?(o.x=o.x+(r.x-o.x)*(this.framebuffer.minWindow.y-o.y)/(r.y-o.y),o.y=this.framebuffer.minWindow.y):(n&S.REGION_CODE_RIGHT)!==S.REGION_CODE_CENTER?(o.y=o.y+(r.y-o.y)*(this.framebuffer.maxWindow.x-o.x)/(r.x-o.x),o.x=this.framebuffer.maxWindow.x):(n&S.REGION_CODE_LEFT)!==S.REGION_CODE_CENTER&&(o.y=o.y+(r.y-o.y)*(this.framebuffer.minWindow.x-o.x)/(r.x-o.x),o.x=this.framebuffer.minWindow.x),n=this.computeRegionCode(o)}h&&this.framebuffer.drawLineDDA(o,r,i)}isTrivialAccept(t,e){return(t|e)===S.REGION_CODE_CENTER}isTrivialReject(t,e){return(t&e)!==S.REGION_CODE_CENTER}computeRegionCode(t){let e=S.REGION_CODE_CENTER;return t.x<this.framebuffer.minWindow.x?e|=S.REGION_CODE_LEFT:t.x>this.framebuffer.maxWindow.x&&(e|=S.REGION_CODE_RIGHT),t.y<this.framebuffer.minWindow.y?e|=S.REGION_CODE_BOTTOM:t.y>this.framebuffer.maxWindow.y&&(e|=S.REGION_CODE_TOP),e}}class z extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.x>=0}isInside2(t){return t.projection.x>=0}computeIntersection(t,e){const i=new w,o=(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(o).add(t.color),i.projection=new r(this.framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*o),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*o)),i}computeIntersection2(t,e){const i=new w;i.projection=new r(this.framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x)),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x)));const o=new b,n=i.projection.z;return o.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x))*n,o.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x))*n,i.textureCoordinate=o,i}computeIntersection3(t,e){const i=new w;i.projection=new r(this.framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x)),0);const o=new b;return o.u=t.textureCoordinate.u+(e.textureCoordinate.u-t.textureCoordinate.u)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x),o.v=t.textureCoordinate.v+(e.textureCoordinate.v-t.textureCoordinate.v)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x),i.textureCoordinate=o,i}}class A extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.x<this.framebuffer.width}isInside2(t){return t.projection.x<this.framebuffer.width}computeIntersection(t,e){const i=new w,o=(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(o).add(t.color),i.projection=new r(this.framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*o),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*o)),i}computeIntersection2(t,e){const i=new w;i.projection=new r(this.framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x)),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x)));const o=new b,n=i.projection.z;return o.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x))*n,o.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x))*n,i.textureCoordinate=o,i}computeIntersection3(t,e){const i=new w;i.projection=new r(this.framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x)),0);const o=new b;return o.u=t.textureCoordinate.u+(e.textureCoordinate.u-t.textureCoordinate.u)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x),o.v=t.textureCoordinate.v+(e.textureCoordinate.v-t.textureCoordinate.v)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x),i.textureCoordinate=o,i}}class B extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.y<this.framebuffer.maxWindow.y+1}isInside2(t){return t.projection.y<this.framebuffer.maxWindow.y+1}computeIntersection(t,e){const i=new w,o=(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(o).add(t.color),i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*o),this.framebuffer.maxWindow.y+1,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*o)),i}computeIntersection2(t,e){const i=new w;i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.maxWindow.y+1,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y)));const o=new b,n=i.projection.z;return o.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y))*n,o.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y))*n,i.textureCoordinate=o,i}computeIntersection3(t,e){const i=new w;i.projection=new r(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.maxWindow.y+1,0);const o=new b;return o.u=t.textureCoordinate.u+(e.textureCoordinate.u-t.textureCoordinate.u)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y),o.v=t.textureCoordinate.v+(e.textureCoordinate.v-t.textureCoordinate.v)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y),i.textureCoordinate=o,i}}class _{texture;width;height;maxWidth;maxHeight;clamp=!1;setClamp(t){this.clamp=t}constructor(t,e,i){this.texture=t,this.width=e,this.height=i,this.maxHeight=i-1|0,this.maxWidth=e-1|0}getPixel(t,e,i){return t.texture[(255&e)+256*(255&i)]}getBilinearFilteredPixel(t,e){const i=((0|t)%256+256)%256,o=((t+1|0)%256+256)%256,r=((0|e)%256+256)%256,n=((e+1|0)%256+256)%256,s=255&this.getPixel(this,i,r),a=255&this.getPixel(this,o,r),h=255&this.getPixel(this,i,n),c=255&this.getPixel(this,o,n),l=s*(1-(t-Math.floor(t)))+a*(t-Math.floor(t)),u=h*(1-(t-Math.floor(t)))+c*(t-Math.floor(t));return l*(1-(e-Math.floor(e)))+u*(e-Math.floor(e))}getBilinearFilteredPixel2(t,e){let i,o,r,n;this.clamp?(t=Math.max(Math.min(t,this.width-1),0),e=Math.max(Math.min(e,this.height-1),0),i=Math.floor(t),o=Math.max(Math.min(i+1,this.width-1),0),r=Math.floor(e),n=Math.max(Math.min(r+1,this.height-1),0)):(t=(t%this.width+this.width)%this.width,e=(e%this.height+this.height)%this.height,i=0|t,o=(t+1|0)%this.width,r=0|e,n=(e+1|0)%this.height);const s=this.getPixel2(this,i,r),a=this.getPixel2(this,o,r),h=this.getPixel2(this,i,n),c=this.getPixel2(this,o,n);return this.interpolateComp(t,e,s,a,h,c)}getPixel2(t,e,i){return this.texture[e+i*this.width]}getBilinearFilteredPixelRasterizer(t,e){let i,o,r,n,s=0|t,a=1+(0|t),h=0|e,c=1+(0|e);return this.clamp?(s=Math.max(Math.min(s,this.width-1),0),a=Math.max(Math.min(a,this.width-1),0),h=Math.max(Math.min(h,this.height-1),0),c=Math.max(Math.min(c,this.height-1),0),i=this.getPixel2(this,s,h),o=this.getPixel2(this,a,h),r=this.getPixel2(this,s,c),n=this.getPixel2(this,a,c)):(i=this.getPixelRasterizer(this,s,h),o=this.getPixelRasterizer(this,a,h),r=this.getPixelRasterizer(this,s,c),n=this.getPixelRasterizer(this,a,c)),this.interpolateComp(t,e,i,o,r,n)}getPixelRasterizer(t,e,i){return this.texture[(e&this.width-1)+(i&this.height-1)*this.width]}getPixel3(t,e,i){return this.texture[(e%this.width+this.width)%this.width+(i%this.height+this.height)%this.height*this.width]}interpolateComp(t,e,i,o,r,n){const s=t-(0|t),a=e-(0|e),h=1-s,c=1-a;return((255&i)*h+(255&o)*s)*c+((255&r)*h+(255&n)*s)*a|((i>>8&255)*h+(o>>8&255)*s)*c+((r>>8&255)*h+(n>>8&255)*s)*a<<8|((i>>16&255)*h+(o>>16&255)*s)*c+((r>>16&255)*h+(n>>16&255)*s)*a<<16|((i>>24&255)*h+(o>>24&255)*s)*c+((r>>24&255)*h+(n>>24&255)*s)*a<<24}}class I{static PIXEL_SIZE_IN_BYTES=4;minWindow;maxWindow;framebuffer;wBuffer;cullMode=o.BACK;camera;bob;triangleRasterizer=new f(this);texturedTriangleRasterizer=new g(this);scaleClipBlitter=new t(this);texturedRenderingPipeline;lineRasterizer=new x(this);lineRasterizerNo=new y(this);tmpGlitch;lensFlareVisible=!1;lensFlareStart=0;lensFlareEnd=0;width;height;imageData;unsignedIntArray;torus=new a;plane;cylinder2;linerClipper=new S(this);clipRegion=Array();texture=new _;constructor(t,e){this.width=t,this.height=e,this.imageData=new ImageData(t,e),this.wBuffer=new Float32Array(t*e);const i=new ArrayBuffer(this.width*this.height*I.PIXEL_SIZE_IN_BYTES);this.unsignedIntArray=new Uint8ClampedArray(i),this.framebuffer=new Uint32Array(i),this.tmpGlitch=new Uint32Array(t*e),this.texturedRenderingPipeline=new j(this),this.minWindow=new h(0,0),this.maxWindow=new h(t-1,e-1),this.clipRegion=new Array(new A(this),new z(this),new P(this),new B(this))}setCullFace(t){this.cullMode=t}setTexture(t){this.bob=t}getImageData(){return this.imageData.data.set(this.unsignedIntArray),this.imageData}clear(){const t=e.BLACK.toPackedFormat(),i=this.width*this.height;for(let e=0;e<i;e++)this.framebuffer[e]=t}clearColorBuffer(t){this.framebuffer.fill(t)}drawPixel(t,e,i){this.framebuffer[t+e*this.width]=i}drawPixel4(t,e,i,o){const r=t+e*this.width,n=1-o,s=(this.framebuffer[r]>>0&255)*n+(i>>0&255)*o|0,a=(this.framebuffer[r]>>8&255)*n+(i>>8&255)*o|0,h=(this.framebuffer[r]>>16&255)*n+(i>>16&255)*o|0;this.framebuffer[t+e*this.width]=s|a<<8|h<<16|255<<24}drawPixel3(t,e,i,o){const r=t+e*this.width,n=(i>>24&255)/255*o,s=1-n,a=(this.framebuffer[r]>>0&255)*s+(i>>0&255)*n|0,h=(this.framebuffer[r]>>8&255)*s+(i>>8&255)*n|0,c=(this.framebuffer[r]>>16&255)*s+(i>>16&255)*n|0;this.framebuffer[r]=a|h<<8|c<<16|255<<24}drawPixelAntiAliased(t,e,i){if(t<0||t>=this.width||e<0||e>=this.height)return;const o=Math.floor(t),r=Math.floor(e),n=(1-Math.abs(t-o))*(1-Math.abs(e-r));this.drawPixel3(o,r,i,n)}drawPixelAliased(t,e,i){if(t<0||t>=this.width||e<0||e>=this.height)return;const o=Math.round(t),r=Math.round(e);this.drawPixel(o,r,i)}drawPixelAntiAliasedSpacial(t,e,i){if(!(t<0||t>=this.width||e<0||e>=this.height))for(let o=Math.floor(t);o<=Math.ceil(t);o++)for(let r=Math.floor(e);r<=Math.ceil(e);r++){const n=(1-Math.abs(t-o))*(1-Math.abs(e-r));this.drawPixel4(o,r,i,n)}}readPixel(t,e){return this.framebuffer[t+e*this.width]}drawRect(t,e,i,o){let r=t+e*this.width;for(let t=0;t<i;t++)this.framebuffer[r++]=o}drawRect2(t,e,i,o,r){let n=t+e*this.width;for(let t=0;t<o;t++){for(let t=0;t<i;t++)this.framebuffer[n++]=r;n+=this.width-i}}drawText(t,e,i,o){let r=t;const n=" ".charCodeAt(0);for(let t=0;t<i.length;t++){const s=i.charCodeAt(t)-n,a=8*Math.floor(s%32),h=8*Math.floor(s/32);this.drawTextureRectFastAlpha(r,e,a,h,8,8,o),r+=8}}addReflections(){for(let t=0;t<50;t++)for(let e=0;e<this.width;e++)this.framebuffer[(150+t)*this.width+e]=this.framebuffer[(150-3*t-1)*this.width+e+u.interpolate(0,50,t)*(14*Math.sin(.002*Date.now()+.2*t))|0]}drawTextureRect2(t,e,i,o,r,n,s,a){for(let h=0;h<r;h++)for(let r=0;r<n;r++){const n=i+h+(o+r)*s.width,c=t+h+(e+r)*this.width,l=(s.texture[n]>>24&255)/255*a,u=1-l,m=(this.framebuffer[c]>>0&255)*u+(s.texture[n]>>0&255)*l|0,d=(this.framebuffer[c]>>8&255)*u+(s.texture[n]>>8&255)*l|0,p=(this.framebuffer[c]>>16&255)*u+(s.texture[n]>>16&255)*l|0;this.framebuffer[c]=m|d<<8|p<<16|255<<24}}drawTextureRectFastAlpha(t,e,i,o,r,n,s){let a=i+o*s.width,h=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<r;t++){const t=s.texture[a];4278190080&t&&(this.framebuffer[h]=t),a++,h++}a+=s.width-r,h+=this.width-r}}drawTextureColorized(t,e,i,o){let r=t+e*this.width,n=0;for(let t=0;t<i.height;t++){for(let t=0;t<i.width;t++){const t=i.texture[n],e=(t>>0&255)*o.r/255,s=(t>>8&255)*o.g/255,a=(t>>16&255)*o.b/255;this.framebuffer[r]=e|s<<8|a<<16|255<<24,n++,r++}r+=this.width-i.width}}drawTextureRectNoAlpha(t,e,i,o,r,n,s){let a=i+o*s.width,h=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<r;t++)this.framebuffer[h]=s.texture[a],a++,h++;a+=s.width-r,h+=this.width-r}}static blend(t,e,i){if(0===i)return t;if(255===i)return e;const o=255-i;return 4278190080|((16711680&e)>>16)*i+((16711680&t)>>16)*o>>8<<16|((65280&e)>>8)*i+((65280&t)>>8)*o>>8<<8|(255&e)*i+(255&t)*o>>8}static addColor(t,e){const i=t>>16&255,o=t>>8&255,r=255&t,n=e>>16&255,s=e>>8&255,a=255&e;return 255<<24|(i+n<255?i+n:255)<<16|(o+s<255?o+s:255)<<8|(r+a<255?r+a:255)}drawTextureRect(t,e,i,o,r,n,s,a,h){let c=i+o*a,l=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<r;t++){const t=(s[c]>>24&255)/255*h,e=1-t,i=this.framebuffer[l],o=s[c],r=(i>>0&255)*e+(o>>0&255)*t,n=(i>>8&255)*e+(o>>8&255)*t,a=(i>>16&255)*e+(o>>16&255)*t;this.framebuffer[l]=r|n<<8|a<<16|255<<24,c++,l++}c+=a-r,l+=this.width-r}}drawTextureRectAdd(t,e,i,o,r,n,s,a){let h=i+o*s.width,c=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<r;t++){const t=(s.texture[h]>>24&255)/255*a,e=this.framebuffer[c],i=s.texture[h],o=Math.min(255,(e>>0&255)+(i>>0&255)*t),r=Math.min(255,(e>>8&255)+(i>>8&255)*t),n=Math.min(255,(e>>16&255)+(i>>16&255)*t);this.framebuffer[c]=o|r<<8|n<<16|255<<24,h++,c++}h+=s.width-r,c+=this.width-r}}pixelate(){const t=200,e=50;for(let i=0;i<10;i++)for(let o=0;o<10;o++)this.drawBox2(10*i+t,10*o+e,10,10,this.readPixel(10*i+t,10*o+e));this.drawLineDDA(new s(t,e,-.3),new s(300,e,-.3),4294967295),this.drawLineDDA(new s(t,150,-.3),new s(300,150,-.3),4294967295),this.drawLineDDA(new s(t,e,-.3),new s(t,150,-.3),4294967295),this.drawLineDDA(new s(300,e,-.3),new s(300,150,-.3),4294967295)}fastFramebufferCopyOffset(t,e,i=0){let o=this.width*this.height/32+1,r=this.width*this.height,n=this.width*(this.height-i);for(;--o;)t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n],t[--r]=e[--n]}fastFramebufferCopy(t,e){t.set(e)}noise(t,e,i=.07){const o=new m;o.setSeed(t);for(let t=0;t<this.height;t++)this.drawTextureRect(0,t,Math.floor(o.getFloat()*(e.texture.length-this.width)),0,this.width,1,e.texture,e.width,i)}drawTexturedBillboard(t,e,i,o,r,n){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.height,0),l=0):(l=e,h=o-Math.max(e+o-this.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.width,0));let f=u+l*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){if(this.wBuffer[f]>n){this.wBuffer[f]=n;const t=Math.min(0|d,r.width-1)+Math.min(0|p,r.height-1)*r.width,e=(this.framebuffer[f]>>0&255)+(r.texture[t]>>0&255),i=(this.framebuffer[f]>>8&255)+(r.texture[t]>>8&255),o=(this.framebuffer[f]>>16&255)+(r.texture[t]>>16&255);this.framebuffer[f]=e|i<<8|o<<16|255<<24}d+=a,f++}p+=a,d=m,f+=-c+this.width}}drawParticle(t,e,i,o,r,n,s){const a=r.width/i,h=r.height/o;let c,l,u,m,d,p=0,f=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(f=h*-e,c=o+e-Math.max(e+o-this.height,0),u=0):(u=e,c=o-Math.max(e+o-this.height,0)),t<0?(d=p=a*-t,l=i+t-Math.max(t+i-this.width,0),m=0):(d=0,m=t,l=i-Math.max(t+i-this.width,0));const x=1/255*s;let y=m+u*this.width;for(let t=0;t<c;t++){for(let t=0;t<l;t++){if(this.wBuffer[y]>n){const t=Math.min(0|p,r.width-1)+Math.min(0|f,r.height-1)*r.width,e=(r.texture[t]>>24&255)*x,i=1-e,o=this.framebuffer[y],n=r.texture[t],s=(o>>0&255)*i+(n>>0&255)*e,a=(o>>8&255)*i+(n>>8&255)*e,h=(o>>16&255)*i+(n>>16&255)*e;this.framebuffer[y]=s|a<<8|h<<16|255<<24}p+=a,y++}f+=h,p=d,y+=-l+this.width}}drawParticle2(t,e,i,o,r,n,s,a=0,h){const c=r.width/i,l=h/o;let u,m,d,p,f,x=0,y=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(y=l*-e,u=o+e-Math.max(e+o-this.height,0),d=0):(d=e,u=o-Math.max(e+o-this.height,0)),t<0?(f=x=c*-t,m=i+t-Math.max(t+i-this.width,0),p=0):(f=0,p=t,m=i-Math.max(t+i-this.width,0));const g=1/255*s;let v=p+d*this.width;for(let t=0;t<u;t++){for(let t=0;t<m;t++){if(this.wBuffer[v]>n){const t=Math.min(0|x,r.width-1)+Math.min(0|y,h-1)*r.width+h*r.width*a,e=(r.texture[t]>>24&255)*g,i=1-e,o=this.framebuffer[v],n=r.texture[t],s=(o>>0&255)*i+(n>>0&255)*e,c=(o>>8&255)*i+(n>>8&255)*e,l=(o>>16&255)*i+(n>>16&255)*e;this.framebuffer[v]=s|c<<8|l<<16|255<<24}x+=c,v++}y+=l,x=f,v+=-m+this.width}}drawParticle2Sub(t,e,i,o,r,n,s,a=0,h,c=1,l=1,u=1){const m=r.width/i,d=h/o;let p,f,x,y,g,v=0,b=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(b=d*-e,p=o+e-Math.max(e+o-this.height,0),x=0):(x=e,p=o-Math.max(e+o-(this.height-1),0)),t<0?(g=v=m*-t,f=Math.ceil(i+t-Math.max(t+i-this.width,0)),y=0):(g=0,y=t,f=Math.ceil(i-Math.max(t+i-(this.width-1),0))),g+=(Math.ceil(t)-t)*m,b+=(Math.ceil(e)-e)*d;const w=1/255*s;let M=Math.ceil(y)+Math.ceil(x)*this.width;for(let t=0;t<p;t++){for(let t=0;t<f;t++){if(this.wBuffer[M]>n){const t=Math.min(0|Math.round(v),r.width-1)+Math.min(0|Math.round(b),h-1)*r.width+h*r.width*a,e=(r.texture[t]>>24&255)*w,i=1-e,o=this.framebuffer[M],n=r.texture[t],s=(o>>0&255)*i+(n>>0&255)*e*c,m=(o>>8&255)*i+(n>>8&255)*e*l,d=(o>>16&255)*i+(n>>16&255)*e*u;this.framebuffer[M]=s|m<<8|d<<16|255<<24}v+=m,M++}b+=d,v=g,M+=-f+this.width}}drawParticleNoDepth(t,e,i,o,r,n){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.height,0),l=0):(l=e,h=o-Math.max(e+o-this.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.width,0));const f=1/255*n;let x=u+l*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){const t=Math.min(0|d,r.width-1)+Math.min(0|p,r.height-1)*r.width,e=(r.texture[t]>>24&255)*f,i=1-e,o=this.framebuffer[x],n=r.texture[t],a=(o>>0&255)*i+(n>>0&255)*e,h=(o>>8&255)*i+(n>>8&255)*e,c=(o>>16&255)*i+(n>>16&255)*e;this.framebuffer[x]=a|h<<8|c<<16|255<<24,d+=s,x++}p+=a,d=m,x+=-c+this.width}}drawSoftParticle(t,e,i,o,r,n,s){const a=r.width/i,h=r.height/o;let c,l,u,m,d,p=0,f=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(f=h*-e,c=o+e-Math.max(e+o-this.height,0),u=0):(u=e,c=o-Math.max(e+o-this.height,0)),t<0?(d=p=a*-t,l=i+t-Math.max(t+i-this.width,0),m=0):(d=0,m=t,l=i-Math.max(t+i-this.width,0));const x=1/255*s;let y=m+u*this.width;for(let t=0;t<c;t++){for(let t=0;t<l;t++){if(this.wBuffer[y]>n){const t=Math.min(Math.max(1/n-1/this.wBuffer[y],0),1),e=Math.min(0|p,r.width-1)+Math.min(0|f,r.height-1)*r.width,i=(r.texture[e]>>24&255)*x*t,o=1-i,s=(this.framebuffer[y]>>0&255)*o+(r.texture[e]>>0&255)*i,a=(this.framebuffer[y]>>8&255)*o+(r.texture[e]>>8&255)*i,h=(this.framebuffer[y]>>16&255)*o+(r.texture[e]>>16&255)*i;this.framebuffer[y]=s|a<<8|h<<16|255<<24}p+=a,y++}f+=h,p=d,y+=-l+this.width}}drawFog(t,e,i){const o=this.width*this.height,r=-e;for(let e=0;e<o;e++){const o=Math.max(Math.min(r*(1/this.wBuffer[e]+i),1),0),n=1-o,s=(this.framebuffer[e]>>0&255)*n+t.r*o,a=(this.framebuffer[e]>>8&255)*n+t.g*o,h=(this.framebuffer[e]>>16&255)*n+t.b*o;this.framebuffer[e]=s|a<<8|h<<16|255<<24}}drawScaledTextureClipBi(t,e,i,o,r,n){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.height,0),l=0):(l=e,h=o-Math.max(e+o-this.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.width,0));const f=1/255*n;let x=u+l*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){const t=r.getBilinearFilteredPixel2(d,p),e=255*f,i=1-e,o=this.framebuffer[x],n=(o>>0&255)*i+(t>>0&255)*e,a=(o>>8&255)*i+(t>>8&255)*e,h=(o>>16&255)*i+(t>>16&255)*e;this.framebuffer[x]=n|a<<8|h<<16|255<<24,d+=s,x++}p+=a,d=m,x+=-c+this.width}}drawScaledTextureClipBiAdd(t,e,i,o,r,n){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.height,0),l=0):(l=e,h=o-Math.max(e+o-this.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.width,0));let f=u+l*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){const t=r.getBilinearFilteredPixel2(d,p),e=this.framebuffer[f],i=t,o=Math.min((e>>0&255)+(i>>0&255)*n,255),a=Math.min((e>>8&255)+(i>>8&255)*n,255),h=Math.min((e>>16&255)+(i>>16&255)*n,255);this.framebuffer[f]=o|a<<8|h<<16|255<<24,d+=s,f++}p+=a,d=m,f+=-c+this.width}}drawScaledTextureClipAdd(t,e,i,o,r,n=1){const s=r.width/i,a=r.height/o;let h,c,l,u,m,d=0,p=0;if(e+o<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=a*-e,h=o+e-Math.max(e+o-this.height,0),l=0):(l=e,h=o-Math.max(e+o-this.height,0)),t<0?(m=d=s*-t,c=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,c=i-Math.max(t+i-this.width,0));let f=u+l*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){const t=Math.min(0|d,r.width-1)+Math.min(0|p,r.height-1)*r.width,e=this.framebuffer[f],i=r.texture[t],o=Math.min((e>>0&255)+(i>>0&255)*n,255),a=Math.min((e>>8&255)+(i>>8&255)*n,255),h=Math.min((e>>16&255)+(i>>16&255)*n,255);this.framebuffer[f]=o|a<<8|h<<16|255<<24,d+=s,f++}p+=a,d=m,f+=-c+this.width}}drawTexture(t,e,i,o){const r=this.width,n=this.height;let s=Math.max(t,0)+Math.max(e,0)*this.width,a=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const h=Math.min(i.width,r-t)-Math.max(0,0-t),c=Math.min(i.height,n-e)-Math.max(0,0-e),l=i.width-h,u=this.width-h,m=1/255*o;for(let t=0;t<c;t++){for(let t=0;t<h;t++){const t=(i.texture[a]>>24&255)*m,e=1-t,o=(this.framebuffer[s]>>0&255)*e+(i.texture[a]>>0&255)*t,r=(this.framebuffer[s]>>8&255)*e+(i.texture[a]>>8&255)*t,n=(this.framebuffer[s]>>16&255)*e+(i.texture[a]>>16&255)*t;this.framebuffer[s]=o|r<<8|n<<16|255<<24,s++,a++}a+=l,s+=u}}drawTextureFullscreen(t,e){let i=0;const o=1-e;for(let r=0;r<this.width*this.height;r++){const r=(this.framebuffer[i]>>0&255)*o+(t.texture[i]>>0&255)*e,n=(this.framebuffer[i]>>8&255)*o+(t.texture[i]>>8&255)*e,s=(this.framebuffer[i]>>16&255)*o+(t.texture[i]>>16&255)*e;this.framebuffer[i]=r|n<<8|s<<16|255<<24,i++}}drawTexture3(t,e,i,o,r){const n=this.width,s=this.height;let a=Math.max(t,0)+Math.max(e,0)*this.width,h=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const c=Math.min(i.width,n-t)-Math.max(0,0-t),l=Math.min(i.height,s-e)-Math.max(0,0-e),u=i.width-c,m=this.width-c,d=1/255*o,p=Math.floor(l*Math.max(Math.min(1,r),0));for(let t=0;t<p;t++){for(let t=0;t<c;t++){const t=(i.texture[h]>>24&255)*d,e=1-t,o=(this.framebuffer[a]>>0&255)*e+(i.texture[h]>>0&255)*t,r=(this.framebuffer[a]>>8&255)*e+(i.texture[h]>>8&255)*t,n=(this.framebuffer[a]>>16&255)*e+(i.texture[h]>>16&255)*t;this.framebuffer[a]=o|r<<8|n<<16|255<<24,a++,h++}h+=u,a+=m}}drawTextureNoClipAlpha(t,e,i){let o=t+e*this.width,r=0;const n=this.width-i.width;for(let t=0;t<i.height;t++){for(let t=0;t<i.width;t++){const t=i.texture[r];4278190080&t&&(this.framebuffer[o]=t),o++,r++}o+=n}}nearPlaneClipping(t,e,i){const o=-1.7;if(t.z<o&&e.z<o)this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(e),i);else{if(t.z>o&&e.z>o)return;if(t.z<o){const r=(o-t.z)/(e.z-t.z),n=new s(r*(e.x-t.x)+t.x,r*(e.y-t.y)+t.y,o);this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(n),i)}else if(e.z<o){const r=(o-e.z)/(t.z-e.z),n=new s(r*(t.x-e.x)+e.x,r*(t.y-e.y)+e.y,o);this.linerClipper.cohenSutherlandLineClipper(this.project(e),this.project(n),i)}}}project(t){return new s(Math.round(this.width/2+292*t.x/-t.z),Math.round(this.height/2-292*t.y/-t.z),t.z)}clearDepthBuffer(){this.wBuffer.fill(-1/900)}drawBox(){const t=this.maxWindow.y-this.minWindow.y+1,e=this.maxWindow.x-this.minWindow.x+1;let i=this.minWindow.y*this.width+this.minWindow.x;for(let o=0;o<t;o++)this.framebuffer.fill(-13158601,i,i+e),i+=this.width}drawBox2(t,e,i,o,r){let n=e*this.width+t;for(let t=0;t<o;t++)this.framebuffer.fill(r,n,n+i),n+=this.width}wireFrameSphereClipping(t){this.wBuffer.fill(100);const e=[],i=16;for(let t=0;t<=16;t++)for(let o=0;o<i;o++)e.push(this.sphereFunction2(-t*Math.PI/16-Math.PI/2,2*-o*Math.PI/i));const o=[];for(let t=0;t<16;t++)for(let e=0;e<i;e++)o.push(i*t+(1+e)%i),o.push(i*t+(0+e)%i),o.push(i*t+i+(1+e)%i),o.push(i*t+i+(0+e)%i),o.push(i*t+i+(1+e)%i),o.push(i*t+(0+e)%i);const r=10.8+5*(Math.sin(.16*t)+1)/2;let n=c.constructScaleMatrix(r,r,r).multiplyMatrix(c.constructYRotationMatrix(.08*t));n=n.multiplyMatrix(c.constructXRotationMatrix(.08*t)),n=c.constructTranslationMatrix(0+20*Math.sin(.04*t),5*Math.sin(.06*t),-22).multiplyMatrix(n);const a=new Array;for(let t=0;t<e.length;t++){const i=n.multiplyHom(e[t]),o=i.x,r=i.y,h=i.z,c=.5*this.width+o/(.0078*-h),l=.5*this.height+r/(.0078*-h);a.push(new s(c,l,h))}const h=-1703936|this.height<<16|this.height;this.drawLineDDA(new s(this.minWindow.x-1,this.minWindow.y-1,0),new s(this.minWindow.x-1,this.maxWindow.y+1,0),h),this.drawLineDDA(new s(this.maxWindow.x+1,this.minWindow.y-1,0),new s(this.maxWindow.x+1,this.maxWindow.y+1,0),h),this.drawLineDDA(new s(this.minWindow.x-1,this.minWindow.y-1,0),new s(this.maxWindow.x+1,this.minWindow.y-1,0),h),this.drawLineDDA(new s(this.minWindow.x-1,this.maxWindow.y+1,0),new s(this.maxWindow.x+2,this.maxWindow.y+1,0),h),this.drawBox();for(let t=0;t<o.length;t+=3){const e=a[o[t]],i=a[o[t+1]],r=a[o[t+2]],n=-1;this.isTriangleCCW(e,i,r)&&(this.linerClipper.cohenSutherlandLineClipper(e,i,n),this.linerClipper.cohenSutherlandLineClipper(e,r,n),this.linerClipper.cohenSutherlandLineClipper(r,i,n))}}isTriangleCCW(t,e,i){const r=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode===o.BACK?r<0:r>0}wireFrameTerrain(t,e){this.clearDepthBuffer();const i=[],o=[];for(let t=0;t<256;t++)for(let i=0;i<256;i++)o.push(new s(20*(i-128),128*(255&e.texture[i+256*t])/256-70,20*(t-128)));for(let t=0;t<256;t+=1)for(let e=0;e<255;e+=1)i.push(0+e+256*t),i.push(1+e+256*t);for(let t=0;t<256;t+=1)for(let e=0;e<255;e+=1)i.push(t+256*(e+0)),i.push(t+256*(e+1));const r=l.constructYRotationMatrix(.003*t),n=new Array,a=128*+Math.cos(1e-6*t)*20,h=128*Math.sin(1e-6*t)*20;o.forEach((t=>{const e=r.multiply(t),i=e.x+a,o=e.y,c=e.z+h;n.push(new s(i,o,c))}));for(let t=0;t<i.length;t+=2){const e=1-Math.min(255,.9*-n[i[t]].z)/255,o=255*e<<8|100*e|this.height*e<<16|255<<24;this.nearPlaneClipping(n[i[t]],n[i[t+1]],o)}}drawBoundingSphere(t,e,i){const o=[];for(let e=0;e<=8;e++)for(let i=0;i<8;i++){const r=this.sphereFunction2(-e*Math.PI/8-Math.PI/2,2*-i*Math.PI/8).mul(t.getRadius()+.01).add(t.getCenter());r.w=1,o.push(r)}const r=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)r.push(8*t+(1+e)%8),r.push(8*t+(0+e)%8),r.push(8*t+8+(1+e)%8),r.push(8*t+8+(0+e)%8),r.push(8*t+8+(1+e)%8),r.push(8*t+(0+e)%8);const n=e,a=new Array;for(let t=0;t<o.length;t++){const e=n.multiplyHom(o[t]);a.push(new s(e.x,e.y,e.z))}for(let t=0;t<r.length;t+=3){const e=a[r[t]],o=a[r[t+1]],n=a[r[t+2]];this.nearPlaneClipping(e,o,i),this.nearPlaneClipping(e,n,i),this.nearPlaneClipping(n,o,i)}}drawPlanedeformationTunnelAnim(t,e){let i=0;for(let o=0;o<this.height;o++)for(let r=0;r<this.width;r++){const n=r-this.width/2,s=o-this.height/2,a=51.2/Math.max(1,Math.sqrt(n*n+s*s)),h=a+.002*t,c=16*(Math.atan2(n,s)/Math.PI+1)+69e-5*t,l=e.texture[(31&h)+32*(31&c)],m=1-u.cosineInterpolate(1,6,a),d=(l>>0&255)*m|(l>>8&255)*m<<8|(l>>16&255)*m<<16;this.framebuffer[i++]=d}}drawPlaneDeformation(t,e){const i=e.width,o=e.height;let r=0;for(let n=0;n<this.height;n++){const s=2*n/this.height-1;for(let n=0;n<this.width;n++){const a=(2*n/this.width-1)/Math.abs(s)*i*.05|0,h=1/Math.abs(s)*o*.05+.008*t|0,c=1-Math.max(Math.min(1/Math.abs(s)*.2,1),0);let l=e.texture[(255&a)+(255&h)*i];l=255<<24|(l>>16&255)*c<<16|(l>>8&255)*c<<8|(l>>0&255)*c<<0,this.framebuffer[r++]=l}}}torusFunction(t){return new s(10*Math.sin(t),0,10*Math.cos(t))}fakeSphere(t,e){e.textureCoordinate.u=.5+Math.asin(t.x)/Math.PI,e.textureCoordinate.v=.5-Math.asin(t.y)/Math.PI}fakeSphere2(t,e){e.u=.5+Math.asin(t.x)/Math.PI,e.v=.5-Math.asin(t.y)/Math.PI}drawLineDDA(t,e,i){this.lineRasterizer.drawLineDDA(t,e,i)}drawLineDDANoZ(t,e,i){this.lineRasterizerNo.drawLineDDANoZ(t,e,i)}sphereFunction2(t,e){return new r(Math.cos(t)*Math.cos(e),Math.cos(t)*Math.sin(e),Math.sin(t),1)}}class R{static toggleFullscreen(t){this.fullscreen?(R.exitFullscreen(),this.fullscreen=!1,this.setStyle(t,"cursor: zoom-in")):(R.enterFullscreen(t),this.fullscreen=!0,this.setStyle(t,"cursor: none"))}static setStyle(t,e){t.setAttribute("style",t.getAttribute("style")+";"+e)}static enterFullscreen(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}static exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}static fullscreen=!1}class T{scene;framebuffer;canvas;context;startTime;boundRenderLoop;constructor(t,e,i){this.scene=i,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.id="aisa-canvas",this.canvas.style.cssText="image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -o-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;",this.canvas.style.width=2*t+"px",this.canvas.style.height=2*e+"px",this.context=this.canvas.getContext("2d"),this.context.oImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.framebuffer=new I(t,e),this.boundRenderLoop=this.renderLoop.bind(this)}init(){this.appendTo(document.getElementById("aisa")),this.canvas.addEventListener("click",(t=>{t.preventDefault(),R.toggleFullscreen(this.canvas)})),this.scene.init(this.framebuffer).then((()=>{this.scene.onInit(),this.startTime=Date.now(),this.renderLoop()}))}renderLoop(){this.scene.render(this.framebuffer,Date.now()-this.startTime),this.flipBackbuffer(),requestAnimationFrame(this.boundRenderLoop)}flipBackbuffer(){this.context.putImageData(this.framebuffer.getImageData(),0,0)}appendTo(t){t.appendChild(this.canvas)}}var E=i(9842);class k{init(t){return Promise.all([])}onInit(){}}class D{static generateProceduralNoise(){return new Promise((t=>{const e=new _;e.texture=new Uint32Array(65536);const i=new m;i.setSeed(100);for(let t=0;t<65536;t++){const o=i.getFloat();e.texture[t]=200*o|255*o<<8|205*o<<16|255<<24}e.width=256,e.height=256,t(e)}))}static generateProceduralParticleTexture(){return new Promise((t=>{const e=new _;e.texture=new Uint32Array(65536),(new m).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const o=127-i,r=127-t,n=Math.sqrt(o*o+r*r)/127;let s=1-n;s*=s*s,n>1&&(s=0),s=Math.min(1,2.9*s),e.texture[i+256*t]=15466475|255*s<<24}e.width=256,e.height=256,t(e)}))}static generateProceduralParticleTexture2(){return new Promise((t=>{const e=new _;e.texture=new Uint32Array(65536),(new m).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const o=127-i,r=127-t,n=Math.sqrt(o*o+r*r)/127;let s=1-n;s*=s,n>1&&(s=0),s=Math.min(1,40*s),e.texture[i+256*t]=16764415|255*s<<24}e.width=256,e.height=256,t(e)}))}static load(t,e){return new Promise((i=>{const o=new Image;o.onload=()=>{const t=new _;t.texture=this.getImageData(o,e),t.width=o.width,t.height=o.height,i(t)},o.onerror=()=>i(),o.src=t}))}static getImageData(t,e=!1){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");o.drawImage(t,0,0);const r=o.getImageData(0,0,t.width,t.height).data,n=new Uint32Array(r.length/4);let s=0;for(let t=0;t<r.length;t+=4)n[s]=e?r[t+3]<<24|r[t+2]<<16|r[t+1]<<8|r[t+0]:255<<24|r[t+2]<<16|r[t+1]<<8|r[t+0],s++;return n}}class W{framebuffer;clipRegion;constructor(t){this.framebuffer=t,this.clipRegion=new Array(new A(t),new z(t),new P(t),new B(t))}clipConvexPolygon(t){let e=t;for(let t=0;t<this.clipRegion.length;t++){const i=this.clipRegion[t],o=e;e=new Array;let r=o[o.length-1];for(let t=0;t<o.length;t++){const n=o[t];i.isInside(n)?(i.isInside(r)||e.push(i.computeIntersection(r,n)),e.push(n)):i.isInside(r)&&e.push(i.computeIntersection(r,n)),r=n}}return e}}class F extends p{framebuffer;constructor(t){super(),this.framebuffer=t}fillLongRightTriangle(t,e,i,o){let r=i.projection.y-e.projection.y,n=(i.projection.x-e.projection.x)/r,s=(i.textureCoordinate.u-e.textureCoordinate.u)/r,a=(i.textureCoordinate.v-e.textureCoordinate.v)/r,h=e.textureCoordinate.u,c=e.textureCoordinate.v,l=e.projection.x;const u=o.projection.y-e.projection.y,m=(o.projection.x-e.projection.x)/u,d=(o.textureCoordinate.u-e.textureCoordinate.u)/u,p=(o.textureCoordinate.v-e.textureCoordinate.v)/u;let f=e.textureCoordinate.u,x=e.textureCoordinate.v,y=e.projection.x,g=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(y)-Math.round(l);let i=Math.round(g)*t.width+Math.round(l);const o=(f-h)/e,r=(x-c)/e;let u=h,v=c;for(let n=0;n<e;n++){let e=0|Math.max(Math.min(u*t.bob.width,t.bob.width-1),0),n=0|Math.max(Math.min(v*t.bob.height,t.bob.height-1),0),s=t.bob.texture[e+n*t.bob.width];t.framebuffer[i]=s,i++,u+=o,v+=r}l+=n,y+=m,g++,h+=s,f+=d,c+=a,x+=p}if(r=o.projection.y-i.projection.y,0!==r){n=(o.projection.x-i.projection.x)/r,s=(o.textureCoordinate.u-i.textureCoordinate.u)/r,a=(o.textureCoordinate.v-i.textureCoordinate.v)/r,h=i.textureCoordinate.u,c=i.textureCoordinate.v,l=i.projection.x,g=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(y)-Math.round(l);let i=Math.round(g)*t.width+Math.round(l);const o=(f-h)/e,r=(x-c)/e;let u=h,v=c;for(let n=0;n<e;n++){let e=0|Math.max(Math.min(u*t.bob.width,t.bob.width-1),0),n=0|Math.max(Math.min(v*t.bob.height,t.bob.height-1),0),s=t.bob.texture[e+n*t.bob.width];t.framebuffer[i]=s,i++,u+=o,v+=r}l+=n,y+=m,g++,h+=s,f+=d,c+=a,x+=p}}}fillLongLeftTriangle(t,e,i,o){let r=i.projection.y-e.projection.y;const n=o.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/r;const a=(o.projection.x-e.projection.x)/n,h=(o.textureCoordinate.u-e.textureCoordinate.u)/n;let c=(i.textureCoordinate.u-e.textureCoordinate.u)/r;const l=(o.textureCoordinate.v-e.textureCoordinate.v)/n;let u=(i.textureCoordinate.v-e.textureCoordinate.v)/r,m=e.textureCoordinate.u,d=e.textureCoordinate.v,p=e.textureCoordinate.u,f=e.textureCoordinate.v,x=e.projection.x,y=e.projection.x,g=e.projection.y;for(let e=0;e<r;e++){const e=Math.round(y)-Math.round(x);let i=Math.round(g)*t.width+Math.round(x);const o=(p-m)/e,r=(f-d)/e;let n=m,v=d;for(let s=0;s<e;s++){let e=0|Math.max(Math.min(n*t.bob.width,t.bob.width-1),0),s=0|Math.max(Math.min(v*t.bob.height,t.bob.height-1),0),a=t.bob.texture[e+s*t.bob.width];t.framebuffer[i]=a,i++,n+=o,v+=r}x+=a,y+=s,g++,m+=h,p+=c,d+=l,f+=u}r=o.projection.y-i.projection.y,s=(o.projection.x-i.projection.x)/r,c=(o.textureCoordinate.u-i.textureCoordinate.u)/r,u=(o.textureCoordinate.v-i.textureCoordinate.v)/r,p=i.textureCoordinate.u,f=i.textureCoordinate.v,y=i.projection.x,g=i.projection.y;for(let e=0;e<r;e++){const e=Math.round(y)-Math.round(x);let i=Math.round(g)*t.width+Math.round(x);const o=(p-m)/e,r=(f-d)/e;let n=m,v=d;for(let s=0;s<e;s++){let e=0|Math.max(Math.min(n*t.bob.width,t.bob.width-1),0),s=0|Math.max(Math.min(v*t.bob.height,t.bob.height-1),0),a=t.bob.texture[e+s*t.bob.width];t.framebuffer[i]=a,i++,n+=o,v+=r}x+=a,y+=s,g++,m+=h,p+=c,d+=l,f+=u}}}class L extends k{BG_sky;BG_city;BG_dirt1;BG_dirt2;BG_dirt3;BG_road;PR_tree1;PR_tree2;PR_lamp;AR_oldhouse;AR_grill;AR_haneu;parallaxLayers;init(){return Promise.all([D.load(i(1610),!0).then((t=>this.BG_sky=t)),D.load(i(5876),!0).then((t=>this.BG_city=t)),D.load(i(1957),!0).then((t=>this.BG_dirt1=t)),D.load(i(5454),!0).then((t=>this.BG_dirt2=t)),D.load(i(6938),!0).then((t=>this.BG_dirt3=t)),D.load(i(217),!0).then((t=>this.BG_road=t)),D.load(i(2068),!0).then((t=>this.AR_oldhouse=t)),D.load(i(4078),!0).then((t=>this.AR_grill=t)),D.load(i(1846),!0).then((t=>this.PR_tree1=t)),D.load(i(9163),!0).then((t=>this.PR_tree2=t)),D.load(i(4709),!0).then((t=>this.PR_lamp=t)),D.load(i(7237),!0).then((t=>this.AR_haneu=t))])}onInit(){this.parallaxLayers=this.createParallaxLayers()}render(t,i){t.clearColorBuffer(e.RED.toPackedFormat()),this.parallaxLayers.forEach((e=>{const o=i*e.speed|0;t.drawTexture(0-o%e.layerWidth+e.positionX|0,e.positionY,e.image,1),t.drawTexture(e.layerWidth-o%e.layerWidth+e.positionX|0,e.positionY,e.image,1)}))}createParallaxLayers(){return[{image:this.BG_sky,layerWidth:600,positionY:0,positionX:0,speed:.044040192000000006},{image:this.BG_city,layerWidth:600,positionY:109-this.BG_city.height,positionX:0,speed:.05505024000000001},{image:this.BG_dirt1,layerWidth:600,positionY:137-this.BG_dirt1.height,positionX:0,speed:.10752*.8*.8},{image:this.BG_dirt2,layerWidth:600,positionY:155-this.BG_dirt2.height,positionX:0,speed:.10752*.8},{image:this.BG_dirt3,layerWidth:600,positionY:177-this.BG_dirt3.height,positionX:0,speed:.10752},{image:this.BG_road,layerWidth:600,positionY:200-this.BG_road.height,positionX:0,speed:.1344},{image:this.PR_tree1,layerWidth:1200,positionY:163-this.PR_tree1.height,positionX:253,speed:.10752},{image:this.PR_tree2,layerWidth:1200,positionY:161-this.PR_tree2.height,positionX:7,speed:.10752},{image:this.PR_tree2,layerWidth:1200,positionY:158-this.PR_tree2.height,positionX:245,speed:.10752},{image:this.PR_tree2,layerWidth:1200,positionY:158-this.PR_tree2.height,positionX:347,speed:.10752},{image:this.PR_tree1,layerWidth:1200,positionY:163-this.PR_tree1.height,positionX:753,speed:.10752},{image:this.PR_tree1,layerWidth:1200,positionY:158-this.PR_tree1.height,positionX:865,speed:.10752},{image:this.PR_tree2,layerWidth:1200,positionY:162-this.PR_tree2.height,positionX:625,speed:.10752},{image:this.PR_tree2,layerWidth:1200,positionY:158-this.PR_tree2.height,positionX:696,speed:.10752},{image:this.AR_oldhouse,layerWidth:1200,positionY:177-this.AR_oldhouse.height,positionX:52,speed:.10752},{image:this.AR_haneu,layerWidth:1200,positionY:177-this.AR_haneu.height,positionX:900,speed:.10752},{image:this.AR_grill,layerWidth:1200,positionY:177-this.AR_grill.height,positionX:312,speed:.10752},{image:this.PR_lamp,layerWidth:228,positionY:177-this.PR_lamp.height,positionX:7,speed:.1344},{image:this.PR_lamp,layerWidth:228,positionY:177-this.PR_lamp.height,positionX:235,speed:.1344}]}}class O extends k{engine;lastTime=void 0;rasterizer;texture;hoodlumLogo;texturingRenderingPipeline;clipper;logoB;scene;init(t){this.texturingRenderingPipeline=new j(t),this.clipper=new W(t),this.rasterizer=new F(t),this.engine=E.Engine.create(),this.scene=new L;var e=E.Bodies.rectangle(400,-1700,90,90,{angle:Math.random()*Math.PI,velocity:{x:1,y:.2}}),o=E.Bodies.rectangle(450,-850,80,120,{angle:2*Math.random()*Math.PI}),r=E.Bodies.rectangle(365,-1070,200,200,{angle:Math.random()*Math.PI}),n=E.Bodies.rectangle(498,-1090,83,110,{angle:2*Math.random()*Math.PI}),s=E.Bodies.rectangle(400,608,810,60,{isStatic:!0});return E.Composite.add(this.engine.world,[e,o,r,n,s]),setInterval((()=>{let t=E.Bodies.rectangle(400,-850,80,80,{angle:2*Math.random()*Math.PI});E.Body.applyForce(t,t.position,{x:.1*Math.sin(Math.random()*Math.PI*2),y:.2}),E.Composite.add(this.engine.world,[t])}),400),Promise.all([this.scene.init(),D.load(i(1285),!0).then((t=>this.texture=t)),D.load(i(2485),!0).then((t=>this.hoodlumLogo=t))])}onInit(){this.scene.onInit()}render(t,e){const i=this.getDeltaTime(e);E.Engine.update(this.engine,1*i),this.scene.render(t,e);const o=E.Composite.allBodies(this.engine.world),n=new w,s=new w,a=new w,h=new w;t.setTexture(this.texture);for(let e=0;e<o.length;e++){if(o[e].position.x<-100||o[e].position.x>850||o[e].position.y>700){E.Composite.remove(this.engine.world,[o[e]]);continue}const i=o[e].vertices;n.projection=this.toInteger(new r(i[0].x,i[0].y,-10).mul(.4).add(new r(30,-31,0,0))),n.textureCoordinate=new b(0,0),s.projection=this.toInteger(new r(i[1].x,i[1].y,-10).mul(.4).add(new r(30,-31,0,0))),s.textureCoordinate=new b(1,0),a.projection=this.toInteger(new r(i[2].x,i[2].y,-10).mul(.4).add(new r(30,-31,0,0))),a.textureCoordinate=new b(1,1),h.projection=this.toInteger(new r(i[3].x,i[3].y,-10).mul(.4).add(new r(30,-31,0,0))),h.textureCoordinate=new b(0,1),this.clipConvexPolygon(t,[n,s,a,h])}t.drawTexture(0,0,this.hoodlumLogo,1)}clipConvexPolygon(t,e){let i=e;for(let e=0;e<t.clipRegion.length;e++){const o=t.clipRegion[e],r=i;i=new Array;let n=r[r.length-1];for(let t=0;t<r.length;t++){const e=r[t];o.isInside2(e)?(o.isInside2(n)||i.push(o.computeIntersection3(n,e)),i.push(e)):o.isInside2(n)&&i.push(o.computeIntersection3(n,e)),n=e}}if(!(i.length<3))for(let e=0;e<i.length-2;e++)this.rasterizer.drawTriangleDDA(t,i[0],i[1+e],i[2+e])}toInteger(t){return new r(0|t.x,0|t.y,0|t.z)}getDeltaTime(t){this.lastTime||(this.lastTime=t);const e=t-this.lastTime;return this.lastTime=t,e}}var N=i(3379),V=i.n(N),G=i(7795),H=i.n(G),q=i(569),U=i.n(q),Y=i(3565),X=i.n(Y),Z=i(9216),K=i.n(Z),Q=i(4589),$=i.n(Q),J=i(4035),tt={};tt.styleTagTransform=$(),tt.setAttributes=X(),tt.insert=U().bind(null,"head"),tt.domAPI=H(),tt.insertStyleElement=K(),V()(J.Z,tt),J.Z&&J.Z.locals&&J.Z.locals,class{static main(){new T(320,200,new O).init()}}.main()})()})();
//# sourceMappingURL=matterjs.js.map