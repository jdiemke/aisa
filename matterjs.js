/*! For license information please see matterjs.js.LICENSE.txt */
(()=>{var t={4035:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(7537),o=i.n(n),r=i(3645),s=i.n(r)()(o());s.push([t.id,"body {\n    background-color: #000;\n}\n","",{version:3,sources:["webpack://./src/default-style.css"],names:[],mappings:"AAAA;IACI,sBAAsB;AAC1B",sourcesContent:["body {\n    background-color: #000;\n}\n"],sourceRoot:""}]);const a=s},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);n&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},7537:t=>{"use strict";t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),r="/*# ".concat(o," */");return[e].concat([r]).join("\n")}return[e].join("\n")}},9842:function(t,e,i){var n;n=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e){var n={};t.exports=n,function(){n._baseDelta=1e3/60,n._nextId=0,n._seed=0,n._nowStartTime=+new Date,n._warnedOnce={},n._decomp=null,n.extend=function(t,e){var i,o;"boolean"==typeof e?(i=2,o=e):(i=1,o=!0);for(var r=i;r<arguments.length;r++){var s=arguments[r];if(s)for(var a in s)o&&s[a]&&s[a].constructor===Object?t[a]&&t[a].constructor!==Object?t[a]=s[a]:(t[a]=t[a]||{},n.extend(t[a],o,s[a])):t[a]=s[a]}return t},n.clone=function(t,e){return n.extend({},e,t)},n.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)e.push(i);return e},n.values=function(t){var e=[];if(Object.keys){for(var i=Object.keys(t),n=0;n<i.length;n++)e.push(t[i[n]]);return e}for(var o in t)e.push(t[o]);return e},n.get=function(t,e,i,n){e=e.split(".").slice(i,n);for(var o=0;o<e.length;o+=1)t=t[e[o]];return t},n.set=function(t,e,i,o,r){var s=e.split(".").slice(o,r);return n.get(t,e,0,-1)[s[s.length-1]]=i,i},n.shuffle=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(n.random()*(e+1)),o=t[e];t[e]=t[i],t[i]=o}return t},n.choose=function(t){return t[Math.floor(n.random()*t.length)]},n.isElement=function(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},n.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.isFunction=function(t){return"function"==typeof t},n.isPlainObject=function(t){return"object"==typeof t&&t.constructor===Object},n.isString=function(t){return"[object String]"===toString.call(t)},n.clamp=function(t,e,i){return t<e?e:t>i?i:t},n.sign=function(t){return t<0?-1:1},n.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-n._nowStartTime},n.random=function(e,i){return i=void 0!==i?i:1,(e=void 0!==e?e:0)+t()*(i-e)};var t=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280};n.colorToNumber=function(t){return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},n.logLevel=1,n.log=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.info=function(){console&&n.logLevel>0&&n.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warn=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warnOnce=function(){var t=Array.prototype.slice.call(arguments).join(" ");n._warnedOnce[t]||(n.warn(t),n._warnedOnce[t]=!0)},n.deprecated=function(t,e,i){t[e]=n.chain((function(){n.warnOnce("🔅 deprecated 🔅",i)}),t[e])},n.nextId=function(){return n._nextId++},n.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},n.map=function(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i},n.topologicalSort=function(t){var e=[],i=[],o=[];for(var r in t)i[r]||o[r]||n._topologicalSort(r,i,o,t,e);return e},n._topologicalSort=function(t,e,i,o,r){var s=o[t]||[];i[t]=!0;for(var a=0;a<s.length;a+=1){var l=s[a];i[l]||e[l]||n._topologicalSort(l,e,i,o,r)}i[t]=!1,e[t]=!0,r.push(t)},n.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var i=arguments[e];i._chained?t.push.apply(t,i._chained):t.push(i)}var n=function(){for(var e,i=new Array(arguments.length),n=0,o=arguments.length;n<o;n++)i[n]=arguments[n];for(n=0;n<t.length;n+=1){var r=t[n].apply(e,i);void 0!==r&&(e=r)}return e};return n._chained=t,n},n.chainPathBefore=function(t,e,i){return n.set(t,e,n.chain(i,n.get(t,e)))},n.chainPathAfter=function(t,e,i){return n.set(t,e,n.chain(n.get(t,e),i))},n.setDecomp=function(t){n._decomp=t},n.getDecomp=function(){var t=n._decomp;try{t||"undefined"==typeof window||(t=window.decomp),t||void 0===i.g||(t=i.g.decomp)}catch(e){t=null}return t}}()},function(t,e){var i={};t.exports=i,i.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(e,t),e},i.update=function(t,e,i){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var n=0;n<e.length;n++){var o=e[n];o.x>t.max.x&&(t.max.x=o.x),o.x<t.min.x&&(t.min.x=o.x),o.y>t.max.y&&(t.max.y=o.y),o.y<t.min.y&&(t.min.y=o.y)}i&&(i.x>0?t.max.x+=i.x:t.min.x+=i.x,i.y>0?t.max.y+=i.y:t.min.y+=i.y)},i.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},i.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},i.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},i.shift=function(t,e){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+i,t.min.y=e.y,t.max.y=e.y+n}},function(t,e){var i={};t.exports=i,i.create=function(t,e){return{x:t||0,y:e||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,e,i){var n=Math.cos(e),o=Math.sin(e);i||(i={});var r=t.x*n-t.y*o;return i.y=t.x*o+t.y*n,i.x=r,i},i.rotateAbout=function(t,e,i,n){var o=Math.cos(e),r=Math.sin(e);n||(n={});var s=i.x+((t.x-i.x)*o-(t.y-i.y)*r);return n.y=i.y+((t.x-i.x)*r+(t.y-i.y)*o),n.x=s,n},i.normalise=function(t){var e=i.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},i.cross3=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},i.add=function(t,e,i){return i||(i={}),i.x=t.x+e.x,i.y=t.y+e.y,i},i.sub=function(t,e,i){return i||(i={}),i.x=t.x-e.x,i.y=t.y-e.y,i},i.mult=function(t,e){return{x:t.x*e,y:t.y*e}},i.div=function(t,e){return{x:t.x/e,y:t.y/e}},i.perp=function(t,e){return{x:(e=!0===e?-1:1)*-t.y,y:e*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]},function(t,e,i){var n={};t.exports=n;var o=i(2),r=i(0);n.create=function(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n],r={x:o.x,y:o.y,index:n,body:e,isInternal:!1};i.push(r)}return i},n.fromPath=function(t,e){var i=[];return t.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(t,e,n){i.push({x:parseFloat(e),y:parseFloat(n)})})),n.create(i,e)},n.centre=function(t){for(var e,i,r,s=n.area(t,!0),a={x:0,y:0},l=0;l<t.length;l++)r=(l+1)%t.length,e=o.cross(t[l],t[r]),i=o.mult(o.add(t[l],t[r]),e),a=o.add(a,i);return o.div(a,6*s)},n.mean=function(t){for(var e={x:0,y:0},i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y;return o.div(e,t.length)},n.area=function(t,e){for(var i=0,n=t.length-1,o=0;o<t.length;o++)i+=(t[n].x-t[o].x)*(t[n].y+t[o].y),n=o;return e?i/2:Math.abs(i)/2},n.inertia=function(t,e){for(var i,n,r=0,s=0,a=t,l=0;l<a.length;l++)n=(l+1)%a.length,r+=(i=Math.abs(o.cross(a[n],a[l])))*(o.dot(a[n],a[n])+o.dot(a[n],a[l])+o.dot(a[l],a[l])),s+=i;return e/6*(r/s)},n.translate=function(t,e,i){i=void 0!==i?i:1;var n,o=t.length,r=e.x*i,s=e.y*i;for(n=0;n<o;n++)t[n].x+=r,t[n].y+=s;return t},n.rotate=function(t,e,i){if(0!==e){var n,o,r,s,a=Math.cos(e),l=Math.sin(e),h=i.x,c=i.y,u=t.length;for(s=0;s<u;s++)o=(n=t[s]).x-h,r=n.y-c,n.x=h+(o*a-r*l),n.y=c+(o*l+r*a);return t}},n.contains=function(t,e){for(var i,n=e.x,o=e.y,r=t.length,s=t[r-1],a=0;a<r;a++){if(i=t[a],(n-s.x)*(i.y-s.y)+(o-s.y)*(s.x-i.x)>0)return!1;s=i}return!0},n.scale=function(t,e,i,r){if(1===e&&1===i)return t;var s,a;r=r||n.centre(t);for(var l=0;l<t.length;l++)s=t[l],a=o.sub(s,r),t[l].x=r.x+a.x*e,t[l].y=r.y+a.y*i;return t},n.chamfer=function(t,e,i,n,s){e="number"==typeof e?[e]:e||[8],i=void 0!==i?i:-1,n=n||2,s=s||14;for(var a=[],l=0;l<t.length;l++){var h=t[l-1>=0?l-1:t.length-1],c=t[l],u=t[(l+1)%t.length],m=e[l<e.length?l:e.length-1];if(0!==m){var f=o.normalise({x:c.y-h.y,y:h.x-c.x}),d=o.normalise({x:u.y-c.y,y:c.x-u.x}),p=Math.sqrt(2*Math.pow(m,2)),x=o.mult(r.clone(f),m),y=o.normalise(o.mult(o.add(f,d),.5)),g=o.sub(c,o.mult(y,p)),v=i;-1===i&&(v=1.75*Math.pow(m,.32)),(v=r.clamp(v,n,s))%2==1&&(v+=1);for(var b=Math.acos(o.dot(f,d))/v,w=0;w<v;w++)a.push(o.add(o.rotate(x,b*w),g))}else a.push(c)}return a},n.clockwiseSort=function(t){var e=n.mean(t);return t.sort((function(t,i){return o.angle(e,t)-o.angle(e,i)})),t},n.isConvex=function(t){var e,i,n,o,r=0,s=t.length;if(s<3)return null;for(e=0;e<s;e++)if(n=(e+2)%s,o=(t[i=(e+1)%s].x-t[e].x)*(t[n].y-t[i].y),(o-=(t[i].y-t[e].y)*(t[n].x-t[i].x))<0?r|=1:o>0&&(r|=2),3===r)return!1;return 0!==r||null},n.hull=function(t){var e,i,n=[],r=[];for((t=t.slice(0)).sort((function(t,e){var i=t.x-e.x;return 0!==i?i:t.y-e.y})),i=0;i<t.length;i+=1){for(e=t[i];r.length>=2&&o.cross3(r[r.length-2],r[r.length-1],e)<=0;)r.pop();r.push(e)}for(i=t.length-1;i>=0;i-=1){for(e=t[i];n.length>=2&&o.cross3(n[n.length-2],n[n.length-1],e)<=0;)n.pop();n.push(e)}return n.pop(),r.pop(),n.concat(r)}},function(t,e,i){var n={};t.exports=n;var o=i(3),r=i(2),s=i(7),a=i(0),l=i(1),h=i(11);!function(){n._timeCorrection=!0,n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n._baseDelta=1e3/60,n.create=function(e){var i={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:1e3/60,_original:null},n=a.extend(i,e);return t(n,e),n},n.nextGroup=function(t){return t?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var t=function(t,e){e=e||{},n.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||r.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),o.rotate(t.vertices,t.angle,t.position),h.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),n.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var i=t.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),s=t.isStatic?"#555":"#ccc",c=t.isStatic&&null===t.render.fillStyle?1:0;t.render.fillStyle=t.render.fillStyle||i,t.render.strokeStyle=t.render.strokeStyle||s,t.render.lineWidth=t.render.lineWidth||c,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};n.set=function(t,e,i){var o;for(o in"string"==typeof e&&(o=e,(e={})[o]=i),e)if(Object.prototype.hasOwnProperty.call(e,o))switch(i=e[o],o){case"isStatic":n.setStatic(t,i);break;case"isSleeping":s.set(t,i);break;case"mass":n.setMass(t,i);break;case"density":n.setDensity(t,i);break;case"inertia":n.setInertia(t,i);break;case"vertices":n.setVertices(t,i);break;case"position":n.setPosition(t,i);break;case"angle":n.setAngle(t,i);break;case"velocity":n.setVelocity(t,i);break;case"angularVelocity":n.setAngularVelocity(t,i);break;case"speed":n.setSpeed(t,i);break;case"angularSpeed":n.setAngularSpeed(t,i);break;case"parts":n.setParts(t,i);break;case"centre":n.setCentre(t,i);break;default:t[o]=i}},n.setStatic=function(t,e){for(var i=0;i<t.parts.length;i++){var n=t.parts[i];e?(n.isStatic||(n._original={restitution:n.restitution,friction:n.friction,mass:n.mass,inertia:n.inertia,density:n.density,inverseMass:n.inverseMass,inverseInertia:n.inverseInertia}),n.restitution=0,n.friction=1,n.mass=n.inertia=n.density=1/0,n.inverseMass=n.inverseInertia=0,n.positionPrev.x=n.position.x,n.positionPrev.y=n.position.y,n.anglePrev=n.angle,n.angularVelocity=0,n.speed=0,n.angularSpeed=0,n.motion=0):n._original&&(n.restitution=n._original.restitution,n.friction=n._original.friction,n.mass=n._original.mass,n.inertia=n._original.inertia,n.density=n._original.density,n.inverseMass=n._original.inverseMass,n.inverseInertia=n._original.inverseInertia,n._original=null),n.isStatic=e}},n.setMass=function(t,e){var i=t.inertia/(t.mass/6);t.inertia=i*(e/6),t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},n.setDensity=function(t,e){n.setMass(t,e*t.area),t.density=e},n.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},n.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=o.create(e,t),t.axes=h.fromVertices(t.vertices),t.area=o.area(t.vertices),n.setMass(t,t.density*t.area);var i=o.centre(t.vertices);o.translate(t.vertices,i,-1),n.setInertia(t,n._inertiaScale*o.inertia(t.vertices,t.mass)),o.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},n.setParts=function(t,e,i){var r;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,r=0;r<e.length;r++){var s=e[r];s!==t&&(s.parent=t,t.parts.push(s))}if(1!==t.parts.length){if(i=void 0===i||i){var a=[];for(r=0;r<e.length;r++)a=a.concat(e[r].vertices);o.clockwiseSort(a);var l=o.hull(a),h=o.centre(l);n.setVertices(t,l),o.translate(t.vertices,h)}var c=n._totalProperties(t);t.area=c.area,t.parent=t,t.position.x=c.centre.x,t.position.y=c.centre.y,t.positionPrev.x=c.centre.x,t.positionPrev.y=c.centre.y,n.setMass(t,c.mass),n.setInertia(t,c.inertia),n.setPosition(t,c.centre)}},n.setCentre=function(t,e,i){i?(t.positionPrev.x+=e.x,t.positionPrev.y+=e.y,t.position.x+=e.x,t.position.y+=e.y):(t.positionPrev.x=e.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=e.y-(t.position.y-t.positionPrev.y),t.position.x=e.x,t.position.y=e.y)},n.setPosition=function(t,e,i){var n=r.sub(e,t.position);i?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=n.x,t.velocity.y=n.y,t.speed=r.magnitude(n)):(t.positionPrev.x+=n.x,t.positionPrev.y+=n.y);for(var s=0;s<t.parts.length;s++){var a=t.parts[s];a.position.x+=n.x,a.position.y+=n.y,o.translate(a.vertices,n),l.update(a.bounds,a.vertices,t.velocity)}},n.setAngle=function(t,e,i){var n=e-t.angle;i?(t.anglePrev=t.angle,t.angularVelocity=n,t.angularSpeed=Math.abs(n)):t.anglePrev+=n;for(var s=0;s<t.parts.length;s++){var a=t.parts[s];a.angle+=n,o.rotate(a.vertices,n,t.position),h.rotate(a.axes,n),l.update(a.bounds,a.vertices,t.velocity),s>0&&r.rotateAbout(a.position,n,t.position,a.position)}},n.setVelocity=function(t,e){var i=t.deltaTime/n._baseDelta;t.positionPrev.x=t.position.x-e.x*i,t.positionPrev.y=t.position.y-e.y*i,t.velocity.x=(t.position.x-t.positionPrev.x)/i,t.velocity.y=(t.position.y-t.positionPrev.y)/i,t.speed=r.magnitude(t.velocity)},n.getVelocity=function(t){var e=n._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*e,y:(t.position.y-t.positionPrev.y)*e}},n.getSpeed=function(t){return r.magnitude(n.getVelocity(t))},n.setSpeed=function(t,e){n.setVelocity(t,r.mult(r.normalise(n.getVelocity(t)),e))},n.setAngularVelocity=function(t,e){var i=t.deltaTime/n._baseDelta;t.anglePrev=t.angle-e*i,t.angularVelocity=(t.angle-t.anglePrev)/i,t.angularSpeed=Math.abs(t.angularVelocity)},n.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*n._baseDelta/t.deltaTime},n.getAngularSpeed=function(t){return Math.abs(n.getAngularVelocity(t))},n.setAngularSpeed=function(t,e){n.setAngularVelocity(t,a.sign(n.getAngularVelocity(t))*e)},n.translate=function(t,e,i){n.setPosition(t,r.add(t.position,e),i)},n.rotate=function(t,e,i,o){if(i){var r=Math.cos(e),s=Math.sin(e),a=t.position.x-i.x,l=t.position.y-i.y;n.setPosition(t,{x:i.x+(a*r-l*s),y:i.y+(a*s+l*r)},o),n.setAngle(t,t.angle+e,o)}else n.setAngle(t,t.angle+e,o)},n.scale=function(t,e,i,r){var s=0,a=0;r=r||t.position;for(var c=0;c<t.parts.length;c++){var u=t.parts[c];o.scale(u.vertices,e,i,r),u.axes=h.fromVertices(u.vertices),u.area=o.area(u.vertices),n.setMass(u,t.density*u.area),o.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),n.setInertia(u,n._inertiaScale*o.inertia(u.vertices,u.mass)),o.translate(u.vertices,{x:u.position.x,y:u.position.y}),c>0&&(s+=u.area,a+=u.inertia),u.position.x=r.x+(u.position.x-r.x)*e,u.position.y=r.y+(u.position.y-r.y)*i,l.update(u.bounds,u.vertices,t.velocity)}t.parts.length>1&&(t.area=s,t.isStatic||(n.setMass(t,t.density*s),n.setInertia(t,a))),t.circleRadius&&(e===i?t.circleRadius*=e:t.circleRadius=null)},n.update=function(t,e){var i=(e=(void 0!==e?e:1e3/60)*t.timeScale)*e,s=n._timeCorrection?e/(t.deltaTime||e):1,c=1-t.frictionAir*(e/a._baseDelta),u=(t.position.x-t.positionPrev.x)*s,m=(t.position.y-t.positionPrev.y)*s;t.velocity.x=u*c+t.force.x/t.mass*i,t.velocity.y=m*c+t.force.y/t.mass*i,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=e,t.angularVelocity=(t.angle-t.anglePrev)*c*s+t.torque/t.inertia*i,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var f=0;f<t.parts.length;f++){var d=t.parts[f];o.translate(d.vertices,t.velocity),f>0&&(d.position.x+=t.velocity.x,d.position.y+=t.velocity.y),0!==t.angularVelocity&&(o.rotate(d.vertices,t.angularVelocity,t.position),h.rotate(d.axes,t.angularVelocity),f>0&&r.rotateAbout(d.position,t.angularVelocity,t.position,d.position)),l.update(d.bounds,d.vertices,t.velocity)}},n.updateVelocities=function(t){var e=n._baseDelta/t.deltaTime,i=t.velocity;i.x=(t.position.x-t.positionPrev.x)*e,i.y=(t.position.y-t.positionPrev.y)*e,t.speed=Math.sqrt(i.x*i.x+i.y*i.y),t.angularVelocity=(t.angle-t.anglePrev)*e,t.angularSpeed=Math.abs(t.angularVelocity)},n.applyForce=function(t,e,i){var n=e.x-t.position.x,o=e.y-t.position.y;t.force.x+=i.x,t.force.y+=i.y,t.torque+=n*i.y-o*i.x},n._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},i=1===t.parts.length?0:1;i<t.parts.length;i++){var n=t.parts[i],o=n.mass!==1/0?n.mass:1;e.mass+=o,e.area+=n.area,e.inertia+=n.inertia,e.centre=r.add(e.centre,r.mult(n.position,o))}return e.centre=r.div(e.centre,e.mass),e}}()},function(t,e,i){var n={};t.exports=n;var o=i(0);n.on=function(t,e,i){for(var n,o=e.split(" "),r=0;r<o.length;r++)n=o[r],t.events=t.events||{},t.events[n]=t.events[n]||[],t.events[n].push(i);return i},n.off=function(t,e,i){if(e){"function"==typeof e&&(i=e,e=o.keys(t.events).join(" "));for(var n=e.split(" "),r=0;r<n.length;r++){var s=t.events[n[r]],a=[];if(i&&s)for(var l=0;l<s.length;l++)s[l]!==i&&a.push(s[l]);t.events[n[r]]=a}}else t.events={}},n.trigger=function(t,e,i){var n,r,s,a,l=t.events;if(l&&o.keys(l).length>0){i||(i={}),n=e.split(" ");for(var h=0;h<n.length;h++)if(s=l[r=n[h]]){(a=o.clone(i,!1)).name=r,a.source=t;for(var c=0;c<s.length;c++)s[c].apply(t,[a])}}}},function(t,e,i){var n={};t.exports=n;var o=i(5),r=i(0),s=i(1),a=i(4);n.create=function(t){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},t)},n.setModified=function(t,e,i,o){if(t.isModified=e,e&&t.cache&&(t.cache.allBodies=null,t.cache.allConstraints=null,t.cache.allComposites=null),i&&t.parent&&n.setModified(t.parent,e,i,o),o)for(var r=0;r<t.composites.length;r++){var s=t.composites[r];n.setModified(s,e,i,o)}},n.add=function(t,e){var i=[].concat(e);o.trigger(t,"beforeAdd",{object:e});for(var s=0;s<i.length;s++){var a=i[s];switch(a.type){case"body":if(a.parent!==a){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(t,a);break;case"constraint":n.addConstraint(t,a);break;case"composite":n.addComposite(t,a);break;case"mouseConstraint":n.addConstraint(t,a.constraint)}}return o.trigger(t,"afterAdd",{object:e}),t},n.remove=function(t,e,i){var r=[].concat(e);o.trigger(t,"beforeRemove",{object:e});for(var s=0;s<r.length;s++){var a=r[s];switch(a.type){case"body":n.removeBody(t,a,i);break;case"constraint":n.removeConstraint(t,a,i);break;case"composite":n.removeComposite(t,a,i);break;case"mouseConstraint":n.removeConstraint(t,a.constraint)}}return o.trigger(t,"afterRemove",{object:e}),t},n.addComposite=function(t,e){return t.composites.push(e),e.parent=t,n.setModified(t,!0,!0,!1),t},n.removeComposite=function(t,e,i){var o=r.indexOf(t.composites,e);if(-1!==o){var s=n.allBodies(e);n.removeCompositeAt(t,o);for(var a=0;a<s.length;a++)s[a].sleepCounter=0}if(i)for(a=0;a<t.composites.length;a++)n.removeComposite(t.composites[a],e,!0);return t},n.removeCompositeAt=function(t,e){return t.composites.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addBody=function(t,e){return t.bodies.push(e),n.setModified(t,!0,!0,!1),t},n.removeBody=function(t,e,i){var o=r.indexOf(t.bodies,e);if(-1!==o&&(n.removeBodyAt(t,o),e.sleepCounter=0),i)for(var s=0;s<t.composites.length;s++)n.removeBody(t.composites[s],e,!0);return t},n.removeBodyAt=function(t,e){return t.bodies.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addConstraint=function(t,e){return t.constraints.push(e),n.setModified(t,!0,!0,!1),t},n.removeConstraint=function(t,e,i){var o=r.indexOf(t.constraints,e);if(-1!==o&&n.removeConstraintAt(t,o),i)for(var s=0;s<t.composites.length;s++)n.removeConstraint(t.composites[s],e,!0);return t},n.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),n.setModified(t,!0,!0,!1),t},n.clear=function(t,e,i){if(i)for(var o=0;o<t.composites.length;o++)n.clear(t.composites[o],e,!0);return e?t.bodies=t.bodies.filter((function(t){return t.isStatic})):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,n.setModified(t,!0,!0,!1),t},n.allBodies=function(t){if(t.cache&&t.cache.allBodies)return t.cache.allBodies;for(var e=[].concat(t.bodies),i=0;i<t.composites.length;i++)e=e.concat(n.allBodies(t.composites[i]));return t.cache&&(t.cache.allBodies=e),e},n.allConstraints=function(t){if(t.cache&&t.cache.allConstraints)return t.cache.allConstraints;for(var e=[].concat(t.constraints),i=0;i<t.composites.length;i++)e=e.concat(n.allConstraints(t.composites[i]));return t.cache&&(t.cache.allConstraints=e),e},n.allComposites=function(t){if(t.cache&&t.cache.allComposites)return t.cache.allComposites;for(var e=[].concat(t.composites),i=0;i<t.composites.length;i++)e=e.concat(n.allComposites(t.composites[i]));return t.cache&&(t.cache.allComposites=e),e},n.get=function(t,e,i){var o,r;switch(i){case"body":o=n.allBodies(t);break;case"constraint":o=n.allConstraints(t);break;case"composite":o=n.allComposites(t).concat(t)}return o?0===(r=o.filter((function(t){return t.id.toString()===e.toString()}))).length?null:r[0]:null},n.move=function(t,e,i){return n.remove(t,e),n.add(i,e),t},n.rebase=function(t){for(var e=n.allBodies(t).concat(n.allConstraints(t)).concat(n.allComposites(t)),i=0;i<e.length;i++)e[i].id=r.nextId();return t},n.translate=function(t,e,i){for(var o=i?n.allBodies(t):t.bodies,r=0;r<o.length;r++)a.translate(o[r],e);return t},n.rotate=function(t,e,i,o){for(var r=Math.cos(e),s=Math.sin(e),l=o?n.allBodies(t):t.bodies,h=0;h<l.length;h++){var c=l[h],u=c.position.x-i.x,m=c.position.y-i.y;a.setPosition(c,{x:i.x+(u*r-m*s),y:i.y+(u*s+m*r)}),a.rotate(c,e)}return t},n.scale=function(t,e,i,o,r){for(var s=r?n.allBodies(t):t.bodies,l=0;l<s.length;l++){var h=s[l],c=h.position.x-o.x,u=h.position.y-o.y;a.setPosition(h,{x:o.x+c*e,y:o.y+u*i}),a.scale(h,e,i)}return t},n.bounds=function(t){for(var e=n.allBodies(t),i=[],o=0;o<e.length;o+=1){var r=e[o];i.push(r.bounds.min,r.bounds.max)}return s.create(i)}},function(t,e,i){var n={};t.exports=n;var o=i(4),r=i(5),s=i(0);n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(t,e){for(var i=e/s._baseDelta,r=n._motionSleepThreshold,a=0;a<t.length;a++){var l=t[a],h=o.getSpeed(l),c=o.getAngularSpeed(l),u=h*h+c*c;if(0===l.force.x&&0===l.force.y){var m=Math.min(l.motion,u),f=Math.max(l.motion,u);l.motion=n._minBias*m+(1-n._minBias)*f,l.sleepThreshold>0&&l.motion<r?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold/i&&n.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}else n.set(l,!1)}},n.afterCollisions=function(t){for(var e=n._motionSleepThreshold,i=0;i<t.length;i++){var o=t[i];if(o.isActive){var r=o.collision,s=r.bodyA.parent,a=r.bodyB.parent;if(!(s.isSleeping&&a.isSleeping||s.isStatic||a.isStatic)&&(s.isSleeping||a.isSleeping)){var l=s.isSleeping&&!s.isStatic?s:a,h=l===s?a:s;!l.isStatic&&h.motion>e&&n.set(l,!1)}}}},n.set=function(t,e){var i=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,i||r.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,i&&r.trigger(t,"sleepEnd"))}},function(t,e,i){var n={};t.exports=n;var o,r,s,a=i(3),l=i(9);o=[],r={overlap:0,axis:null},s={overlap:0,axis:null},n.create=function(t,e){return{pair:null,collided:!1,bodyA:t,bodyB:e,parentA:t.parent,parentB:e.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},n.collides=function(t,e,i){if(n._overlapAxes(r,t.vertices,e.vertices,t.axes),r.overlap<=0)return null;if(n._overlapAxes(s,e.vertices,t.vertices,e.axes),s.overlap<=0)return null;var o,h,c=i&&i.table[l.id(t,e)];c?o=c.collision:((o=n.create(t,e)).collided=!0,o.bodyA=t.id<e.id?t:e,o.bodyB=t.id<e.id?e:t,o.parentA=o.bodyA.parent,o.parentB=o.bodyB.parent),t=o.bodyA,e=o.bodyB,h=r.overlap<s.overlap?r:s;var u=o.normal,m=o.tangent,f=o.penetration,d=o.supports,p=h.overlap,x=h.axis,y=x.x,g=x.y;y*(e.position.x-t.position.x)+g*(e.position.y-t.position.y)>=0&&(y=-y,g=-g),u.x=y,u.y=g,m.x=-g,m.y=y,f.x=y*p,f.y=g*p,o.depth=p;var v=n._findSupports(t,e,u,1),b=0;if(a.contains(t.vertices,v[0])&&(d[b++]=v[0]),a.contains(t.vertices,v[1])&&(d[b++]=v[1]),b<2){var w=n._findSupports(e,t,u,-1);a.contains(e.vertices,w[0])&&(d[b++]=w[0]),b<2&&a.contains(e.vertices,w[1])&&(d[b++]=w[1])}return 0===b&&(d[b++]=v[0]),o.supportCount=b,o},n._overlapAxes=function(t,e,i,n){var o,r,s,a,l,h,c=e.length,u=i.length,m=e[0].x,f=e[0].y,d=i[0].x,p=i[0].y,x=n.length,y=Number.MAX_VALUE,g=0;for(l=0;l<x;l++){var v=n[l],b=v.x,w=v.y,M=m*b+f*w,j=d*b+p*w,C=M,S=j;for(h=1;h<c;h+=1)(a=e[h].x*b+e[h].y*w)>C?C=a:a<M&&(M=a);for(h=1;h<u;h+=1)(a=i[h].x*b+i[h].y*w)>S?S=a:a<j&&(j=a);if((o=(r=C-j)<(s=S-M)?r:s)<y&&(y=o,g=l,o<=0))break}t.axis=n[g],t.overlap=y},n._findSupports=function(t,e,i,n){var r,s,a,l=e.vertices,h=l.length,c=t.position.x,u=t.position.y,m=i.x*n,f=i.y*n,d=l[0],p=d,x=m*(c-p.x)+f*(u-p.y);for(a=1;a<h;a+=1)(s=m*(c-(p=l[a]).x)+f*(u-p.y))<x&&(x=s,d=p);return x=m*(c-(r=l[(h+d.index-1)%h]).x)+f*(u-r.y),m*(c-(p=l[(d.index+1)%h]).x)+f*(u-p.y)<x?(o[0]=d,o[1]=p,o):(o[0]=d,o[1]=r,o)}},function(t,e,i){var n={};t.exports=n;var o=i(16);n.create=function(t,e){var i=t.bodyA,r=t.bodyB,s={id:n.id(i,r),bodyA:i,bodyB:r,collision:t,contacts:[o.create(),o.create()],contactCount:0,separation:0,isActive:!0,isSensor:i.isSensor||r.isSensor,timeCreated:e,timeUpdated:e,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return n.update(s,t,e),s},n.update=function(t,e,i){var n=e.supports,o=e.supportCount,r=t.contacts,s=e.parentA,a=e.parentB;t.isActive=!0,t.timeUpdated=i,t.collision=e,t.separation=e.depth,t.inverseMass=s.inverseMass+a.inverseMass,t.friction=s.friction<a.friction?s.friction:a.friction,t.frictionStatic=s.frictionStatic>a.frictionStatic?s.frictionStatic:a.frictionStatic,t.restitution=s.restitution>a.restitution?s.restitution:a.restitution,t.slop=s.slop>a.slop?s.slop:a.slop,t.contactCount=o,e.pair=t;var l=n[0],h=r[0],c=n[1],u=r[1];u.vertex!==l&&h.vertex!==c||(r[1]=h,r[0]=h=u,u=r[1]),h.vertex=l,u.vertex=c},n.setActive=function(t,e,i){e?(t.isActive=!0,t.timeUpdated=i):(t.isActive=!1,t.contactCount=0)},n.id=function(t,e){return t.id<e.id?t.id.toString(36)+":"+e.id.toString(36):e.id.toString(36)+":"+t.id.toString(36)}},function(t,e,i){var n={};t.exports=n;var o=i(3),r=i(2),s=i(7),a=i(1),l=i(11),h=i(0);n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var i=e.bodyA?r.add(e.bodyA.position,e.pointA):e.pointA,n=e.bodyB?r.add(e.bodyB.position,e.pointB):e.pointB,o=r.magnitude(r.sub(i,n));e.length=void 0!==e.length?e.length:o,e.id=e.id||h.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&e.stiffness>.1?(s.type="pin",s.anchors=!1):e.stiffness<.9&&(s.type="spring"),e.render=h.extend(s,e.render),e},n.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var i=t[e],n=i.constraintImpulse;i.isStatic||0===n.x&&0===n.y&&0===n.angle||(i.position.x+=n.x,i.position.y+=n.y,i.angle+=n.angle)}},n.solveAll=function(t,e){for(var i=h.clamp(e/h._baseDelta,0,1),o=0;o<t.length;o+=1){var r=t[o],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,a=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(s||a)&&n.solve(t[o],i)}for(o=0;o<t.length;o+=1)s=!(r=t[o]).bodyA||r.bodyA&&r.bodyA.isStatic,a=!r.bodyB||r.bodyB&&r.bodyB.isStatic,s||a||n.solve(t[o],i)},n.solve=function(t,e){var i=t.bodyA,o=t.bodyB,s=t.pointA,a=t.pointB;if(i||o){i&&!i.isStatic&&(r.rotate(s,i.angle-t.angleA,s),t.angleA=i.angle),o&&!o.isStatic&&(r.rotate(a,o.angle-t.angleB,a),t.angleB=o.angle);var l=s,h=a;if(i&&(l=r.add(i.position,s)),o&&(h=r.add(o.position,a)),l&&h){var c=r.sub(l,h),u=r.magnitude(c);u<n._minLength&&(u=n._minLength);var m,f,d,p,x,y=(u-t.length)/u,g=t.stiffness>=1||0===t.length?t.stiffness*e:t.stiffness*e*e,v=t.damping*e,b=r.mult(c,y*g),w=(i?i.inverseMass:0)+(o?o.inverseMass:0),M=w+((i?i.inverseInertia:0)+(o?o.inverseInertia:0));if(v>0){var j=r.create();d=r.div(c,u),x=r.sub(o&&r.sub(o.position,o.positionPrev)||j,i&&r.sub(i.position,i.positionPrev)||j),p=r.dot(d,x)}i&&!i.isStatic&&(f=i.inverseMass/w,i.constraintImpulse.x-=b.x*f,i.constraintImpulse.y-=b.y*f,i.position.x-=b.x*f,i.position.y-=b.y*f,v>0&&(i.positionPrev.x-=v*d.x*p*f,i.positionPrev.y-=v*d.y*p*f),m=r.cross(s,b)/M*n._torqueDampen*i.inverseInertia*(1-t.angularStiffness),i.constraintImpulse.angle-=m,i.angle-=m),o&&!o.isStatic&&(f=o.inverseMass/w,o.constraintImpulse.x+=b.x*f,o.constraintImpulse.y+=b.y*f,o.position.x+=b.x*f,o.position.y+=b.y*f,v>0&&(o.positionPrev.x+=v*d.x*p*f,o.positionPrev.y+=v*d.y*p*f),m=r.cross(a,b)/M*n._torqueDampen*o.inverseInertia*(1-t.angularStiffness),o.constraintImpulse.angle+=m,o.angle+=m)}}},n.postSolveAll=function(t){for(var e=0;e<t.length;e++){var i=t[e],h=i.constraintImpulse;if(!(i.isStatic||0===h.x&&0===h.y&&0===h.angle)){s.set(i,!1);for(var c=0;c<i.parts.length;c++){var u=i.parts[c];o.translate(u.vertices,h),c>0&&(u.position.x+=h.x,u.position.y+=h.y),0!==h.angle&&(o.rotate(u.vertices,h.angle,i.position),l.rotate(u.axes,h.angle),c>0&&r.rotateAbout(u.position,h.angle,i.position,u.position)),a.update(u.bounds,u.vertices,i.velocity)}h.angle*=n._warming,h.x*=n._warming,h.y*=n._warming}}},n.pointAWorld=function(t){return{x:(t.bodyA?t.bodyA.position.x:0)+(t.pointA?t.pointA.x:0),y:(t.bodyA?t.bodyA.position.y:0)+(t.pointA?t.pointA.y:0)}},n.pointBWorld=function(t){return{x:(t.bodyB?t.bodyB.position.x:0)+(t.pointB?t.pointB.x:0),y:(t.bodyB?t.bodyB.position.y:0)+(t.pointB?t.pointB.y:0)}},n.currentLength=function(t){var e=(t.bodyA?t.bodyA.position.x:0)+(t.pointA?t.pointA.x:0),i=(t.bodyA?t.bodyA.position.y:0)+(t.pointA?t.pointA.y:0),n=e-((t.bodyB?t.bodyB.position.x:0)+(t.pointB?t.pointB.x:0)),o=i-((t.bodyB?t.bodyB.position.y:0)+(t.pointB?t.pointB.y:0));return Math.sqrt(n*n+o*o)}},function(t,e,i){var n={};t.exports=n;var o=i(2),r=i(0);n.fromVertices=function(t){for(var e={},i=0;i<t.length;i++){var n=(i+1)%t.length,s=o.normalise({x:t[n].y-t[i].y,y:t[i].x-t[n].x}),a=0===s.y?1/0:s.x/s.y;e[a=a.toFixed(3).toString()]=s}return r.values(e)},n.rotate=function(t,e){if(0!==e)for(var i=Math.cos(e),n=Math.sin(e),o=0;o<t.length;o++){var r,s=t[o];r=s.x*i-s.y*n,s.y=s.x*n+s.y*i,s.x=r}}},function(t,e,i){var n={};t.exports=n;var o=i(3),r=i(0),s=i(4),a=i(1),l=i(2);n.rectangle=function(t,e,i,n,a){a=a||{};var l={label:"Rectangle Body",position:{x:t,y:e},vertices:o.fromPath("L 0 0 L "+i+" 0 L "+i+" "+n+" L 0 "+n)};if(a.chamfer){var h=a.chamfer;l.vertices=o.chamfer(l.vertices,h.radius,h.quality,h.qualityMin,h.qualityMax),delete a.chamfer}return s.create(r.extend({},l,a))},n.trapezoid=function(t,e,i,n,a,l){l=l||{},a>=1&&r.warn("Bodies.trapezoid: slope parameter must be < 1.");var h,c=i*(a*=.5),u=c+(1-2*a)*i,m=u+c;h=a<.5?"L 0 0 L "+c+" "+-n+" L "+u+" "+-n+" L "+m+" 0":"L 0 0 L "+u+" "+-n+" L "+m+" 0";var f={label:"Trapezoid Body",position:{x:t,y:e},vertices:o.fromPath(h)};if(l.chamfer){var d=l.chamfer;f.vertices=o.chamfer(f.vertices,d.radius,d.quality,d.qualityMin,d.qualityMax),delete l.chamfer}return s.create(r.extend({},f,l))},n.circle=function(t,e,i,o,s){o=o||{};var a={label:"Circle Body",circleRadius:i};s=s||25;var l=Math.ceil(Math.max(10,Math.min(s,i)));return l%2==1&&(l+=1),n.polygon(t,e,l,i,r.extend({},a,o))},n.polygon=function(t,e,i,a,l){if(l=l||{},i<3)return n.circle(t,e,a,l);for(var h=2*Math.PI/i,c="",u=.5*h,m=0;m<i;m+=1){var f=u+m*h,d=Math.cos(f)*a,p=Math.sin(f)*a;c+="L "+d.toFixed(3)+" "+p.toFixed(3)+" "}var x={label:"Polygon Body",position:{x:t,y:e},vertices:o.fromPath(c)};if(l.chamfer){var y=l.chamfer;x.vertices=o.chamfer(x.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return s.create(r.extend({},x,l))},n.fromVertices=function(t,e,i,n,h,c,u,m){var f,d,p,x,y,g,v,b,w,M,j=r.getDecomp();for(f=Boolean(j&&j.quickDecomp),n=n||{},p=[],h=void 0!==h&&h,c=void 0!==c?c:.01,u=void 0!==u?u:10,m=void 0!==m?m:.01,r.isArray(i[0])||(i=[i]),w=0;w<i.length;w+=1)if(y=i[w],!(x=o.isConvex(y))&&!f&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),x||!f)y=x?o.clockwiseSort(y):o.hull(y),p.push({position:{x:t,y:e},vertices:y});else{var C=y.map((function(t){return[t.x,t.y]}));j.makeCCW(C),!1!==c&&j.removeCollinearPoints(C,c),!1!==m&&j.removeDuplicatePoints&&j.removeDuplicatePoints(C,m);var S=j.quickDecomp(C);for(g=0;g<S.length;g++){var z=S[g].map((function(t){return{x:t[0],y:t[1]}}));u>0&&o.area(z)<u||p.push({position:o.centre(z),vertices:z})}}for(g=0;g<p.length;g++)p[g]=s.create(r.extend(p[g],n));if(h)for(g=0;g<p.length;g++){var P=p[g];for(v=g+1;v<p.length;v++){var A=p[v];if(a.overlaps(P.bounds,A.bounds)){var B=P.vertices,I=A.vertices;for(b=0;b<P.vertices.length;b++)for(M=0;M<A.vertices.length;M++){var _=l.magnitudeSquared(l.sub(B[(b+1)%B.length],I[M])),R=l.magnitudeSquared(l.sub(B[b],I[(M+1)%I.length]));_<5&&R<5&&(B[b].isInternal=!0,I[M].isInternal=!0)}}}}return p.length>1?(d=s.create(r.extend({parts:p.slice(0)},n)),s.setPosition(d,{x:t,y:e}),d):p[0]}},function(t,e,i){var n={};t.exports=n;var o=i(0),r=i(8);n.create=function(t){return o.extend({bodies:[],collisions:[],pairs:null},t)},n.setBodies=function(t,e){t.bodies=e.slice(0)},n.clear=function(t){t.bodies=[],t.collisions=[]},n.collisions=function(t){var e,i,o=t.pairs,s=t.bodies,a=s.length,l=n.canCollide,h=r.collides,c=t.collisions,u=0;for(s.sort(n._compareBoundsX),e=0;e<a;e++){var m=s[e],f=m.bounds,d=m.bounds.max.x,p=m.bounds.max.y,x=m.bounds.min.y,y=m.isStatic||m.isSleeping,g=m.parts.length,v=1===g;for(i=e+1;i<a;i++){var b=s[i];if((A=b.bounds).min.x>d)break;if(!(p<A.min.y||x>A.max.y)&&(!y||!b.isStatic&&!b.isSleeping)&&l(m.collisionFilter,b.collisionFilter)){var w=b.parts.length;if(v&&1===w)(z=h(m,b,o))&&(c[u++]=z);else for(var M=w>1?1:0,j=g>1?1:0;j<g;j++)for(var C=m.parts[j],S=(f=C.bounds,M);S<w;S++){var z,P=b.parts[S],A=P.bounds;f.min.x>A.max.x||f.max.x<A.min.x||f.max.y<A.min.y||f.min.y>A.max.y||(z=h(C,P,o))&&(c[u++]=z)}}}}return c.length!==u&&(c.length=u),c},n.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:0!=(t.mask&e.category)&&0!=(e.mask&t.category)},n._compareBoundsX=function(t,e){return t.bounds.min.x-e.bounds.min.x}},function(t,e,i){var n={};t.exports=n;var o=i(0);n.create=function(t){var e={};return t||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=parseInt(e.element.getAttribute("data-pixel-ratio"),10)||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&(e.button=0,t.preventDefault()),e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&t.preventDefault(),e.button=-1,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault(),e.sourceEvents.mousewheel=t},n.setElement(e,e.element),e},n.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove,{passive:!0}),e.addEventListener("mousedown",t.mousedown,{passive:!0}),e.addEventListener("mouseup",t.mouseup,{passive:!0}),e.addEventListener("wheel",t.mousewheel,{passive:!1}),e.addEventListener("touchmove",t.mousemove,{passive:!1}),e.addEventListener("touchstart",t.mousedown,{passive:!1}),e.addEventListener("touchend",t.mouseup,{passive:!1})},n.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},n.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n._getRelativeMousePosition=function(t,e,i){var n,o,r=e.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,h=t.changedTouches;return h?(n=h[0].pageX-r.left-a,o=h[0].pageY-r.top-l):(n=t.pageX-r.left-a,o=t.pageY-r.top-l),{x:n/(e.clientWidth/(e.width||e.clientWidth)*i),y:o/(e.clientHeight/(e.height||e.clientHeight)*i)}}},function(t,e,i){var n={};t.exports=n;var o=i(0);n._registry={},n.register=function(t){if(n.isPlugin(t)||o.warn("Plugin.register:",n.toString(t),"does not implement all required fields."),t.name in n._registry){var e=n._registry[t.name],i=n.versionParse(t.version).number,r=n.versionParse(e.version).number;i>r?(o.warn("Plugin.register:",n.toString(e),"was upgraded to",n.toString(t)),n._registry[t.name]=t):i<r?o.warn("Plugin.register:",n.toString(e),"can not be downgraded to",n.toString(t)):t!==e&&o.warn("Plugin.register:",n.toString(t),"is already registered to different plugin object")}else n._registry[t.name]=t;return t},n.resolve=function(t){return n._registry[n.dependencyParse(t).name]},n.toString=function(t){return"string"==typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},n.isPlugin=function(t){return t&&t.name&&t.version&&t.install},n.isUsed=function(t,e){return t.used.indexOf(e)>-1},n.isFor=function(t,e){var i=t.for&&n.dependencyParse(t.for);return!t.for||e.name===i.name&&n.versionSatisfies(e.version,i.range)},n.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var i=n.dependencies(t),r=o.topologicalSort(i),s=[],a=0;a<r.length;a+=1)if(r[a]!==t.name){var l=n.resolve(r[a]);l?n.isUsed(t,l.name)||(n.isFor(l,t)||(o.warn("Plugin.use:",n.toString(l),"is for",l.for,"but installed on",n.toString(t)+"."),l._warned=!0),l.install?l.install(t):(o.warn("Plugin.use:",n.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(s.push("🔶 "+n.toString(l)),delete l._warned):s.push("✅ "+n.toString(l)),t.used.push(l.name)):s.push("❌ "+r[a])}s.length>0&&o.info(s.join("  "))}else o.warn("Plugin.use:",n.toString(t),"does not specify any dependencies to install.")},n.dependencies=function(t,e){var i=n.dependencyParse(t),r=i.name;if(!(r in(e=e||{}))){t=n.resolve(t)||t,e[r]=o.map(t.uses||[],(function(e){n.isPlugin(e)&&n.register(e);var r=n.dependencyParse(e),s=n.resolve(e);return s&&!n.versionSatisfies(s.version,r.range)?(o.warn("Plugin.dependencies:",n.toString(s),"does not satisfy",n.toString(r),"used by",n.toString(i)+"."),s._warned=!0,t._warned=!0):s||(o.warn("Plugin.dependencies:",n.toString(e),"used by",n.toString(i),"could not be resolved."),t._warned=!0),r.name}));for(var s=0;s<e[r].length;s+=1)n.dependencies(e[r][s],e);return e}},n.dependencyParse=function(t){return o.isString(t)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(t)||o.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}):{name:t.name,range:t.range||t.version}},n.versionParse=function(t){var e=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;e.test(t)||o.warn("Plugin.versionParse:",t,"is not a valid version or range.");var i=e.exec(t),n=Number(i[4]),r=Number(i[5]),s=Number(i[6]);return{isRange:Boolean(i[1]||i[2]),version:i[3],range:t,operator:i[1]||i[2]||"",major:n,minor:r,patch:s,parts:[n,r,s],prerelease:i[7],number:1e8*n+1e4*r+s}},n.versionSatisfies=function(t,e){e=e||"*";var i=n.versionParse(e),o=n.versionParse(t);if(i.isRange){if("*"===i.operator||"*"===t)return!0;if(">"===i.operator)return o.number>i.number;if(">="===i.operator)return o.number>=i.number;if("~"===i.operator)return o.major===i.major&&o.minor===i.minor&&o.patch>=i.patch;if("^"===i.operator)return i.major>0?o.major===i.major&&o.number>=i.number:i.minor>0?o.minor===i.minor&&o.patch>=i.patch:o.patch===i.patch}return t===e||"*"===t}},function(t,e){var i={};t.exports=i,i.create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}},function(t,e,i){var n={};t.exports=n;var o=i(7),r=i(18),s=i(13),a=i(19),l=i(5),h=i(6),c=i(10),u=i(0),m=i(4);n._deltaMax=1e3/60,n.create=function(t){t=t||{};var e=u.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},t);return e.world=t.world||h.create({label:"World"}),e.pairs=t.pairs||a.create(),e.detector=t.detector||s.create(),e.detector.pairs=e.pairs,e.grid={buckets:[]},e.world.gravity=e.gravity,e.broadphase=e.grid,e.metrics={},e},n.update=function(t,e){var i,m=u.now(),f=t.world,d=t.detector,p=t.pairs,x=t.timing,y=x.timestamp;e>n._deltaMax&&u.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",n._deltaMax.toFixed(3),"ms."),e=void 0!==e?e:u._baseDelta,e*=x.timeScale,x.timestamp+=e,x.lastDelta=e;var g={timestamp:x.timestamp,delta:e};l.trigger(t,"beforeUpdate",g);var v=h.allBodies(f),b=h.allConstraints(f);for(f.isModified&&(s.setBodies(d,v),h.setModified(f,!1,!1,!0)),t.enableSleeping&&o.update(v,e),n._bodiesApplyGravity(v,t.gravity),e>0&&n._bodiesUpdate(v,e),l.trigger(t,"beforeSolve",g),c.preSolveAll(v),i=0;i<t.constraintIterations;i++)c.solveAll(b,e);c.postSolveAll(v);var w=s.collisions(d);a.update(p,w,y),t.enableSleeping&&o.afterCollisions(p.list),p.collisionStart.length>0&&l.trigger(t,"collisionStart",{pairs:p.collisionStart,timestamp:x.timestamp,delta:e});var M=u.clamp(20/t.positionIterations,0,1);for(r.preSolvePosition(p.list),i=0;i<t.positionIterations;i++)r.solvePosition(p.list,e,M);for(r.postSolvePosition(v),c.preSolveAll(v),i=0;i<t.constraintIterations;i++)c.solveAll(b,e);for(c.postSolveAll(v),r.preSolveVelocity(p.list),i=0;i<t.velocityIterations;i++)r.solveVelocity(p.list,e);return n._bodiesUpdateVelocities(v),p.collisionActive.length>0&&l.trigger(t,"collisionActive",{pairs:p.collisionActive,timestamp:x.timestamp,delta:e}),p.collisionEnd.length>0&&l.trigger(t,"collisionEnd",{pairs:p.collisionEnd,timestamp:x.timestamp,delta:e}),n._bodiesClearForces(v),l.trigger(t,"afterUpdate",g),t.timing.lastElapsed=u.now()-m,t},n.merge=function(t,e){if(u.extend(t,e),e.world){t.world=e.world,n.clear(t);for(var i=h.allBodies(t.world),r=0;r<i.length;r++){var s=i[r];o.set(s,!1),s.id=u.nextId()}}},n.clear=function(t){a.clear(t.pairs),s.clear(t.detector)},n._bodiesClearForces=function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i];n.force.x=0,n.force.y=0,n.torque=0}},n._bodiesApplyGravity=function(t,e){var i=void 0!==e.scale?e.scale:.001,n=t.length;if((0!==e.x||0!==e.y)&&0!==i)for(var o=0;o<n;o++){var r=t[o];r.isStatic||r.isSleeping||(r.force.y+=r.mass*e.y*i,r.force.x+=r.mass*e.x*i)}},n._bodiesUpdate=function(t,e){for(var i=t.length,n=0;n<i;n++){var o=t[n];o.isStatic||o.isSleeping||m.update(o,e)}},n._bodiesUpdateVelocities=function(t){for(var e=t.length,i=0;i<e;i++)m.updateVelocities(t[i])}},function(t,e,i){var n={};t.exports=n;var o=i(3),r=i(0),s=i(1);n._restingThresh=2,n._restingThreshTangent=Math.sqrt(6),n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n._frictionMaxStatic=Number.MAX_VALUE,n.preSolvePosition=function(t){var e,i,n,o=t.length;for(e=0;e<o;e++)(i=t[e]).isActive&&(n=i.contactCount,i.collision.parentA.totalContacts+=n,i.collision.parentB.totalContacts+=n)},n.solvePosition=function(t,e,i){var o,s,a,l,h,c,u,m,f=n._positionDampen*(i||1),d=r.clamp(e/r._baseDelta,0,1),p=t.length;for(o=0;o<p;o++)(s=t[o]).isActive&&!s.isSensor&&(l=(a=s.collision).parentA,h=a.parentB,c=a.normal,s.separation=a.depth+c.x*(h.positionImpulse.x-l.positionImpulse.x)+c.y*(h.positionImpulse.y-l.positionImpulse.y));for(o=0;o<p;o++)(s=t[o]).isActive&&!s.isSensor&&(l=(a=s.collision).parentA,h=a.parentB,c=a.normal,m=s.separation-s.slop*d,(l.isStatic||h.isStatic)&&(m*=2),l.isStatic||l.isSleeping||(u=f/l.totalContacts,l.positionImpulse.x+=c.x*m*u,l.positionImpulse.y+=c.y*m*u),h.isStatic||h.isSleeping||(u=f/h.totalContacts,h.positionImpulse.x-=c.x*m*u,h.positionImpulse.y-=c.y*m*u))},n.postSolvePosition=function(t){for(var e=n._positionWarming,i=t.length,r=o.translate,a=s.update,l=0;l<i;l++){var h=t[l],c=h.positionImpulse,u=c.x,m=c.y,f=h.velocity;if(h.totalContacts=0,0!==u||0!==m){for(var d=0;d<h.parts.length;d++){var p=h.parts[d];r(p.vertices,c),a(p.bounds,p.vertices,f),p.position.x+=u,p.position.y+=m}h.positionPrev.x+=u,h.positionPrev.y+=m,u*f.x+m*f.y<0?(c.x=0,c.y=0):(c.x*=e,c.y*=e)}}},n.preSolveVelocity=function(t){var e,i,n=t.length;for(e=0;e<n;e++){var o=t[e];if(o.isActive&&!o.isSensor){var r=o.contacts,s=o.contactCount,a=o.collision,l=a.parentA,h=a.parentB,c=a.normal,u=a.tangent;for(i=0;i<s;i++){var m=r[i],f=m.vertex,d=m.normalImpulse,p=m.tangentImpulse;if(0!==d||0!==p){var x=c.x*d+u.x*p,y=c.y*d+u.y*p;l.isStatic||l.isSleeping||(l.positionPrev.x+=x*l.inverseMass,l.positionPrev.y+=y*l.inverseMass,l.anglePrev+=l.inverseInertia*((f.x-l.position.x)*y-(f.y-l.position.y)*x)),h.isStatic||h.isSleeping||(h.positionPrev.x-=x*h.inverseMass,h.positionPrev.y-=y*h.inverseMass,h.anglePrev-=h.inverseInertia*((f.x-h.position.x)*y-(f.y-h.position.y)*x))}}}}},n.solveVelocity=function(t,e){var i,o,s,a,l=e/r._baseDelta,h=l*l*l,c=-n._restingThresh*l,u=n._restingThreshTangent,m=n._frictionNormalMultiplier*l,f=n._frictionMaxStatic,d=t.length;for(s=0;s<d;s++){var p=t[s];if(p.isActive&&!p.isSensor){var x=p.collision,y=x.parentA,g=x.parentB,v=x.normal.x,b=x.normal.y,w=x.tangent.x,M=x.tangent.y,j=p.inverseMass,C=p.friction*p.frictionStatic*m,S=p.contacts,z=p.contactCount,P=1/z,A=y.position.x-y.positionPrev.x,B=y.position.y-y.positionPrev.y,I=y.angle-y.anglePrev,_=g.position.x-g.positionPrev.x,R=g.position.y-g.positionPrev.y,T=g.angle-g.anglePrev;for(a=0;a<z;a++){var E=S[a],D=E.vertex,k=D.x-y.position.x,F=D.y-y.position.y,L=D.x-g.position.x,O=D.y-g.position.y,W=A-F*I-(_-O*T),N=B+k*I-(R+L*T),V=v*W+b*N,H=w*W+M*N,q=p.separation+V,G=Math.min(q,1),U=(G=q<0?0:G)*C;H<-U||H>U?(o=H>0?H:-H,(i=p.friction*(H>0?1:-1)*h)<-o?i=-o:i>o&&(i=o)):(i=H,o=f);var Z=k*b-F*v,Y=L*b-O*v,X=P/(j+y.inverseInertia*Z*Z+g.inverseInertia*Y*Y),K=(1+p.restitution)*V*X;if(i*=X,V<c)E.normalImpulse=0;else{var Q=E.normalImpulse;E.normalImpulse+=K,E.normalImpulse>0&&(E.normalImpulse=0),K=E.normalImpulse-Q}if(H<-u||H>u)E.tangentImpulse=0;else{var $=E.tangentImpulse;E.tangentImpulse+=i,E.tangentImpulse<-o&&(E.tangentImpulse=-o),E.tangentImpulse>o&&(E.tangentImpulse=o),i=E.tangentImpulse-$}var J=v*K+w*i,tt=b*K+M*i;y.isStatic||y.isSleeping||(y.positionPrev.x+=J*y.inverseMass,y.positionPrev.y+=tt*y.inverseMass,y.anglePrev+=(k*tt-F*J)*y.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=J*g.inverseMass,g.positionPrev.y-=tt*g.inverseMass,g.anglePrev-=(L*tt-O*J)*g.inverseInertia)}}}}},function(t,e,i){var n={};t.exports=n;var o=i(9),r=i(0);n.create=function(t){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},n.update=function(t,e,i){var n,r,s,a=o.update,l=o.create,h=o.setActive,c=t.table,u=t.list,m=u.length,f=m,d=t.collisionStart,p=t.collisionEnd,x=t.collisionActive,y=e.length,g=0,v=0,b=0;for(s=0;s<y;s++)(r=(n=e[s]).pair)?(r.isActive&&(x[b++]=r),a(r,n,i)):(c[(r=l(n,i)).id]=r,d[g++]=r,u[f++]=r);for(f=0,m=u.length,s=0;s<m;s++)(r=u[s]).timeUpdated>=i?u[f++]=r:(h(r,!1,i),r.collision.bodyA.sleepCounter>0&&r.collision.bodyB.sleepCounter>0?u[f++]=r:(p[v++]=r,delete c[r.id]));u.length!==f&&(u.length=f),d.length!==g&&(d.length=g),p.length!==v&&(p.length=v),x.length!==b&&(x.length=b)},n.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}},function(t,e,i){var n=t.exports=i(21);n.Axes=i(11),n.Bodies=i(12),n.Body=i(4),n.Bounds=i(1),n.Collision=i(8),n.Common=i(0),n.Composite=i(6),n.Composites=i(22),n.Constraint=i(10),n.Contact=i(16),n.Detector=i(13),n.Engine=i(17),n.Events=i(5),n.Grid=i(23),n.Mouse=i(14),n.MouseConstraint=i(24),n.Pair=i(9),n.Pairs=i(19),n.Plugin=i(15),n.Query=i(25),n.Render=i(26),n.Resolver=i(18),n.Runner=i(27),n.SAT=i(28),n.Sleeping=i(7),n.Svg=i(29),n.Vector=i(2),n.Vertices=i(3),n.World=i(30),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(t,e,i){var n={};t.exports=n;var o=i(15),r=i(0);n.name="matter-js",n.version="0.20.0",n.uses=[],n.used=[],n.use=function(){o.use(n,Array.prototype.slice.call(arguments))},n.before=function(t,e){return t=t.replace(/^Matter./,""),r.chainPathBefore(n,t,e)},n.after=function(t,e){return t=t.replace(/^Matter./,""),r.chainPathAfter(n,t,e)}},function(t,e,i){var n={};t.exports=n;var o=i(6),r=i(10),s=i(0),a=i(4),l=i(12),h=s.deprecated;n.stack=function(t,e,i,n,r,s,l){for(var h,c=o.create({label:"Stack"}),u=t,m=e,f=0,d=0;d<n;d++){for(var p=0,x=0;x<i;x++){var y=l(u,m,x,d,h,f);if(y){var g=y.bounds.max.y-y.bounds.min.y,v=y.bounds.max.x-y.bounds.min.x;g>p&&(p=g),a.translate(y,{x:.5*v,y:.5*g}),u=y.bounds.max.x+r,o.addBody(c,y),h=y,f+=1}else u+=r}m+=p+s,u=t}return c},n.chain=function(t,e,i,n,a,l){for(var h=t.bodies,c=1;c<h.length;c++){var u=h[c-1],m=h[c],f=u.bounds.max.y-u.bounds.min.y,d=u.bounds.max.x-u.bounds.min.x,p=m.bounds.max.y-m.bounds.min.y,x={bodyA:u,pointA:{x:d*e,y:f*i},bodyB:m,pointB:{x:(m.bounds.max.x-m.bounds.min.x)*n,y:p*a}},y=s.extend(x,l);o.addConstraint(t,r.create(y))}return t.label+=" Chain",t},n.mesh=function(t,e,i,n,a){var l,h,c,u,m,f=t.bodies;for(l=0;l<i;l++){for(h=1;h<e;h++)c=f[h-1+l*e],u=f[h+l*e],o.addConstraint(t,r.create(s.extend({bodyA:c,bodyB:u},a)));if(l>0)for(h=0;h<e;h++)c=f[h+(l-1)*e],u=f[h+l*e],o.addConstraint(t,r.create(s.extend({bodyA:c,bodyB:u},a))),n&&h>0&&(m=f[h-1+(l-1)*e],o.addConstraint(t,r.create(s.extend({bodyA:m,bodyB:u},a)))),n&&h<e-1&&(m=f[h+1+(l-1)*e],o.addConstraint(t,r.create(s.extend({bodyA:m,bodyB:u},a))))}return t.label+=" Mesh",t},n.pyramid=function(t,e,i,o,r,s,l){return n.stack(t,e,i,o,r,s,(function(e,n,s,h,c,u){var m=Math.min(o,Math.ceil(i/2)),f=c?c.bounds.max.x-c.bounds.min.x:0;if(!(h>m||s<(h=m-h)||s>i-1-h))return 1===u&&a.translate(c,{x:(s+(i%2==1?1:-1))*f,y:0}),l(t+(c?s*f:0)+s*r,n,s,h,c,u)}))},n.newtonsCradle=function(t,e,i,n,s){for(var a=o.create({label:"Newtons Cradle"}),h=0;h<i;h++){var c=l.circle(t+h*(1.9*n),e+s,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=r.create({pointA:{x:t+h*(1.9*n),y:e},bodyB:c});o.addBody(a,c),o.addConstraint(a,u)}return a},h(n,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),n.car=function(t,e,i,n,s){var h=a.nextGroup(!0),c=.5*-i+20,u=.5*i-20,m=o.create({label:"Car"}),f=l.rectangle(t,e,i,n,{collisionFilter:{group:h},chamfer:{radius:.5*n},density:2e-4}),d=l.circle(t+c,e+0,s,{collisionFilter:{group:h},friction:.8}),p=l.circle(t+u,e+0,s,{collisionFilter:{group:h},friction:.8}),x=r.create({bodyB:f,pointB:{x:c,y:0},bodyA:d,stiffness:1,length:0}),y=r.create({bodyB:f,pointB:{x:u,y:0},bodyA:p,stiffness:1,length:0});return o.addBody(m,f),o.addBody(m,d),o.addBody(m,p),o.addConstraint(m,x),o.addConstraint(m,y),m},h(n,"car","Composites.car ➤ moved to car example"),n.softBody=function(t,e,i,o,r,a,h,c,u,m){u=s.extend({inertia:1/0},u),m=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},m);var f=n.stack(t,e,i,o,r,a,(function(t,e){return l.circle(t,e,c,u)}));return n.mesh(f,i,o,h,m),f.label="Soft Body",f},h(n,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(t,e,i){var n={};t.exports=n;var o=i(9),r=i(0),s=r.deprecated;n.create=function(t){return r.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},t)},n.update=function(t,e,i,o){var r,s,a,l,h,c=i.world,u=t.buckets,m=!1;for(r=0;r<e.length;r++){var f=e[r];if((!f.isSleeping||o)&&(!c.bounds||!(f.bounds.max.x<c.bounds.min.x||f.bounds.min.x>c.bounds.max.x||f.bounds.max.y<c.bounds.min.y||f.bounds.min.y>c.bounds.max.y))){var d=n._getRegion(t,f);if(!f.region||d.id!==f.region.id||o){f.region&&!o||(f.region=d);var p=n._regionUnion(d,f.region);for(s=p.startCol;s<=p.endCol;s++)for(a=p.startRow;a<=p.endRow;a++){l=u[h=n._getBucketId(s,a)];var x=s>=d.startCol&&s<=d.endCol&&a>=d.startRow&&a<=d.endRow,y=s>=f.region.startCol&&s<=f.region.endCol&&a>=f.region.startRow&&a<=f.region.endRow;!x&&y&&y&&l&&n._bucketRemoveBody(t,l,f),(f.region===d||x&&!y||o)&&(l||(l=n._createBucket(u,h)),n._bucketAddBody(t,l,f))}f.region=d,m=!0}}}m&&(t.pairsList=n._createActivePairsList(t))},s(n,"update","Grid.update ➤ replaced by Matter.Detector"),n.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},s(n,"clear","Grid.clear ➤ replaced by Matter.Detector"),n._regionUnion=function(t,e){var i=Math.min(t.startCol,e.startCol),o=Math.max(t.endCol,e.endCol),r=Math.min(t.startRow,e.startRow),s=Math.max(t.endRow,e.endRow);return n._createRegion(i,o,r,s)},n._getRegion=function(t,e){var i=e.bounds,o=Math.floor(i.min.x/t.bucketWidth),r=Math.floor(i.max.x/t.bucketWidth),s=Math.floor(i.min.y/t.bucketHeight),a=Math.floor(i.max.y/t.bucketHeight);return n._createRegion(o,r,s,a)},n._createRegion=function(t,e,i,n){return{id:t+","+e+","+i+","+n,startCol:t,endCol:e,startRow:i,endRow:n}},n._getBucketId=function(t,e){return"C"+t+"R"+e},n._createBucket=function(t,e){return t[e]=[]},n._bucketAddBody=function(t,e,i){var n,r=t.pairs,s=o.id,a=e.length;for(n=0;n<a;n++){var l=e[n];if(!(i.id===l.id||i.isStatic&&l.isStatic)){var h=s(i,l),c=r[h];c?c[2]+=1:r[h]=[i,l,1]}}e.push(i)},n._bucketRemoveBody=function(t,e,i){var n,s=t.pairs,a=o.id;e.splice(r.indexOf(e,i),1);var l=e.length;for(n=0;n<l;n++){var h=s[a(i,e[n])];h&&(h[2]-=1)}},n._createActivePairsList=function(t){var e,i,n=t.pairs,o=r.keys(n),s=o.length,a=[];for(i=0;i<s;i++)(e=n[o[i]])[2]>0?a.push(e):delete n[o[i]];return a}},function(t,e,i){var n={};t.exports=n;var o=i(3),r=i(7),s=i(14),a=i(5),l=i(13),h=i(10),c=i(6),u=i(0),m=i(1);n.create=function(t,e){var i=(t?t.mouse:null)||(e?e.mouse:null);i||(t&&t.render&&t.render.canvas?i=s.create(t.render.canvas):e&&e.element?i=s.create(e.element):(i=s.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var o={type:"mouseConstraint",mouse:i,element:null,body:null,constraint:h.create({label:"Mouse Constraint",pointA:i.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},r=u.extend(o,e);return a.on(t,"beforeUpdate",(function(){var e=c.allBodies(t.world);n.update(r,e),n._triggerEvents(r)})),r},n.update=function(t,e){var i=t.mouse,n=t.constraint,s=t.body;if(0===i.button){if(n.bodyB)r.set(n.bodyB,!1),n.pointA=i.position;else for(var h=0;h<e.length;h++)if(s=e[h],m.contains(s.bounds,i.position)&&l.canCollide(s.collisionFilter,t.collisionFilter))for(var c=s.parts.length>1?1:0;c<s.parts.length;c++){var u=s.parts[c];if(o.contains(u.vertices,i.position)){n.pointA=i.position,n.bodyB=t.body=s,n.pointB={x:i.position.x-s.position.x,y:i.position.y-s.position.y},n.angleB=s.angle,r.set(s,!1),a.trigger(t,"startdrag",{mouse:i,body:s});break}}}else n.bodyB=t.body=null,n.pointB=null,s&&a.trigger(t,"enddrag",{mouse:i,body:s})},n._triggerEvents=function(t){var e=t.mouse,i=e.sourceEvents;i.mousemove&&a.trigger(t,"mousemove",{mouse:e}),i.mousedown&&a.trigger(t,"mousedown",{mouse:e}),i.mouseup&&a.trigger(t,"mouseup",{mouse:e}),s.clearSourceEvents(e)}},function(t,e,i){var n={};t.exports=n;var o=i(2),r=i(8),s=i(1),a=i(12),l=i(3);n.collides=function(t,e){for(var i=[],n=e.length,o=t.bounds,a=r.collides,l=s.overlaps,h=0;h<n;h++){var c=e[h],u=c.parts.length,m=1===u?0:1;if(l(c.bounds,o))for(var f=m;f<u;f++){var d=c.parts[f];if(l(d.bounds,o)){var p=a(d,t);if(p){i.push(p);break}}}}return i},n.ray=function(t,e,i,r){r=r||1e-100;for(var s=o.angle(e,i),l=o.magnitude(o.sub(e,i)),h=.5*(i.x+e.x),c=.5*(i.y+e.y),u=a.rectangle(h,c,l,r,{angle:s}),m=n.collides(u,t),f=0;f<m.length;f+=1){var d=m[f];d.body=d.bodyB=d.bodyA}return m},n.region=function(t,e,i){for(var n=[],o=0;o<t.length;o++){var r=t[o],a=s.overlaps(r.bounds,e);(a&&!i||!a&&i)&&n.push(r)}return n},n.point=function(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n];if(s.contains(o.bounds,e))for(var r=1===o.parts.length?0:1;r<o.parts.length;r++){var a=o.parts[r];if(s.contains(a.bounds,e)&&l.contains(a.vertices,e)){i.push(o);break}}}return i}},function(t,e,i){var n={};t.exports=n;var o=i(4),r=i(0),s=i(6),a=i(1),l=i(5),h=i(2),c=i(14);!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout((function(){t(r.now())}),1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n._goodFps=30,n._goodDelta=1e3/60,n.create=function(t){var e={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},i=r.extend(e,t);return i.canvas&&(i.canvas.width=i.options.width||i.canvas.width,i.canvas.height=i.options.height||i.canvas.height),i.mouse=t.mouse,i.engine=t.engine,i.canvas=i.canvas||m(i.options.width,i.options.height),i.context=i.canvas.getContext("2d"),i.textures={},i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.canvas.width,y:i.canvas.height}},i.controller=n,i.options.showBroadphase=!1,1!==i.options.pixelRatio&&n.setPixelRatio(i,i.options.pixelRatio),r.isElement(i.element)&&i.element.appendChild(i.canvas),i},n.run=function(e){!function o(r){e.frameRequestId=t(o),i(e,r),n.world(e,r),e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0),(e.options.showStats||e.options.showDebug)&&n.stats(e,e.context,r),(e.options.showPerformance||e.options.showDebug)&&n.performance(e,e.context,r),e.context.setTransform(1,0,0,1,0,0)}()},n.stop=function(t){e(t.frameRequestId)},n.setPixelRatio=function(t,e){var i=t.options,n=t.canvas;"auto"===e&&(e=f(n)),i.pixelRatio=e,n.setAttribute("data-pixel-ratio",e),n.width=i.width*e,n.height=i.height*e,n.style.width=i.width+"px",n.style.height=i.height+"px"},n.setSize=function(t,e,i){t.options.width=e,t.options.height=i,t.bounds.max.x=t.bounds.min.x+e,t.bounds.max.y=t.bounds.min.y+i,1!==t.options.pixelRatio?n.setPixelRatio(t,t.options.pixelRatio):(t.canvas.width=e,t.canvas.height=i)},n.lookAt=function(t,e,i,n){n=void 0===n||n,e=r.isArray(e)?e:[e],i=i||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<e.length;s+=1){var a=e[s],l=a.bounds?a.bounds.min:a.min||a.position||a,h=a.bounds?a.bounds.max:a.max||a.position||a;l&&h&&(l.x<o.min.x&&(o.min.x=l.x),h.x>o.max.x&&(o.max.x=h.x),l.y<o.min.y&&(o.min.y=l.y),h.y>o.max.y&&(o.max.y=h.y))}var u=o.max.x-o.min.x+2*i.x,m=o.max.y-o.min.y+2*i.y,f=t.canvas.height,d=t.canvas.width/f,p=u/m,x=1,y=1;p>d?y=p/d:x=d/p,t.options.hasBounds=!0,t.bounds.min.x=o.min.x,t.bounds.max.x=o.min.x+u*x,t.bounds.min.y=o.min.y,t.bounds.max.y=o.min.y+m*y,n&&(t.bounds.min.x+=.5*u-u*x*.5,t.bounds.max.x+=.5*u-u*x*.5,t.bounds.min.y+=.5*m-m*y*.5,t.bounds.max.y+=.5*m-m*y*.5),t.bounds.min.x-=i.x,t.bounds.max.x-=i.x,t.bounds.min.y-=i.y,t.bounds.max.y-=i.y,t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),c.setOffset(t.mouse,t.bounds.min))},n.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,i=t.bounds.max.y-t.bounds.min.y,n=e/t.options.width,o=i/t.options.height;t.context.setTransform(t.options.pixelRatio/n,0,0,t.options.pixelRatio/o,0,0),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},n.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},n.world=function(t,e){var i,o=r.now(),u=t.engine,m=u.world,f=t.canvas,d=t.context,x=t.options,y=t.timing,g=s.allBodies(m),v=s.allConstraints(m),b=x.wireframes?x.wireframeBackground:x.background,w=[],M=[],j={timestamp:u.timing.timestamp};if(l.trigger(t,"beforeRender",j),t.currentBackground!==b&&p(t,b),d.globalCompositeOperation="source-in",d.fillStyle="transparent",d.fillRect(0,0,f.width,f.height),d.globalCompositeOperation="source-over",x.hasBounds){for(i=0;i<g.length;i++){var C=g[i];a.overlaps(C.bounds,t.bounds)&&w.push(C)}for(i=0;i<v.length;i++){var S=v[i],z=S.bodyA,P=S.bodyB,A=S.pointA,B=S.pointB;z&&(A=h.add(z.position,S.pointA)),P&&(B=h.add(P.position,S.pointB)),A&&B&&(a.contains(t.bounds,A)||a.contains(t.bounds,B))&&M.push(S)}n.startViewTransform(t),t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),c.setOffset(t.mouse,t.bounds.min))}else M=v,w=g,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!x.wireframes||u.enableSleeping&&x.showSleeping?n.bodies(t,w,d):(x.showConvexHulls&&n.bodyConvexHulls(t,w,d),n.bodyWireframes(t,w,d)),x.showBounds&&n.bodyBounds(t,w,d),(x.showAxes||x.showAngleIndicator)&&n.bodyAxes(t,w,d),x.showPositions&&n.bodyPositions(t,w,d),x.showVelocity&&n.bodyVelocity(t,w,d),x.showIds&&n.bodyIds(t,w,d),x.showSeparations&&n.separations(t,u.pairs.list,d),x.showCollisions&&n.collisions(t,u.pairs.list,d),x.showVertexNumbers&&n.vertexNumbers(t,w,d),x.showMousePosition&&n.mousePosition(t,t.mouse,d),n.constraints(M,d),x.hasBounds&&n.endViewTransform(t),l.trigger(t,"afterRender",j),y.lastElapsed=r.now()-o},n.stats=function(t,e,i){for(var n=t.engine,o=n.world,r=s.allBodies(o),a=0,l=0,h=0;h<r.length;h+=1)a+=r[h].parts.length;var c={Part:a,Body:r.length,Cons:s.allConstraints(o).length,Comp:s.allComposites(o).length,Pair:n.pairs.list.length};for(var u in e.fillStyle="#0e0f19",e.fillRect(l,0,302.5,44),e.font="12px Arial",e.textBaseline="top",e.textAlign="right",c){var m=c[u];e.fillStyle="#aaa",e.fillText(u,l+55,8),e.fillStyle="#eee",e.fillText(m,l+55,26),l+=55}},n.performance=function(t,e){var i=t.engine,o=t.timing,s=o.deltaHistory,a=o.elapsedHistory,l=o.timestampElapsedHistory,h=o.engineDeltaHistory,c=o.engineUpdatesHistory,m=o.engineElapsedHistory,f=i.timing.lastUpdatesPerFrame,d=i.timing.lastDelta,p=u(s),x=u(a),y=u(h),g=u(c),v=u(m),b=u(l)/p||0,w=Math.round(p/d),M=1e3/p||0,j=60,C=69;e.fillStyle="#0e0f19",e.fillRect(0,50,442,34),n.status(e,10,C,j,4,s.length,Math.round(M)+" fps",M/n._goodFps,(function(t){return s[t]/p-1})),n.status(e,82,C,j,4,h.length,d.toFixed(2)+" dt",n._goodDelta/d,(function(t){return h[t]/y-1})),n.status(e,154,C,j,4,c.length,f+" upf",Math.pow(r.clamp(g/w||1,0,1),4),(function(t){return c[t]/g-1})),n.status(e,226,C,j,4,m.length,v.toFixed(2)+" ut",1-f*v/n._goodFps,(function(t){return m[t]/v-1})),n.status(e,298,C,j,4,a.length,x.toFixed(2)+" rt",1-x/n._goodFps,(function(t){return a[t]/x-1})),n.status(e,370,C,j,4,l.length,b.toFixed(2)+" x",b*b*b,(function(t){return(l[t]/s[t]/b||0)-1}))},n.status=function(t,e,i,n,o,s,a,l,h){t.strokeStyle="#888",t.fillStyle="#444",t.lineWidth=1,t.fillRect(e,i+7,n,1),t.beginPath(),t.moveTo(e,i+7-o*r.clamp(.4*h(0),-2,2));for(var c=0;c<n;c+=1)t.lineTo(e+c,i+7-(c<s?o*r.clamp(.4*h(c),-2,2):0));t.stroke(),t.fillStyle="hsl("+r.clamp(25+95*l,0,120)+",100%,60%)",t.fillRect(e,i-7,4,4),t.font="12px Arial",t.textBaseline="middle",t.textAlign="right",t.fillStyle="#eee",t.fillText(a,e+n,i-5)},n.constraints=function(t,e){for(var i=e,n=0;n<t.length;n++){var o=t[n];if(o.render.visible&&o.pointA&&o.pointB){var s,a,l=o.bodyA,c=o.bodyB;if(s=l?h.add(l.position,o.pointA):o.pointA,"pin"===o.render.type)i.beginPath(),i.arc(s.x,s.y,3,0,2*Math.PI),i.closePath();else{if(a=c?h.add(c.position,o.pointB):o.pointB,i.beginPath(),i.moveTo(s.x,s.y),"spring"===o.render.type)for(var u,m=h.sub(a,s),f=h.perp(h.normalise(m)),d=Math.ceil(r.clamp(o.length/5,12,20)),p=1;p<d;p+=1)u=p%2==0?1:-1,i.lineTo(s.x+m.x*(p/d)+f.x*u*4,s.y+m.y*(p/d)+f.y*u*4);i.lineTo(a.x,a.y)}o.render.lineWidth&&(i.lineWidth=o.render.lineWidth,i.strokeStyle=o.render.strokeStyle,i.stroke()),o.render.anchors&&(i.fillStyle=o.render.strokeStyle,i.beginPath(),i.arc(s.x,s.y,3,0,2*Math.PI),i.arc(a.x,a.y,3,0,2*Math.PI),i.closePath(),i.fill())}}},n.bodies=function(t,e,i){var n,o,r,s,a=i,l=(t.engine,t.options),h=l.showInternalEdges||!l.wireframes;for(r=0;r<e.length;r++)if((n=e[r]).render.visible)for(s=n.parts.length>1?1:0;s<n.parts.length;s++)if((o=n.parts[s]).render.visible){if(l.showSleeping&&n.isSleeping?a.globalAlpha=.5*o.render.opacity:1!==o.render.opacity&&(a.globalAlpha=o.render.opacity),o.render.sprite&&o.render.sprite.texture&&!l.wireframes){var c=o.render.sprite,u=d(t,c.texture);a.translate(o.position.x,o.position.y),a.rotate(o.angle),a.drawImage(u,u.width*-c.xOffset*c.xScale,u.height*-c.yOffset*c.yScale,u.width*c.xScale,u.height*c.yScale),a.rotate(-o.angle),a.translate(-o.position.x,-o.position.y)}else{if(o.circleRadius)a.beginPath(),a.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(o.vertices[0].x,o.vertices[0].y);for(var m=1;m<o.vertices.length;m++)!o.vertices[m-1].isInternal||h?a.lineTo(o.vertices[m].x,o.vertices[m].y):a.moveTo(o.vertices[m].x,o.vertices[m].y),o.vertices[m].isInternal&&!h&&a.moveTo(o.vertices[(m+1)%o.vertices.length].x,o.vertices[(m+1)%o.vertices.length].y);a.lineTo(o.vertices[0].x,o.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle=t.options.wireframeStrokeStyle,a.stroke()):(a.fillStyle=o.render.fillStyle,o.render.lineWidth&&(a.lineWidth=o.render.lineWidth,a.strokeStyle=o.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},n.bodyWireframes=function(t,e,i){var n,o,r,s,a,l=i,h=t.options.showInternalEdges;for(l.beginPath(),r=0;r<e.length;r++)if((n=e[r]).render.visible)for(a=n.parts.length>1?1:0;a<n.parts.length;a++){for(o=n.parts[a],l.moveTo(o.vertices[0].x,o.vertices[0].y),s=1;s<o.vertices.length;s++)!o.vertices[s-1].isInternal||h?l.lineTo(o.vertices[s].x,o.vertices[s].y):l.moveTo(o.vertices[s].x,o.vertices[s].y),o.vertices[s].isInternal&&!h&&l.moveTo(o.vertices[(s+1)%o.vertices.length].x,o.vertices[(s+1)%o.vertices.length].y);l.lineTo(o.vertices[0].x,o.vertices[0].y)}l.lineWidth=1,l.strokeStyle=t.options.wireframeStrokeStyle,l.stroke()},n.bodyConvexHulls=function(t,e,i){var n,o,r,s=i;for(s.beginPath(),o=0;o<e.length;o++)if((n=e[o]).render.visible&&1!==n.parts.length){for(s.moveTo(n.vertices[0].x,n.vertices[0].y),r=1;r<n.vertices.length;r++)s.lineTo(n.vertices[r].x,n.vertices[r].y);s.lineTo(n.vertices[0].x,n.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},n.vertexNumbers=function(t,e,i){var n,o,r,s=i;for(n=0;n<e.length;n++){var a=e[n].parts;for(r=a.length>1?1:0;r<a.length;r++){var l=a[r];for(o=0;o<l.vertices.length;o++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(n+"_"+o,l.position.x+.8*(l.vertices[o].x-l.position.x),l.position.y+.8*(l.vertices[o].y-l.position.y))}}},n.mousePosition=function(t,e,i){var n=i;n.fillStyle="rgba(255,255,255,0.8)",n.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},n.bodyBounds=function(t,e,i){var n=i,o=(t.engine,t.options);n.beginPath();for(var r=0;r<e.length;r++)if(e[r].render.visible)for(var s=e[r].parts,a=s.length>1?1:0;a<s.length;a++){var l=s[a];n.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}o.wireframes?n.strokeStyle="rgba(255,255,255,0.08)":n.strokeStyle="rgba(0,0,0,0.1)",n.lineWidth=1,n.stroke()},n.bodyAxes=function(t,e,i){var n,o,r,s,a=i,l=(t.engine,t.options);for(a.beginPath(),o=0;o<e.length;o++){var h=e[o],c=h.parts;if(h.render.visible)if(l.showAxes)for(r=c.length>1?1:0;r<c.length;r++)for(n=c[r],s=0;s<n.axes.length;s++){var u=n.axes[s];a.moveTo(n.position.x,n.position.y),a.lineTo(n.position.x+20*u.x,n.position.y+20*u.y)}else for(r=c.length>1?1:0;r<c.length;r++)for(n=c[r],s=0;s<n.axes.length;s++)a.moveTo(n.position.x,n.position.y),a.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},n.bodyPositions=function(t,e,i){var n,o,r,s,a=i,l=(t.engine,t.options);for(a.beginPath(),r=0;r<e.length;r++)if((n=e[r]).render.visible)for(s=0;s<n.parts.length;s++)o=n.parts[s],a.arc(o.position.x,o.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),r=0;r<e.length;r++)(n=e[r]).render.visible&&(a.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},n.bodyVelocity=function(t,e,i){var n=i;n.beginPath();for(var r=0;r<e.length;r++){var s=e[r];if(s.render.visible){var a=o.getVelocity(s);n.moveTo(s.position.x,s.position.y),n.lineTo(s.position.x+a.x,s.position.y+a.y)}}n.lineWidth=3,n.strokeStyle="cornflowerblue",n.stroke()},n.bodyIds=function(t,e,i){var n,o,r=i;for(n=0;n<e.length;n++)if(e[n].render.visible){var s=e[n].parts;for(o=s.length>1?1:0;o<s.length;o++){var a=s[o];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(a.id,a.position.x+10,a.position.y-10)}}},n.collisions=function(t,e,i){var n,o,r,s,a=i,l=t.options;for(a.beginPath(),r=0;r<e.length;r++)if((n=e[r]).isActive)for(o=n.collision,s=0;s<n.contactCount;s++){var h=n.contacts[s].vertex;a.rect(h.x-1.5,h.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),r=0;r<e.length;r++)if((n=e[r]).isActive&&(o=n.collision,n.contactCount>0)){var c=n.contacts[0].vertex.x,u=n.contacts[0].vertex.y;2===n.contactCount&&(c=(n.contacts[0].vertex.x+n.contacts[1].vertex.x)/2,u=(n.contacts[0].vertex.y+n.contacts[1].vertex.y)/2),o.bodyB===o.supports[0].body||!0===o.bodyA.isStatic?a.moveTo(c-8*o.normal.x,u-8*o.normal.y):a.moveTo(c+8*o.normal.x,u+8*o.normal.y),a.lineTo(c,u)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},n.separations=function(t,e,i){var n,o,r,s,a,l=i,h=t.options;for(l.beginPath(),a=0;a<e.length;a++)if((n=e[a]).isActive){r=(o=n.collision).bodyA;var c=1;(s=o.bodyB).isStatic||r.isStatic||(c=.5),s.isStatic&&(c=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x-o.penetration.x*c,s.position.y-o.penetration.y*c),c=1,s.isStatic||r.isStatic||(c=.5),r.isStatic&&(c=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+o.penetration.x*c,r.position.y+o.penetration.y*c)}h.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},n.inspector=function(t,e){t.engine;var i,n=t.selected,o=t.render,r=o.options;if(r.hasBounds){var s=o.bounds.max.x-o.bounds.min.x,a=o.bounds.max.y-o.bounds.min.y,l=s/o.options.width,h=a/o.options.height;e.scale(1/l,1/h),e.translate(-o.bounds.min.x,-o.bounds.min.y)}for(var c=0;c<n.length;c++){var u=n[c].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":i=u.bounds,e.beginPath(),e.rect(Math.floor(i.min.x-3),Math.floor(i.min.y-3),Math.floor(i.max.x-i.min.x+6),Math.floor(i.max.y-i.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var m=u.pointA;u.bodyA&&(m=u.pointB),e.beginPath(),e.arc(m.x,m.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",i=t.selectBounds,e.beginPath(),e.rect(Math.floor(i.min.x),Math.floor(i.min.y),Math.floor(i.max.x-i.min.x),Math.floor(i.max.y-i.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),r.hasBounds&&e.setTransform(1,0,0,1,0,0)};var i=function(t,e){var i=t.engine,o=t.timing,r=o.historySize,s=i.timing.timestamp;o.delta=e-o.lastTime||n._goodDelta,o.lastTime=e,o.timestampElapsed=s-o.lastTimestamp||0,o.lastTimestamp=s,o.deltaHistory.unshift(o.delta),o.deltaHistory.length=Math.min(o.deltaHistory.length,r),o.engineDeltaHistory.unshift(i.timing.lastDelta),o.engineDeltaHistory.length=Math.min(o.engineDeltaHistory.length,r),o.timestampElapsedHistory.unshift(o.timestampElapsed),o.timestampElapsedHistory.length=Math.min(o.timestampElapsedHistory.length,r),o.engineUpdatesHistory.unshift(i.timing.lastUpdatesPerFrame),o.engineUpdatesHistory.length=Math.min(o.engineUpdatesHistory.length,r),o.engineElapsedHistory.unshift(i.timing.lastElapsed),o.engineElapsedHistory.length=Math.min(o.engineElapsedHistory.length,r),o.elapsedHistory.unshift(o.lastElapsed),o.elapsedHistory.length=Math.min(o.elapsedHistory.length,r)},u=function(t){for(var e=0,i=0;i<t.length;i+=1)e+=t[i];return e/t.length||0},m=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i},f=function(t){var e=t.getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},d=function(t,e){var i=t.textures[e];return i||((i=t.textures[e]=new Image).src=e,i)},p=function(t,e){var i=e;/(jpg|gif|png)$/.test(e)&&(i="url("+e+")"),t.canvas.style.background=i,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},function(t,e,i){var n={};t.exports=n;var o=i(5),r=i(17),s=i(0);!function(){n._maxFrameDelta=1e3/15,n._frameDeltaFallback=1e3/60,n._timeBufferMargin=1.5,n._elapsedNextEstimate=1,n._smoothingLowerBound=.1,n._smoothingUpperBound=.9,n.create=function(t){var e=s.extend({delta:1e3/60,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:1e3/30,lastUpdatesDeferred:0,enabled:!0},t);return e.fps=0,e},n.run=function(t,e){return t.timeBuffer=n._frameDeltaFallback,function i(o){t.frameRequestId=n._onNextFrame(t,i),o&&t.enabled&&n.tick(t,e,o)}(),t},n.tick=function(e,i,a){var l=s.now(),h=e.delta,c=0,u=a-e.timeLastTick;if((!u||!e.timeLastTick||u>Math.max(n._maxFrameDelta,e.maxFrameTime))&&(u=e.frameDelta||n._frameDeltaFallback),e.frameDeltaSmoothing){e.frameDeltaHistory.push(u),e.frameDeltaHistory=e.frameDeltaHistory.slice(-e.frameDeltaHistorySize);var m=e.frameDeltaHistory.slice(0).sort(),f=e.frameDeltaHistory.slice(m.length*n._smoothingLowerBound,m.length*n._smoothingUpperBound);u=t(f)||u}e.frameDeltaSnapping&&(u=1e3/Math.round(1e3/u)),e.frameDelta=u,e.timeLastTick=a,e.timeBuffer+=e.frameDelta,e.timeBuffer=s.clamp(e.timeBuffer,0,e.frameDelta+h*n._timeBufferMargin),e.lastUpdatesDeferred=0;var d=e.maxUpdates||Math.ceil(e.maxFrameTime/h),p={timestamp:i.timing.timestamp};o.trigger(e,"beforeTick",p),o.trigger(e,"tick",p);for(var x=s.now();h>0&&e.timeBuffer>=h*n._timeBufferMargin;){o.trigger(e,"beforeUpdate",p),r.update(i,h),o.trigger(e,"afterUpdate",p),e.timeBuffer-=h,c+=1;var y=s.now()-l,g=s.now()-x,v=y+n._elapsedNextEstimate*g/c;if(c>=d||v>e.maxFrameTime){e.lastUpdatesDeferred=Math.round(Math.max(0,e.timeBuffer/h-n._timeBufferMargin));break}}i.timing.lastUpdatesPerFrame=c,o.trigger(e,"afterTick",p),e.frameDeltaHistory.length>=100&&(e.lastUpdatesDeferred&&Math.round(e.frameDelta/h)>d?s.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):e.lastUpdatesDeferred&&s.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),void 0!==e.isFixed&&s.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(e.deltaMin||e.deltaMax)&&s.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),0!==e.fps&&s.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},n.stop=function(t){n._cancelNextFrame(t)},n._onNextFrame=function(t,e){if("undefined"==typeof window||!window.requestAnimationFrame)throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return t.frameRequestId=window.requestAnimationFrame(e),t.frameRequestId},n._cancelNextFrame=function(t){if("undefined"==typeof window||!window.cancelAnimationFrame)throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.");window.cancelAnimationFrame(t.frameRequestId)};var t=function(t){for(var e=0,i=t.length,n=0;n<i;n+=1)e+=t[n];return e/i||0}}()},function(t,e,i){var n={};t.exports=n;var o=i(8),r=i(0).deprecated;n.collides=function(t,e){return o.collides(t,e)},r(n,"collides","SAT.collides ➤ replaced by Collision.collides")},function(t,e,i){var n={};t.exports=n,i(1);var o=i(0);n.pathToVertices=function(t,e){"undefined"==typeof window||"SVGPathSeg"in window||o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var i,r,s,a,l,h,c,u,m,f,d,p=[],x=0,y=0,g=0;e=e||15;var v=function(t,e,i){var n=i%2==1&&i>1;if(!m||t!=m.x||e!=m.y){m&&n?(f=m.x,d=m.y):(f=0,d=0);var o={x:f+t,y:d+e};!n&&m||(m=o),p.push(o),y=f+t,g=d+e}},b=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":y=t.x,g=t.y;break;case"H":y=t.x;break;case"V":g=t.y}v(y,g,t.pathSegType)}};for(n._svgPathToAbsolute(t),s=t.getTotalLength(),h=[],i=0;i<t.pathSegList.numberOfItems;i+=1)h.push(t.pathSegList.getItem(i));for(c=h.concat();x<s;){if((l=h[t.getPathSegAtLength(x)])!=u){for(;c.length&&c[0]!=l;)b(c.shift());u=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=t.getPointAtLength(x),v(a.x,a.y,0)}x+=e}for(i=0,r=c.length;i<r;++i)b(c[i]);return p},n._svgPathToAbsolute=function(t){for(var e,i,n,o,r,s,a=t.pathSegList,l=0,h=0,c=a.numberOfItems,u=0;u<c;++u){var m=a.getItem(u),f=m.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in m&&(l=m.x),"y"in m&&(h=m.y);else switch("x1"in m&&(n=l+m.x1),"x2"in m&&(r=l+m.x2),"y1"in m&&(o=h+m.y1),"y2"in m&&(s=h+m.y2),"x"in m&&(l+=m.x),"y"in m&&(h+=m.y),f){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(l,h),u);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(l,h),u);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(h),u);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(l,h,n,o,r,s),u);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(l,h,r,s),u);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(l,h,n,o),u);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(l,h),u);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(l,h,m.r1,m.r2,m.angle,m.largeArcFlag,m.sweepFlag),u);break;case"z":case"Z":l=e,h=i}"M"!=f&&"m"!=f||(e=l,i=h)}}},function(t,e,i){var n={};t.exports=n;var o=i(6);i(0),n.create=o.create,n.add=o.add,n.remove=o.remove,n.clear=o.clear,n.addComposite=o.addComposite,n.addBody=o.addBody,n.addConstraint=o.addConstraint}])},t.exports=n()},3379:t=>{"use strict";var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var r={},s=[],a=0;a<t.length;a++){var l=t[a],h=n.base?l[0]+n.base:l[0],c=r[h]||0,u="".concat(h," ").concat(c);r[h]=c+1;var m=i(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)e[m].references++,e[m].updater(f);else{var d=o(f,n);n.byIndex=a,e.splice(a,0,{identifier:u,updater:d,references:1})}s.push(u)}return s}function o(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,o){var r=n(t=t||[],o=o||{});return function(t){t=t||[];for(var s=0;s<r.length;s++){var a=i(r[s]);e[a].references--}for(var l=n(t,o),h=0;h<r.length;h++){var c=i(r[h]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=l}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},9216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,o&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1285:(t,e,i)=>{"use strict";t.exports=i.p+"17e360b95ad3a476f9b6.png"}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={id:n,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&!t;)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),i.nc=void 0,(()=>{"use strict";class t{framebuffer;constructor(t){this.framebuffer=t}drawScaledTextureClip(t,e,i,n,o,r){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.framebuffer.height-1||t+i<0||t>this.framebuffer.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.framebuffer.height,0),c=0):(c=e,l=n-Math.max(e+n-this.framebuffer.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.framebuffer.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.framebuffer.width,0));const p=1/255*r;let x=u+c*this.framebuffer.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=(0|f)+(0|d)*o.width,e=(o.texture[t]>>24&255)*p,i=1-e,n=this.framebuffer.framebuffer[x],r=o.texture[t],a=(n>>0&255)*i+(r>>0&255)*e,l=(n>>8&255)*i+(r>>8&255)*e,h=(n>>16&255)*i+(r>>16&255)*e;this.framebuffer.framebuffer[x]=a|l<<8|h<<16|255<<24,f+=s,x++}d+=a,f=m,x+=-h+this.framebuffer.width}}}class e{r;g;b;a;static BLACK=new e(0,0,0,255);static WHITE=new e(255,255,255,255);static RED=new e(255,0,0,255);static GREEN=new e(0,255,0,255);static LIME=new e(0,255,0,255);static BLUE=new e(0,0,255,255);static DARK_BLUE=new e(0,0,64,255);static YELLOW=new e(255,255,0,255);static CYAN=new e(0,255,255,255);static MAGENTA=new e(255,0,255,255);static SLATE_GRAY=new e(112,128,144,255);static DARK_GRAY=new e(19,19,20,255);static ORANGE=new e(255,160,122);constructor(t=0,e=0,i=0,n=255){this.r=t,this.g=e,this.b=i,this.a=n}toPackedFormat(){return this.r|this.g<<8|this.b<<16|this.a<<24}sub(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,255)}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,255)}div(t){return new e(this.r/t,this.g/t,this.b/t,255)}mul(t){return new e(this.r*t,this.g*t,this.b*t,255)}}var n;!function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.DISABLED=2]="DISABLED"}(n||(n={}));class o{x;y;z;w;constructor(t,e,i,n=1){this.x=t,this.y=e,this.z=i,this.w=n}sub(t){return new o(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}add(t){return new o(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}cross(t){return new o(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,0)}normalize(){const t=1/this.length();return this.mul(t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}sub2(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}add2(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}mul(t){return new o(this.x*t,this.y*t,this.z*t,this.w)}componentWiseMul(t){return new o(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross2(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}normalize2(){const t=1/this.length();this.x*=t,this.y*=t,this.z*=t}}class r{mesh;inverse;buildMesh(t,e,i=!1){this.inverse=i;const n=new Array;for(let i=0;i<e.length;i+=3){const o=t[e[i+1]].sub(t[e[i]]).cross(t[e[i+2]].sub(t[e[i]]));n.push(this.inverse?o.normalize().mul(-1):o.normalize())}const r=new Array;for(let t=0;t<e.length;t+=3)r.push({n1:t/3,n2:t/3,n3:t/3,v1:e[0+t],v2:e[1+t],v3:e[2+t]});this.mesh={points:t,normals:n,faces:r,transformedPoints:t.map((()=>new o(0,0,0,0))),transformedNormals:n.map((()=>new o(0,0,0,0)))}}getMesh(){return this.mesh}}class s{x;y;z;constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}mult(t){return new s(this.x*t,this.y*t,this.z*t)}sub(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}sub2(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}mul(t){return new s(this.x*t,this.y*t,this.z*t)}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}add2(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}cross(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}cross2(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const t=1/this.length();return this.mul(t)}normalize2(){const t=1/this.length();this.x*=t,this.y*=t,this.z*=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}class a extends r{constructor(t=!1){super();const e=[],i=12;this.inverse=t;for(let t=0;t<15;t++){const n=this.torusFunction(2*t*Math.PI/15),r=this.torusFunction(2*t*Math.PI/15+.1),a=new s(0,4,0),l=r.sub(n).cross(a);for(let t=0;t<i;t++){const r=a.mul(Math.sin(2*t*Math.PI/i)).add(l.mul(Math.cos(2*t*Math.PI/i))).add(n);e.push(new o(r.x,r.y,r.z,1))}}const n=[];for(let t=0;t<15;t++)for(let o=0;o<i;o++)n.push((i*t+(1+o)%i)%e.length),n.push((i*t+(0+o)%i)%e.length),n.push((i*t+i+(1+o)%i)%e.length),n.push((i*t+i+(0+o)%i)%e.length),n.push((i*t+i+(1+o)%i)%e.length),n.push((i*t+(0+o)%i)%e.length);this.buildMesh(e,n)}torusFunction(t){return new s(10*Math.sin(t),0,10*Math.cos(t))}}class l{x;y;constructor(t,e){this.x=t,this.y=e}perp(){return new l(-this.y,this.x)}sub(t){return new l(this.x-t.x,this.y-t.y)}mul(t){return new l(this.x*t,this.y*t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=1/this.length();return this.mul(t)}dot(t){return this.x*t.x+this.y*t.y}}class h{m11;m12;m13;m14;m21;m22;m23;m24;m31;m32;m33;m34;m41;m42;m43;m44;static constructIdentityMatrix(){const t=new h;return t.m11=1,t.m12=0,t.m13=0,t.m14=0,t.m21=0,t.m22=1,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m33=1,t.m34=0,t.m41=0,t.m42=0,t.m43=0,t.m44=1,t}setIdentityMatrix(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}transpose(){const t=new h;return t.m11=this.m11,t.m12=this.m21,t.m13=this.m31,t.m14=this.m41,t.m21=this.m12,t.m22=this.m22,t.m23=this.m32,t.m24=this.m42,t.m31=this.m13,t.m32=this.m23,t.m33=this.m33,t.m34=this.m43,t.m41=this.m14,t.m42=this.m24,t.m43=this.m34,t.m44=this.m44,t}computeNormalMatrix(){return this.inverse().transpose()}inverse(){const t=h.constructIdentityMatrix();t.m14=-this.m14,t.m24=-this.m24,t.m34=-this.m34;const e=1/Math.sqrt(this.m11*this.m11+this.m12*this.m12+this.m13*this.m13),i=1/Math.sqrt(this.m21*this.m21+this.m22*this.m22+this.m23*this.m23),n=1/Math.sqrt(this.m31*this.m31+this.m32*this.m32+this.m33*this.m33),o=h.constructIdentityMatrix();return o.m11=this.m11*e,o.m21=this.m12*e,o.m31=this.m13*e,o.m12=this.m21*i,o.m22=this.m22*i,o.m32=this.m23*i,o.m13=this.m31*n,o.m23=this.m32*n,o.m33=this.m33*n,o.multiplyMatrix(t)}getInverseRotation(){const t=h.constructIdentityMatrix();return t.m11=1*this.m11,t.m21=1*this.m12,t.m31=1*this.m13,t.m12=1*this.m21,t.m22=1*this.m22,t.m32=1*this.m23,t.m13=1*this.m31,t.m23=1*this.m32,t.m33=1*this.m33,t}getRotation(){const t=h.constructIdentityMatrix();return t.m11=this.m11,t.m21=this.m21,t.m31=this.m31,t.m12=this.m12,t.m22=this.m22,t.m32=this.m32,t.m13=this.m13,t.m23=this.m23,t.m33=this.m33,t}static constructShadowMatrix(){const t=new s(0,-1.5,0),e=new s(0,1,0),i=new s(0,11,0),n=-t.dot(e),o=e.x*i.x+e.y*i.y+e.z*i.z,r=new h;return r.m11=o+n-i.x*e.x,r.m12=-i.x*e.y,r.m13=-i.x*e.z,r.m14=-i.x*n,r.m21=-i.y*e.x,r.m22=o+n-i.y*e.y,r.m23=-i.y*e.z,r.m24=-i.y*n,r.m31=-i.z*e.x,r.m32=-i.z*e.y,r.m33=o+n-i.z*e.z,r.m34=-i.z*n,r.m41=-e.x,r.m42=-e.y,r.m43=-e.z,r.m44=o,r}static constructTranslationMatrix(t,e,i){const n=new h;return n.m11=1,n.m12=0,n.m13=0,n.m14=t,n.m21=0,n.m22=1,n.m23=0,n.m24=e,n.m31=0,n.m32=0,n.m33=1,n.m34=i,n.m41=0,n.m42=0,n.m43=0,n.m44=1,n}setTranslationMatrix(t,e,i){this.m11=1,this.m12=0,this.m13=0,this.m14=t,this.m21=0,this.m22=1,this.m23=0,this.m24=e,this.m31=0,this.m32=0,this.m33=1,this.m34=i,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructXRotationMatrix(t){const e=new h;return e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=Math.cos(t),e.m23=-Math.sin(t),e.m24=0,e.m31=0,e.m32=Math.sin(t),e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}setXRotationMatrix(t){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=Math.cos(t),this.m23=-Math.sin(t),this.m24=0,this.m31=0,this.m32=Math.sin(t),this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setZRotationMatrix(t){this.m11=Math.cos(t),this.m12=-Math.sin(t),this.m13=0,this.m14=0,this.m21=Math.sin(t),this.m22=Math.cos(t),this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setScaleMatrix(t,e,i){this.m11=t,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=e,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=i,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setYRotationMatrix(t){this.m11=Math.cos(t),this.m12=0,this.m13=Math.sin(t),this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=-Math.sin(t),this.m32=0,this.m33=Math.cos(t),this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}setRotationMatrix(t,e,i,n){const o=Math.cos(2*Math.PI*n/360),r=Math.sin(2*Math.PI*n/360),a=new s(t,e,i);a.normalize2(),this.m11=(1-o)*a.x*a.x+o,this.m12=(1-o)*a.x*a.y-r*a.z,this.m13=(1-o)*a.x*a.z+r*a.y,this.m14=0,this.m21=(1-o)*a.x*a.y+r*a.z,this.m22=(1-o)*a.y*a.y+o,this.m23=(1-o)*a.y*a.z-r*a.x,this.m24=0,this.m31=(1-o)*a.x*a.z-r*a.y,this.m32=(1-o)*a.y*a.z+r*a.x,this.m33=(1-o)*a.z*a.z+o,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1}static constructYRotationMatrix(t){const e=new h;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructZRotationMatrix(t){const e=new h;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m14=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0,e.m41=0,e.m42=0,e.m43=0,e.m44=1,e}static constructScaleMatrix(t,e=t,i=e){const n=new h;return n.m11=t,n.m12=0,n.m13=0,n.m14=0,n.m21=0,n.m22=e,n.m23=0,n.m24=0,n.m31=0,n.m32=0,n.m33=i,n.m34=0,n.m41=0,n.m42=0,n.m43=0,n.m44=1,n}multiplyMatrix(t){const e=new h;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31+this.m14*t.m41,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31+this.m24*t.m41,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31+this.m34*t.m41,e.m41=this.m41*t.m11+this.m42*t.m21+this.m43*t.m31+this.m44*t.m41,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32+this.m14*t.m42,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32+this.m24*t.m42,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32+this.m34*t.m42,e.m42=this.m41*t.m12+this.m42*t.m22+this.m43*t.m32+this.m44*t.m42,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33+this.m14*t.m43,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33+this.m24*t.m43,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33+this.m34*t.m43,e.m43=this.m41*t.m13+this.m42*t.m23+this.m43*t.m33+this.m44*t.m43,e.m14=this.m11*t.m14+this.m12*t.m24+this.m13*t.m34+this.m14*t.m44,e.m24=this.m21*t.m14+this.m22*t.m24+this.m23*t.m34+this.m24*t.m44,e.m34=this.m31*t.m14+this.m32*t.m24+this.m33*t.m34+this.m34*t.m44,e.m44=this.m41*t.m14+this.m42*t.m24+this.m43*t.m34+this.m44*t.m44,e}multiply2(t,e){this.m11=t.m11*e.m11+t.m12*e.m21+t.m13*e.m31+t.m14*e.m41,this.m21=t.m21*e.m11+t.m22*e.m21+t.m23*e.m31+t.m24*e.m41,this.m31=t.m31*e.m11+t.m32*e.m21+t.m33*e.m31+t.m34*e.m41,this.m41=t.m41*e.m11+t.m42*e.m21+t.m43*e.m31+t.m44*e.m41,this.m12=t.m11*e.m12+t.m12*e.m22+t.m13*e.m32+t.m14*e.m42,this.m22=t.m21*e.m12+t.m22*e.m22+t.m23*e.m32+t.m24*e.m42,this.m32=t.m31*e.m12+t.m32*e.m22+t.m33*e.m32+t.m34*e.m42,this.m42=t.m41*e.m12+t.m42*e.m22+t.m43*e.m32+t.m44*e.m42,this.m13=t.m11*e.m13+t.m12*e.m23+t.m13*e.m33+t.m14*e.m43,this.m23=t.m21*e.m13+t.m22*e.m23+t.m23*e.m33+t.m24*e.m43,this.m33=t.m31*e.m13+t.m32*e.m23+t.m33*e.m33+t.m34*e.m43,this.m43=t.m41*e.m13+t.m42*e.m23+t.m43*e.m33+t.m44*e.m43,this.m14=t.m11*e.m14+t.m12*e.m24+t.m13*e.m34+t.m14*e.m44,this.m24=t.m21*e.m14+t.m22*e.m24+t.m23*e.m34+t.m24*e.m44,this.m34=t.m31*e.m14+t.m32*e.m24+t.m33*e.m34+t.m34*e.m44,this.m44=t.m41*e.m14+t.m42*e.m24+t.m43*e.m34+t.m44*e.m44}multiply(t){return new s(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34)}multiplyHom(t){return new o(this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w)}multiplyHomArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w}multiplyHomArr2(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14*t.w,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24*t.w,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34*t.w,e.w=this.m41*t.x+this.m42*t.y+this.m43*t.z+this.m44*t.w,e.x/=e.w,e.y/=e.w,e.z/=e.w}multiplyArr(t,e){e.x=this.m11*t.x+this.m12*t.y+this.m13*t.z+this.m14,e.y=this.m21*t.x+this.m22*t.y+this.m23*t.z+this.m24,e.z=this.m31*t.x+this.m32*t.y+this.m33*t.z+this.m34}}class c{m11;m12;m13;m21;m22;m23;m31;m32;m33;static constructXRotationMatrix(t){const e=new c,i=Math.cos(t),n=Math.sin(t);return e.m11=1,e.m12=0,e.m13=0,e.m21=0,e.m22=i,e.m23=-n,e.m31=0,e.m32=n,e.m33=i,e}static constructYRotationMatrix(t){const e=new c;return e.m11=Math.cos(t),e.m12=0,e.m13=Math.sin(t),e.m21=0,e.m22=1,e.m23=0,e.m31=-Math.sin(t),e.m32=0,e.m33=Math.cos(t),e}static constructZRotationMatrix(t){const e=new c;return e.m11=Math.cos(t),e.m12=-Math.sin(t),e.m13=0,e.m21=Math.sin(t),e.m22=Math.cos(t),e.m23=0,e.m31=0,e.m32=0,e.m33=1,e}static constructScaleMatrix(t,e,i){const n=new c;return n.m11=t,n.m12=0,n.m13=0,n.m21=0,n.m22=e,n.m23=0,n.m31=0,n.m32=0,n.m33=i,n}multiplyMatrix(t){const e=new c;return e.m11=this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,e.m21=this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,e.m31=this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,e.m12=this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,e.m22=this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,e.m32=this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,e.m13=this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,e.m23=this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,e.m33=this.m31*t.m13+this.m32*t.m23+this.m33*t.m33,e}multiply(t){return new s(this.m11*t.x+this.m12*t.y+this.m13*t.z,this.m21*t.x+this.m22*t.y+this.m23*t.z,this.m31*t.x+this.m32*t.y+this.m33*t.z)}}class u{static interpolate(t,e,i){return i<=t?0:i>=e?1:(i-t)/(e-t)}static cosineInterpolate(t,e,i){if(i<=t)return 0;if(i>=e)return 1;const n=(i-t)/(e-t);return(1-Math.cos(n*Math.PI))/2}}class m{seed;constructor(){this.seed=6}getFloat(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}setSeed(t){this.seed=t}}class f{}class d extends f{temp=null;drawTriangleDDA(t,e,i,n){e.projection.y>n.projection.y&&(this.temp=e,e=n,n=this.temp),e.projection.y>i.projection.y&&(this.temp=e,e=i,i=this.temp),i.projection.y>n.projection.y&&(this.temp=i,i=n,n=this.temp),e.projection.y!==n.projection.y&&((n.projection.x-e.projection.x)*(i.projection.y-e.projection.y)/(n.projection.y-e.projection.y)+e.projection.x>i.projection.x?this.fillLongRightTriangle(t,e,i,n):this.fillLongLeftTriangle(t,e,i,n))}}class p extends d{framebuffer;slope1;slope2;zslope1;zslope2;curz1;curz2;xPosition;xPosition2;yPosition;constructor(t){super(),this.framebuffer=t}fillLongRightTriangle(t,e,i,n){const o=e.color.toPackedFormat();let r=i.projection.y-e.projection.y;const s=n.projection.y-e.projection.y;this.slope1=(i.projection.x-e.projection.x)/r,this.slope2=(n.projection.x-e.projection.x)/s,this.zslope1=(1/i.projection.z-1/e.projection.z)/r,this.zslope2=(1/n.projection.z-1/e.projection.z)/s,this.curz1=1/e.projection.z,this.curz2=1/e.projection.z,this.xPosition=e.projection.x,this.xPosition2=e.projection.x,this.yPosition=e.projection.y,this.drawSpan(t,r,o),r=n.projection.y-i.projection.y,this.slope1=(n.projection.x-i.projection.x)/r,this.zslope1=(1/n.projection.z-1/i.projection.z)/r,this.xPosition=i.projection.x,this.yPosition=i.projection.y,this.drawSpan(t,r,o)}fillLongLeftTriangle(t,e,i,n){const o=e.color.toPackedFormat();let r=i.projection.y-e.projection.y;const s=n.projection.y-e.projection.y;this.slope2=(i.projection.x-e.projection.x)/r,this.slope1=(n.projection.x-e.projection.x)/s,this.zslope2=(1/i.projection.z-1/e.projection.z)/r,this.zslope1=(1/n.projection.z-1/e.projection.z)/s,this.curz1=1/e.projection.z,this.curz2=1/e.projection.z,this.xPosition=e.projection.x,this.xPosition2=e.projection.x,this.yPosition=e.projection.y,this.drawSpan(t,r,o),r=n.projection.y-i.projection.y,this.slope2=(n.projection.x-i.projection.x)/r,this.zslope2=(1/n.projection.z-1/i.projection.z)/r,this.curz2=1/i.projection.z,this.xPosition2=i.projection.x,this.yPosition=i.projection.y,this.drawSpan(t,r,o)}drawSpan(t,e,i){for(let n=0;n<e;n++){const e=this.xPosition2-this.xPosition,n=Math.round(this.curz2-this.curz1)/e;let o=this.curz1;for(let r=0;r<e;r++){const e=Math.round(this.yPosition)*t.width+Math.round(this.xPosition+r);o<t.wBuffer[e]&&(t.wBuffer[e]=o,t.framebuffer[e]=i),o+=n}this.xPosition+=this.slope1,this.xPosition2+=this.slope2,this.yPosition++,this.curz1+=this.zslope1,this.curz2+=this.zslope2}}}class x{framebuffer;constructor(t){this.framebuffer=t}drawLineDDA(t,e,i){const n=e.x-t.x,o=e.y-t.y;let r,s,a;Math.abs(n)>Math.abs(o)?(r=Math.sign(n),s=o/Math.abs(n),a=Math.abs(n)):(r=n/Math.abs(o),s=Math.sign(o),a=Math.abs(o));let l=t.x,h=t.y,c=1/t.z;const u=(1/e.z-1/t.z)/a;for(let t=0;t<=a;t++)c<this.framebuffer.wBuffer[Math.round(l)+Math.round(h)*this.framebuffer.width]&&(this.framebuffer.wBuffer[Math.round(l)+Math.round(h)*this.framebuffer.width]=c,this.framebuffer.drawPixel(Math.round(l),Math.round(h),i)),l+=r,h+=s,c+=u}}class y{framebuffer;constructor(t){this.framebuffer=t}drawLineDDANoZ(t,e,i){const n=e.x-t.x,o=e.y-t.y;let r,s,a;Math.abs(n)>Math.abs(o)?(r=Math.sign(n),s=o/Math.abs(n),a=Math.abs(n)):(r=n/Math.abs(o),s=Math.sign(o),a=Math.abs(o));let l=t.x,h=t.y;for(let t=0;t<=a;t++)this.framebuffer.drawPixel(Math.round(l),Math.round(h),i),l+=r,h+=s}}class g extends d{framebuffer;constructor(t){super(),this.framebuffer=t}fillLongRightTriangle(t,e,i,n){let o=i.projection.y-e.projection.y,r=(i.projection.x-e.projection.x)/o,s=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/o,a=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/o,l=(1/i.projection.z-1/e.projection.z)/o,h=1/e.projection.z,c=e.textureCoordinate.u/e.projection.z,u=e.textureCoordinate.v/e.projection.z,m=e.projection.x;const f=n.projection.y-e.projection.y,d=(n.projection.x-e.projection.x)/f,p=(n.textureCoordinate.u/n.projection.z-e.textureCoordinate.u/e.projection.z)/f,x=(n.textureCoordinate.v/n.projection.z-e.textureCoordinate.v/e.projection.z)/f,y=(1/n.projection.z-1/e.projection.z)/f;let g=1/e.projection.z,v=e.textureCoordinate.u/e.projection.z,b=e.textureCoordinate.v/e.projection.z,w=e.projection.x,M=e.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(m);let i=Math.round(M)*t.width+Math.round(m);const n=(g-h)/e,o=(v-c)/e,f=(b-u)/e;let j=h,C=c,S=u;for(let r=0;r<e;r++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),o=0|Math.max(Math.min(S*e*t.bob.height,t.bob.height-1),0),r=t.bob.texture[n+o*t.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),t.framebuffer[i]=r}i++,j+=n,C+=o,S+=f}m+=r,w+=d,M++,h+=l,g+=y,c+=s,v+=p,u+=a,b+=x}if(o=n.projection.y-i.projection.y,0!==o){r=(n.projection.x-i.projection.x)/o,l=(1/n.projection.z-1/i.projection.z)/o,s=(n.textureCoordinate.u/n.projection.z-i.textureCoordinate.u/i.projection.z)/o,a=(n.textureCoordinate.v/n.projection.z-i.textureCoordinate.v/i.projection.z)/o,h=1/i.projection.z,c=i.textureCoordinate.u/i.projection.z,u=i.textureCoordinate.v/i.projection.z,m=i.projection.x,M=i.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(m);let i=Math.round(M)*t.width+Math.round(m);const n=(g-h)/e,o=(v-c)/e,f=(b-u)/e;let j=h,C=c,S=u;for(let r=0;r<e;r++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),o=0|Math.max(Math.min(S*e*t.bob.height,t.bob.height-1),0),r=t.bob.texture[n+o*t.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),t.framebuffer[i]=r}i++,j+=n,C+=o,S+=f}m+=r,w+=d,M++,h+=l,g+=y,c+=s,v+=p,u+=a,b+=x}}}fillLongLeftTriangle(t,e,i,n){let o=i.projection.y-e.projection.y;const r=n.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/o;const a=(n.projection.x-e.projection.x)/r,l=(n.textureCoordinate.u/n.projection.z-e.textureCoordinate.u/e.projection.z)/r;let h=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/o;const c=(n.textureCoordinate.v/n.projection.z-e.textureCoordinate.v/e.projection.z)/r;let u=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/o,m=(1/i.projection.z-1/e.projection.z)/o;const f=(1/n.projection.z-1/e.projection.z)/r;let d=1/e.projection.z,p=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*t.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),o=0|Math.max(Math.min(S*e*t.bob.height,t.bob.height-1),0),r=t.bob.texture[n+o*t.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),t.framebuffer[i]=r}i++,j+=n,C+=o,S+=r}b+=a,w+=s,M++,d+=f,p+=m,x+=l,g+=h,y+=c,v+=u}o=n.projection.y-i.projection.y,s=(n.projection.x-i.projection.x)/o,m=(1/n.projection.z-1/i.projection.z)/o,h=(n.textureCoordinate.u/n.projection.z-i.textureCoordinate.u/i.projection.z)/o,u=(n.textureCoordinate.v/n.projection.z-i.textureCoordinate.v/i.projection.z)/o,p=1/i.projection.z,g=i.textureCoordinate.u/i.projection.z,v=i.textureCoordinate.v/i.projection.z,w=i.projection.x,M=i.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*t.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){if(j<t.wBuffer[i]){t.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*t.bob.width,t.bob.width-1),0),o=0|Math.max(Math.min(S*e*t.bob.height,t.bob.height-1),0),r=t.bob.texture[n+o*t.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),t.framebuffer[i]=r}i++,j+=n,C+=o,S+=r}b+=a,w+=s,M++,d+=f,p+=m,x+=l,g+=h,y+=c,v+=u}}}class v extends d{framebuffer;pipeline;constructor(t,e){super(),this.framebuffer=t,this.pipeline=e}fillLongRightTriangle(t,e,i,n){let o=i.projection.y-e.projection.y;const r=n.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/o;const a=(n.projection.x-e.projection.x)/r;let l=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/o;const h=(n.textureCoordinate.u/n.projection.z-e.textureCoordinate.u/e.projection.z)/r;let c=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/o;const u=(n.textureCoordinate.v/n.projection.z-e.textureCoordinate.v/e.projection.z)/r;let m=(1/i.projection.z-1/e.projection.z)/o;const f=(1/n.projection.z-1/e.projection.z)/r;let d=1/e.projection.z,p=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){const e=this.framebuffer.framebuffer[i];if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const n=1/j;let o=0|Math.max(Math.min(C*n*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),r=0|Math.max(Math.min(S*n*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),s=this.framebuffer.bob.texture[o+r*this.framebuffer.bob.width];o=C*n*(t.bob.width-1),r=S*n*(t.bob.height-1),s=t.bob.getBilinearFilteredPixelRasterizer(o,r);const a=this.pipeline.alpha*(s>>24&255)/255,l=1-a,h=(e>>0&255)*l+(s>>0&255)*a,c=(e>>8&255)*l+(s>>8&255)*a,u=(e>>16&255)*l+(s>>16&255)*a;this.framebuffer.framebuffer[i]=h|c<<8|u<<16|255<<24}i++,j+=n,C+=o,S+=r}b+=s,w+=a,M++,d+=m,p+=f,x+=l,g+=h,y+=c,v+=u}if(o=n.projection.y-i.projection.y,0!==o){s=(n.projection.x-i.projection.x)/o,m=(1/n.projection.z-1/i.projection.z)/o,l=(n.textureCoordinate.u/n.projection.z-i.textureCoordinate.u/i.projection.z)/o,c=(n.textureCoordinate.v/n.projection.z-i.textureCoordinate.v/i.projection.z)/o,d=1/i.projection.z,x=i.textureCoordinate.u/i.projection.z,y=i.textureCoordinate.v/i.projection.z,b=i.projection.x,M=i.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),o=0|Math.max(Math.min(S*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),r=this.framebuffer.bob.texture[n+o*this.framebuffer.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),r=t.bob.getBilinearFilteredPixelRasterizer(n,o);const s=this.pipeline.alpha*(r>>24&255)/255,a=1-s,l=(this.framebuffer.framebuffer[i]>>0&255)*a+(r>>0&255)*s,h=(this.framebuffer.framebuffer[i]>>8&255)*a+(r>>8&255)*s,c=(this.framebuffer.framebuffer[i]>>16&255)*a+(r>>16&255)*s;this.framebuffer.framebuffer[i]=l|h<<8|c<<16|255<<24}i++,j+=n,C+=o,S+=r}b+=s,w+=a,M++,d+=m,p+=f,x+=l,g+=h,y+=c,v+=u}}}fillLongLeftTriangle(t,e,i,n){let o=i.projection.y-e.projection.y;const r=n.projection.y-e.projection.y;let s=(i.projection.x-e.projection.x)/o;const a=(n.projection.x-e.projection.x)/r,l=(n.textureCoordinate.u/n.projection.z-e.textureCoordinate.u/e.projection.z)/r;let h=(i.textureCoordinate.u/i.projection.z-e.textureCoordinate.u/e.projection.z)/o;const c=(n.textureCoordinate.v/n.projection.z-e.textureCoordinate.v/e.projection.z)/r;let u=(i.textureCoordinate.v/i.projection.z-e.textureCoordinate.v/e.projection.z)/o,m=(1/i.projection.z-1/e.projection.z)/o;const f=(1/n.projection.z-1/e.projection.z)/r;let d=1/e.projection.z,p=1/e.projection.z,x=e.textureCoordinate.u/e.projection.z,y=e.textureCoordinate.v/e.projection.z,g=e.textureCoordinate.u/e.projection.z,v=e.textureCoordinate.v/e.projection.z,b=e.projection.x,w=e.projection.x,M=e.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),o=0|Math.max(Math.min(S*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),r=this.framebuffer.bob.texture[n+o*this.framebuffer.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),r=t.bob.getBilinearFilteredPixelRasterizer(n,o);const s=this.pipeline.alpha*(r>>24&255)/255,a=1-s,l=(this.framebuffer.framebuffer[i]>>0&255)*a+(r>>0&255)*s,h=(this.framebuffer.framebuffer[i]>>8&255)*a+(r>>8&255)*s,c=(this.framebuffer.framebuffer[i]>>16&255)*a+(r>>16&255)*s;this.framebuffer.framebuffer[i]=l|h<<8|c<<16|255<<24}i++,j+=n,C+=o,S+=r}b+=a,w+=s,M++,d+=f,p+=m,x+=l,g+=h,y+=c,v+=u}o=n.projection.y-i.projection.y,s=(n.projection.x-i.projection.x)/o,m=(1/n.projection.z-1/i.projection.z)/o,h=(n.textureCoordinate.u/n.projection.z-i.textureCoordinate.u/i.projection.z)/o,u=(n.textureCoordinate.v/n.projection.z-i.textureCoordinate.v/i.projection.z)/o,p=1/i.projection.z,g=i.textureCoordinate.u/i.projection.z,v=i.textureCoordinate.v/i.projection.z,w=i.projection.x,M=i.projection.y;for(let e=0;e<o;e++){const e=Math.round(w)-Math.round(b);let i=Math.round(M)*this.framebuffer.width+Math.round(b);const n=(p-d)/e,o=(g-x)/e,r=(v-y)/e;let j=d,C=x,S=y;for(let s=0;s<e;s++){if(j<this.framebuffer.wBuffer[i]){this.framebuffer.wBuffer[i]=j;const e=1/j;let n=0|Math.max(Math.min(C*e*this.framebuffer.bob.width,this.framebuffer.bob.width-1),0),o=0|Math.max(Math.min(S*e*this.framebuffer.bob.height,this.framebuffer.bob.height-1),0),r=this.framebuffer.bob.texture[n+o*this.framebuffer.bob.width];n=C*e*(t.bob.width-1),o=S*e*(t.bob.height-1),r=t.bob.getBilinearFilteredPixelRasterizer(n,o);const s=this.pipeline.alpha*(r>>24&255)/255,a=1-s,l=(this.framebuffer.framebuffer[i]>>0&255)*a+(r>>0&255)*s,h=(this.framebuffer.framebuffer[i]>>8&255)*a+(r>>8&255)*s,c=(this.framebuffer.framebuffer[i]>>16&255)*a+(r>>16&255)*s;this.framebuffer.framebuffer[i]=l|h<<8|c<<16|255<<24}i++,j+=n,C+=o,S+=r}b+=a,w+=s,M++,d+=f,p+=m,x+=l,g+=h,y+=c,v+=u}}}class b{u;v;constructor(t,e){this.u=t,this.v=e}}class w{position;projection=new o(0,0,0);normal;color;textureCoordinate=new b}class M{framebuffer;NEAR_PLANE_Z=-1.7;alpha;cullMode=n.BACK;constructor(t){this.framebuffer=t}setCullFace(t){this.cullMode=t}setAlpha(t){this.alpha=Math.max(Math.min(t,1),0)}isInFrontOfNearPlane(t){return t.z<this.NEAR_PLANE_Z}isTriangleCCW(t,e,i){if(this.cullMode==n.DISABLED)return!0;const o=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode==n.BACK?o<0:o>0}isTriangleCCW2(t,e,i,o){if(this.cullMode==n.DISABLED)return!0;const r=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*o.y-o.x*i.y+o.x*t.y-t.x*o.y;return this.cullMode===n.BACK?r<0:r>0}}class j extends M{sphereMapping=!1;triangleRasterizer=null;vertexArray=new Array(new w,new w,new w);setSphereMapping(t){this.sphereMapping=t}modelViewMatrix;projectedVertices=new Array(new o(0,0,0,1),new o(0,0,0,1),new o(0,0,0,1));constructor(t){super(t),this.setAlpha(1),this.triangleRasterizer=new g(t)}setFramebuffer(t){this.framebuffer=t}enableAlphaBlending(){this.triangleRasterizer=new v(this.framebuffer,this)}disableAlphaBlending(){this.triangleRasterizer=new g(this.framebuffer)}setModelViewMatrix(t){this.modelViewMatrix=t}drawMeshArray(t,e){for(let i=0;i<e.length;i++){const n=e[i];this.draw(t,n)}}draw(t,e){if(e.normals){const t=this.modelViewMatrix.computeNormalMatrix();for(let i=0;i<e.normals.length;i++)t.multiplyHomArr(e.normals[i],e.normals2[i])}for(let t=0;t<e.points.length;t++)this.modelViewMatrix.multiplyHomArr(e.points[t],e.points2[t]);for(let i=0;i<e.faces.length;i++){const n=e.points2[e.faces[i].vertices[0]],o=e.points2[e.faces[i].vertices[1]],r=e.points2[e.faces[i].vertices[2]];if(this.isInFrontOfNearPlane(n)&&this.isInFrontOfNearPlane(o)&&this.isInFrontOfNearPlane(r)){if(this.project2(n,this.projectedVertices[0]),this.project2(o,this.projectedVertices[1]),this.project2(r,this.projectedVertices[2]),this.isTriangleCCW(this.projectedVertices[0],this.projectedVertices[1],this.projectedVertices[2])){if(this.vertexArray[0].projection=this.projectedVertices[0],this.vertexArray[1].projection=this.projectedVertices[1],this.vertexArray[2].projection=this.projectedVertices[2],this.sphereMapping){const n=e.normals2[e.faces[i].normals[0]],o=e.normals2[e.faces[i].normals[1]],r=e.normals2[e.faces[i].normals[2]];t.fakeSphere(n,this.vertexArray[0]),t.fakeSphere(o,this.vertexArray[1]),t.fakeSphere(r,this.vertexArray[2])}else this.vertexArray[0].textureCoordinate=e.uv[e.faces[i].uv[0]],this.vertexArray[1].textureCoordinate=e.uv[e.faces[i].uv[1]],this.vertexArray[2].textureCoordinate=e.uv[e.faces[i].uv[2]];this.clipConvexPolygon(t,this.vertexArray)}}else{if(!(this.isInFrontOfNearPlane(n)||this.isInFrontOfNearPlane(o)||this.isInFrontOfNearPlane(r)))continue;this.vertexArray[0].position=n,this.vertexArray[0].textureCoordinate=e.uv[e.faces[i].uv[0]],this.vertexArray[1].position=o,this.vertexArray[1].textureCoordinate=e.uv[e.faces[i].uv[1]],this.vertexArray[2].position=r,this.vertexArray[2].textureCoordinate=e.uv[e.faces[i].uv[2]],this.zClipTriangle(t,this.vertexArray)}}}project2(t,e){e.x=Math.round(this.framebuffer.width/2+292*t.x/-t.z),e.y=Math.round(this.framebuffer.height/2-292*t.y/-t.z),e.z=t.z}computeNearPlaneIntersection(t,e){const i=(this.NEAR_PLANE_Z-t.position.z)/(e.position.z-t.position.z),n=new w;return n.position=new o(i*(e.position.x-t.position.x)+t.position.x,i*(e.position.y-t.position.y)+t.position.y,this.NEAR_PLANE_Z),n.textureCoordinate=new b(i*(e.textureCoordinate.u-t.textureCoordinate.u)+t.textureCoordinate.u,i*(e.textureCoordinate.v-t.textureCoordinate.v)+t.textureCoordinate.v),n}zClipTriangle(t,e){const i=e,n=new Array;let o=i[i.length-1];for(let t=0;t<i.length;t++){const e=i[t];this.isInFrontOfNearPlane(e.position)?(this.isInFrontOfNearPlane(o.position)||n.push(this.computeNearPlaneIntersection(o,e)),n.push(e)):this.isInFrontOfNearPlane(o.position)&&n.push(this.computeNearPlaneIntersection(o,e)),o=e}if(!(n.length<3)){for(let t=0;t<n.length;t++)this.project2(n[t].position,n[t].projection);(3!==n.length||this.isTriangleCCW(n[0].projection,n[1].projection,n[2].projection))&&(4!==n.length||this.isTriangleCCW2(n[0].projection,n[1].projection,n[2].projection,n[3].projection))&&this.clipConvexPolygon(t,n)}}clipConvexPolygon(t,e){let i=e;for(let e=0;e<t.clipRegion.length;e++){const n=t.clipRegion[e],o=i;i=new Array;let r=o[o.length-1];for(let t=0;t<o.length;t++){const e=o[t];n.isInside2(e)?(n.isInside2(r)||i.push(n.computeIntersection2(r,e)),i.push(e)):n.isInside2(r)&&i.push(n.computeIntersection2(r,e)),r=e}}if(!(i.length<3))for(let e=0;e<i.length-2;e++)this.triangleRasterizer.drawTriangleDDA(t,i[0],i[1+e],i[2+e])}}class C{}class S extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.y>=this.framebuffer.minWindow.y}isInside2(t){return t.projection.y>=this.framebuffer.minWindow.y}computeIntersection(t,e){const i=new w,n=(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o(Math.round(t.projection.x+(e.projection.x-t.projection.x)*n),this.framebuffer.minWindow.y,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new w;i.projection=new o(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.minWindow.y,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y)));const n=new b,r=i.projection.z;return n.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y))*r,n.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.minWindow.y-t.projection.y)/(e.projection.y-t.projection.y))*r,i.textureCoordinate=n,i}}class z{framebuffer;static REGION_CODE_CENTER=0;static REGION_CODE_LEFT=1;static REGION_CODE_RIGHT=2;static REGION_CODE_BOTTOM=4;static REGION_CODE_TOP=8;constructor(t){this.framebuffer=t}cohenSutherlandLineClipper(t,e,i){let n=new s(t.x,t.y,t.z),o=new s(e.x,e.y,e.z),r=this.computeRegionCode(n),a=this.computeRegionCode(o),l=!1,h=!1;for(;!h;)if(this.isTrivialAccept(r,a))l=!0,h=!0;else if(this.isTrivialReject(r,a))h=!0;else{if(r===z.REGION_CODE_CENTER){const t=r;r=a,a=t;const e=n;n=o,o=e}(r&z.REGION_CODE_TOP)!==z.REGION_CODE_CENTER?(n.x=n.x+(o.x-n.x)*(this.framebuffer.maxWindow.y-n.y)/(o.y-n.y),n.y=this.framebuffer.maxWindow.y):(r&z.REGION_CODE_BOTTOM)!==z.REGION_CODE_CENTER?(n.x=n.x+(o.x-n.x)*(this.framebuffer.minWindow.y-n.y)/(o.y-n.y),n.y=this.framebuffer.minWindow.y):(r&z.REGION_CODE_RIGHT)!==z.REGION_CODE_CENTER?(n.y=n.y+(o.y-n.y)*(this.framebuffer.maxWindow.x-n.x)/(o.x-n.x),n.x=this.framebuffer.maxWindow.x):(r&z.REGION_CODE_LEFT)!==z.REGION_CODE_CENTER&&(n.y=n.y+(o.y-n.y)*(this.framebuffer.minWindow.x-n.x)/(o.x-n.x),n.x=this.framebuffer.minWindow.x),r=this.computeRegionCode(n)}l&&this.framebuffer.drawLineDDA(n,o,i)}isTrivialAccept(t,e){return(t|e)===z.REGION_CODE_CENTER}isTrivialReject(t,e){return(t&e)!==z.REGION_CODE_CENTER}computeRegionCode(t){let e=z.REGION_CODE_CENTER;return t.x<this.framebuffer.minWindow.x?e|=z.REGION_CODE_LEFT:t.x>this.framebuffer.maxWindow.x&&(e|=z.REGION_CODE_RIGHT),t.y<this.framebuffer.minWindow.y?e|=z.REGION_CODE_BOTTOM:t.y>this.framebuffer.maxWindow.y&&(e|=z.REGION_CODE_TOP),e}}class P extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.x>=0}isInside2(t){return t.projection.x>=0}computeIntersection(t,e){const i=new w,n=(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o(this.framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*n),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new w;i.projection=new o(this.framebuffer.minWindow.x,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x)),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x)));const n=new b,r=i.projection.z;return n.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x))*r,n.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.minWindow.x-t.projection.x)/(e.projection.x-t.projection.x))*r,i.textureCoordinate=n,i}}class A extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.x<this.framebuffer.width}isInside2(t){return t.projection.x<this.framebuffer.width}computeIntersection(t,e){const i=new w,n=(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o(this.framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*n),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new w;i.projection=new o(this.framebuffer.maxWindow.x+1,Math.round(t.projection.y+(e.projection.y-t.projection.y)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x)),1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x)));const n=new b,r=i.projection.z;return n.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x))*r,n.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.maxWindow.x+1-t.projection.x)/(e.projection.x-t.projection.x))*r,i.textureCoordinate=n,i}}class B extends C{framebuffer;constructor(t){super(),this.framebuffer=t}isInside(t){return t.projection.y<this.framebuffer.maxWindow.y+1}isInside2(t){return t.projection.y<this.framebuffer.maxWindow.y+1}computeIntersection(t,e){const i=new w,n=(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y);return i.color=e.color.sub(t.color).mul(n).add(t.color),i.projection=new o(Math.round(t.projection.x+(e.projection.x-t.projection.x)*n),this.framebuffer.maxWindow.y+1,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*n)),i}computeIntersection2(t,e){const i=new w;i.projection=new o(Math.round(t.projection.x+(e.projection.x-t.projection.x)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y)),this.framebuffer.maxWindow.y+1,1/(1/t.projection.z+(1/e.projection.z-1/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y)));const n=new b,r=i.projection.z;return n.u=(t.textureCoordinate.u/t.projection.z+(e.textureCoordinate.u/e.projection.z-t.textureCoordinate.u/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y))*r,n.v=(t.textureCoordinate.v/t.projection.z+(e.textureCoordinate.v/e.projection.z-t.textureCoordinate.v/t.projection.z)*(this.framebuffer.maxWindow.y+1-t.projection.y)/(e.projection.y-t.projection.y))*r,i.textureCoordinate=n,i}}class I{texture;width;height;maxWidth;maxHeight;clamp=!1;setClamp(t){this.clamp=t}constructor(t,e,i){this.texture=t,this.width=e,this.height=i,this.maxHeight=i-1|0,this.maxWidth=e-1|0}getPixel(t,e,i){return t.texture[(255&e)+256*(255&i)]}getBilinearFilteredPixel(t,e){const i=((0|t)%256+256)%256,n=((t+1|0)%256+256)%256,o=((0|e)%256+256)%256,r=((e+1|0)%256+256)%256,s=255&this.getPixel(this,i,o),a=255&this.getPixel(this,n,o),l=255&this.getPixel(this,i,r),h=255&this.getPixel(this,n,r),c=s*(1-(t-Math.floor(t)))+a*(t-Math.floor(t)),u=l*(1-(t-Math.floor(t)))+h*(t-Math.floor(t));return c*(1-(e-Math.floor(e)))+u*(e-Math.floor(e))}getBilinearFilteredPixel2(t,e){let i,n,o,r;this.clamp?(t=Math.max(Math.min(t,this.width-1),0),e=Math.max(Math.min(e,this.height-1),0),i=Math.floor(t),n=Math.max(Math.min(i+1,this.width-1),0),o=Math.floor(e),r=Math.max(Math.min(o+1,this.height-1),0)):(t=(t%this.width+this.width)%this.width,e=(e%this.height+this.height)%this.height,i=0|t,n=(t+1|0)%this.width,o=0|e,r=(e+1|0)%this.height);const s=this.getPixel2(this,i,o),a=this.getPixel2(this,n,o),l=this.getPixel2(this,i,r),h=this.getPixel2(this,n,r);return this.interpolateComp(t,e,s,a,l,h)}getPixel2(t,e,i){return this.texture[e+i*this.width]}getBilinearFilteredPixelRasterizer(t,e){let i,n,o,r,s=0|t,a=1+(0|t),l=0|e,h=1+(0|e);return this.clamp?(s=Math.max(Math.min(s,this.width-1),0),a=Math.max(Math.min(a,this.width-1),0),l=Math.max(Math.min(l,this.height-1),0),h=Math.max(Math.min(h,this.height-1),0),i=this.getPixel2(this,s,l),n=this.getPixel2(this,a,l),o=this.getPixel2(this,s,h),r=this.getPixel2(this,a,h)):(i=this.getPixelRasterizer(this,s,l),n=this.getPixelRasterizer(this,a,l),o=this.getPixelRasterizer(this,s,h),r=this.getPixelRasterizer(this,a,h)),this.interpolateComp(t,e,i,n,o,r)}getPixelRasterizer(t,e,i){return this.texture[(e&this.width-1)+(i&this.height-1)*this.width]}getPixel3(t,e,i){return this.texture[(e%this.width+this.width)%this.width+(i%this.height+this.height)%this.height*this.width]}interpolateComp(t,e,i,n,o,r){const s=t-(0|t),a=e-(0|e),l=1-s,h=1-a;return((255&i)*l+(255&n)*s)*h+((255&o)*l+(255&r)*s)*a|((i>>8&255)*l+(n>>8&255)*s)*h+((o>>8&255)*l+(r>>8&255)*s)*a<<8|((i>>16&255)*l+(n>>16&255)*s)*h+((o>>16&255)*l+(r>>16&255)*s)*a<<16|((i>>24&255)*l+(n>>24&255)*s)*h+((o>>24&255)*l+(r>>24&255)*s)*a<<24}}class _{static PIXEL_SIZE_IN_BYTES=4;minWindow;maxWindow;framebuffer;wBuffer;cullMode=n.BACK;camera;bob;triangleRasterizer=new p(this);texturedTriangleRasterizer=new g(this);scaleClipBlitter=new t(this);texturedRenderingPipeline;lineRasterizer=new x(this);lineRasterizerNo=new y(this);tmpGlitch;lensFlareVisible=!1;lensFlareStart=0;lensFlareEnd=0;width;height;imageData;unsignedIntArray;torus=new a;plane;cylinder2;linerClipper=new z(this);clipRegion=Array();texture=new I;constructor(t,e){this.width=t,this.height=e,this.imageData=new ImageData(t,e),this.wBuffer=new Float32Array(t*e);const i=new ArrayBuffer(this.width*this.height*_.PIXEL_SIZE_IN_BYTES);this.unsignedIntArray=new Uint8ClampedArray(i),this.framebuffer=new Uint32Array(i),this.tmpGlitch=new Uint32Array(t*e),this.texturedRenderingPipeline=new j(this),this.minWindow=new l(0,0),this.maxWindow=new l(t-1,e-1),this.clipRegion=new Array(new A(this),new P(this),new S(this),new B(this))}setCullFace(t){this.cullMode=t}setTexture(t){this.bob=t}getImageData(){return this.imageData.data.set(this.unsignedIntArray),this.imageData}clear(){const t=e.BLACK.toPackedFormat(),i=this.width*this.height;for(let e=0;e<i;e++)this.framebuffer[e]=t}clearColorBuffer(t){this.framebuffer.fill(t)}drawPixel(t,e,i){this.framebuffer[t+e*this.width]=i}drawPixel4(t,e,i,n){const o=t+e*this.width,r=1-n,s=(this.framebuffer[o]>>0&255)*r+(i>>0&255)*n|0,a=(this.framebuffer[o]>>8&255)*r+(i>>8&255)*n|0,l=(this.framebuffer[o]>>16&255)*r+(i>>16&255)*n|0;this.framebuffer[t+e*this.width]=s|a<<8|l<<16|255<<24}drawPixel3(t,e,i,n){const o=t+e*this.width,r=(i>>24&255)/255*n,s=1-r,a=(this.framebuffer[o]>>0&255)*s+(i>>0&255)*r|0,l=(this.framebuffer[o]>>8&255)*s+(i>>8&255)*r|0,h=(this.framebuffer[o]>>16&255)*s+(i>>16&255)*r|0;this.framebuffer[o]=a|l<<8|h<<16|255<<24}drawPixelAntiAliased(t,e,i){if(t<0||t>=this.width||e<0||e>=this.height)return;const n=Math.floor(t),o=Math.floor(e),r=(1-Math.abs(t-n))*(1-Math.abs(e-o));this.drawPixel3(n,o,i,r)}drawPixelAliased(t,e,i){if(t<0||t>=this.width||e<0||e>=this.height)return;const n=Math.round(t),o=Math.round(e);this.drawPixel(n,o,i)}drawPixelAntiAliasedSpacial(t,e,i){if(!(t<0||t>=this.width||e<0||e>=this.height))for(let n=Math.floor(t);n<=Math.ceil(t);n++)for(let o=Math.floor(e);o<=Math.ceil(e);o++){const r=(1-Math.abs(t-n))*(1-Math.abs(e-o));this.drawPixel4(n,o,i,r)}}readPixel(t,e){return this.framebuffer[t+e*this.width]}drawRect(t,e,i,n){let o=t+e*this.width;for(let t=0;t<i;t++)this.framebuffer[o++]=n}drawRect2(t,e,i,n,o){let r=t+e*this.width;for(let t=0;t<n;t++){for(let t=0;t<i;t++)this.framebuffer[r++]=o;r+=this.width-i}}drawText(t,e,i,n){let o=t;const r=" ".charCodeAt(0);for(let t=0;t<i.length;t++){const s=i.charCodeAt(t)-r,a=8*Math.floor(s%32),l=8*Math.floor(s/32);this.drawTextureRectFastAlpha(o,e,a,l,8,8,n),o+=8}}addReflections(){for(let t=0;t<50;t++)for(let e=0;e<this.width;e++)this.framebuffer[(150+t)*this.width+e]=this.framebuffer[(150-3*t-1)*this.width+e+u.interpolate(0,50,t)*(14*Math.sin(.002*Date.now()+.2*t))|0]}drawTextureRect2(t,e,i,n,o,r,s,a){for(let l=0;l<o;l++)for(let o=0;o<r;o++){const r=i+l+(n+o)*s.width,h=t+l+(e+o)*this.width,c=(s.texture[r]>>24&255)/255*a,u=1-c,m=(this.framebuffer[h]>>0&255)*u+(s.texture[r]>>0&255)*c|0,f=(this.framebuffer[h]>>8&255)*u+(s.texture[r]>>8&255)*c|0,d=(this.framebuffer[h]>>16&255)*u+(s.texture[r]>>16&255)*c|0;this.framebuffer[h]=m|f<<8|d<<16|255<<24}}drawTextureRectFastAlpha(t,e,i,n,o,r,s){let a=i+n*s.width,l=t+e*this.width;for(let t=0;t<r;t++){for(let t=0;t<o;t++){const t=s.texture[a];4278190080&t&&(this.framebuffer[l]=t),a++,l++}a+=s.width-o,l+=this.width-o}}drawTextureColorized(t,e,i,n){let o=t+e*this.width,r=0;for(let t=0;t<i.height;t++){for(let t=0;t<i.width;t++){const t=i.texture[r],e=(t>>0&255)*n.r/255,s=(t>>8&255)*n.g/255,a=(t>>16&255)*n.b/255;this.framebuffer[o]=e|s<<8|a<<16|255<<24,r++,o++}o+=this.width-i.width}}drawTextureRectNoAlpha(t,e,i,n,o,r,s){let a=i+n*s.width,l=t+e*this.width;for(let t=0;t<r;t++){for(let t=0;t<o;t++)this.framebuffer[l]=s.texture[a],a++,l++;a+=s.width-o,l+=this.width-o}}static blend(t,e,i){if(0===i)return t;if(255===i)return e;const n=255-i;return 4278190080|((16711680&e)>>16)*i+((16711680&t)>>16)*n>>8<<16|((65280&e)>>8)*i+((65280&t)>>8)*n>>8<<8|(255&e)*i+(255&t)*n>>8}static addColor(t,e){const i=t>>16&255,n=t>>8&255,o=255&t,r=e>>16&255,s=e>>8&255,a=255&e;return 255<<24|(i+r<255?i+r:255)<<16|(n+s<255?n+s:255)<<8|(o+a<255?o+a:255)}drawTextureRect(t,e,i,n,o,r,s,a,l){let h=i+n*a,c=t+e*this.width;for(let t=0;t<r;t++){for(let t=0;t<o;t++){const t=(s[h]>>24&255)/255*l,e=1-t,i=this.framebuffer[c],n=s[h],o=(i>>0&255)*e+(n>>0&255)*t,r=(i>>8&255)*e+(n>>8&255)*t,a=(i>>16&255)*e+(n>>16&255)*t;this.framebuffer[c]=o|r<<8|a<<16|255<<24,h++,c++}h+=a-o,c+=this.width-o}}drawTextureRectAdd(t,e,i,n,o,r,s,a){let l=i+n*s.width,h=t+e*this.width;for(let t=0;t<r;t++){for(let t=0;t<o;t++){const t=(s.texture[l]>>24&255)/255*a,e=this.framebuffer[h],i=s.texture[l],n=Math.min(255,(e>>0&255)+(i>>0&255)*t),o=Math.min(255,(e>>8&255)+(i>>8&255)*t),r=Math.min(255,(e>>16&255)+(i>>16&255)*t);this.framebuffer[h]=n|o<<8|r<<16|255<<24,l++,h++}l+=s.width-o,h+=this.width-o}}pixelate(){const t=200,e=50;for(let i=0;i<10;i++)for(let n=0;n<10;n++)this.drawBox2(10*i+t,10*n+e,10,10,this.readPixel(10*i+t,10*n+e));this.drawLineDDA(new s(t,e,-.3),new s(300,e,-.3),4294967295),this.drawLineDDA(new s(t,150,-.3),new s(300,150,-.3),4294967295),this.drawLineDDA(new s(t,e,-.3),new s(t,150,-.3),4294967295),this.drawLineDDA(new s(300,e,-.3),new s(300,150,-.3),4294967295)}fastFramebufferCopyOffset(t,e,i=0){let n=this.width*this.height/32+1,o=this.width*this.height,r=this.width*(this.height-i);for(;--n;)t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r],t[--o]=e[--r]}fastFramebufferCopy(t,e){t.set(e)}noise(t,e,i=.07){const n=new m;n.setSeed(t);for(let t=0;t<this.height;t++)this.drawTextureRect(0,t,Math.floor(n.getFloat()*(e.texture.length-this.width)),0,this.width,1,e.texture,e.width,i)}drawTexturedBillboard(t,e,i,n,o,r){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.height,0),c=0):(c=e,l=n-Math.max(e+n-this.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){if(this.wBuffer[p]>r){this.wBuffer[p]=r;const t=Math.min(0|f,o.width-1)+Math.min(0|d,o.height-1)*o.width,e=(this.framebuffer[p]>>0&255)+(o.texture[t]>>0&255),i=(this.framebuffer[p]>>8&255)+(o.texture[t]>>8&255),n=(this.framebuffer[p]>>16&255)+(o.texture[t]>>16&255);this.framebuffer[p]=e|i<<8|n<<16|255<<24}f+=a,p++}d+=a,f=m,p+=-h+this.width}}drawParticle(t,e,i,n,o,r,s){const a=o.width/i,l=o.height/n;let h,c,u,m,f,d=0,p=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=l*-e,h=n+e-Math.max(e+n-this.height,0),u=0):(u=e,h=n-Math.max(e+n-this.height,0)),t<0?(f=d=a*-t,c=i+t-Math.max(t+i-this.width,0),m=0):(f=0,m=t,c=i-Math.max(t+i-this.width,0));const x=1/255*s;let y=m+u*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){if(this.wBuffer[y]>r){const t=Math.min(0|d,o.width-1)+Math.min(0|p,o.height-1)*o.width,e=(o.texture[t]>>24&255)*x,i=1-e,n=this.framebuffer[y],r=o.texture[t],s=(n>>0&255)*i+(r>>0&255)*e,a=(n>>8&255)*i+(r>>8&255)*e,l=(n>>16&255)*i+(r>>16&255)*e;this.framebuffer[y]=s|a<<8|l<<16|255<<24}d+=a,y++}p+=l,d=f,y+=-c+this.width}}drawParticle2(t,e,i,n,o,r,s,a=0,l){const h=o.width/i,c=l/n;let u,m,f,d,p,x=0,y=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(y=c*-e,u=n+e-Math.max(e+n-this.height,0),f=0):(f=e,u=n-Math.max(e+n-this.height,0)),t<0?(p=x=h*-t,m=i+t-Math.max(t+i-this.width,0),d=0):(p=0,d=t,m=i-Math.max(t+i-this.width,0));const g=1/255*s;let v=d+f*this.width;for(let t=0;t<u;t++){for(let t=0;t<m;t++){if(this.wBuffer[v]>r){const t=Math.min(0|x,o.width-1)+Math.min(0|y,l-1)*o.width+l*o.width*a,e=(o.texture[t]>>24&255)*g,i=1-e,n=this.framebuffer[v],r=o.texture[t],s=(n>>0&255)*i+(r>>0&255)*e,h=(n>>8&255)*i+(r>>8&255)*e,c=(n>>16&255)*i+(r>>16&255)*e;this.framebuffer[v]=s|h<<8|c<<16|255<<24}x+=h,v++}y+=c,x=p,v+=-m+this.width}}drawParticle2Sub(t,e,i,n,o,r,s,a=0,l,h=1,c=1,u=1){const m=o.width/i,f=l/n;let d,p,x,y,g,v=0,b=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(b=f*-e,d=n+e-Math.max(e+n-this.height,0),x=0):(x=e,d=n-Math.max(e+n-(this.height-1),0)),t<0?(g=v=m*-t,p=Math.ceil(i+t-Math.max(t+i-this.width,0)),y=0):(g=0,y=t,p=Math.ceil(i-Math.max(t+i-(this.width-1),0))),g+=(Math.ceil(t)-t)*m,b+=(Math.ceil(e)-e)*f;const w=1/255*s;let M=Math.ceil(y)+Math.ceil(x)*this.width;for(let t=0;t<d;t++){for(let t=0;t<p;t++){if(this.wBuffer[M]>r){const t=Math.min(0|Math.round(v),o.width-1)+Math.min(0|Math.round(b),l-1)*o.width+l*o.width*a,e=(o.texture[t]>>24&255)*w,i=1-e,n=this.framebuffer[M],r=o.texture[t],s=(n>>0&255)*i+(r>>0&255)*e*h,m=(n>>8&255)*i+(r>>8&255)*e*c,f=(n>>16&255)*i+(r>>16&255)*e*u;this.framebuffer[M]=s|m<<8|f<<16|255<<24}v+=m,M++}b+=f,v=g,M+=-p+this.width}}drawParticleNoDepth(t,e,i,n,o,r){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.height,0),c=0):(c=e,l=n-Math.max(e+n-this.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.width,0));const p=1/255*r;let x=u+c*this.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=Math.min(0|f,o.width-1)+Math.min(0|d,o.height-1)*o.width,e=(o.texture[t]>>24&255)*p,i=1-e,n=this.framebuffer[x],r=o.texture[t],a=(n>>0&255)*i+(r>>0&255)*e,l=(n>>8&255)*i+(r>>8&255)*e,h=(n>>16&255)*i+(r>>16&255)*e;this.framebuffer[x]=a|l<<8|h<<16|255<<24,f+=s,x++}d+=a,f=m,x+=-h+this.width}}drawSoftParticle(t,e,i,n,o,r,s){const a=o.width/i,l=o.height/n;let h,c,u,m,f,d=0,p=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(p=l*-e,h=n+e-Math.max(e+n-this.height,0),u=0):(u=e,h=n-Math.max(e+n-this.height,0)),t<0?(f=d=a*-t,c=i+t-Math.max(t+i-this.width,0),m=0):(f=0,m=t,c=i-Math.max(t+i-this.width,0));const x=1/255*s;let y=m+u*this.width;for(let t=0;t<h;t++){for(let t=0;t<c;t++){if(this.wBuffer[y]>r){const t=Math.min(Math.max(1/r-1/this.wBuffer[y],0),1),e=Math.min(0|d,o.width-1)+Math.min(0|p,o.height-1)*o.width,i=(o.texture[e]>>24&255)*x*t,n=1-i,s=(this.framebuffer[y]>>0&255)*n+(o.texture[e]>>0&255)*i,a=(this.framebuffer[y]>>8&255)*n+(o.texture[e]>>8&255)*i,l=(this.framebuffer[y]>>16&255)*n+(o.texture[e]>>16&255)*i;this.framebuffer[y]=s|a<<8|l<<16|255<<24}d+=a,y++}p+=l,d=f,y+=-c+this.width}}drawFog(t,e,i){const n=this.width*this.height,o=-e;for(let e=0;e<n;e++){const n=Math.max(Math.min(o*(1/this.wBuffer[e]+i),1),0),r=1-n,s=(this.framebuffer[e]>>0&255)*r+t.r*n,a=(this.framebuffer[e]>>8&255)*r+t.g*n,l=(this.framebuffer[e]>>16&255)*r+t.b*n;this.framebuffer[e]=s|a<<8|l<<16|255<<24}}drawScaledTextureClipBi(t,e,i,n,o,r){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.height,0),c=0):(c=e,l=n-Math.max(e+n-this.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.width,0));const p=1/255*r;let x=u+c*this.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=o.getBilinearFilteredPixel2(f,d),e=255*p,i=1-e,n=this.framebuffer[x],r=(n>>0&255)*i+(t>>0&255)*e,a=(n>>8&255)*i+(t>>8&255)*e,l=(n>>16&255)*i+(t>>16&255)*e;this.framebuffer[x]=r|a<<8|l<<16|255<<24,f+=s,x++}d+=a,f=m,x+=-h+this.width}}drawScaledTextureClipBiAdd(t,e,i,n,o,r){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.height,0),c=0):(c=e,l=n-Math.max(e+n-this.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=o.getBilinearFilteredPixel2(f,d),e=this.framebuffer[p],i=t,n=Math.min((e>>0&255)+(i>>0&255)*r,255),a=Math.min((e>>8&255)+(i>>8&255)*r,255),l=Math.min((e>>16&255)+(i>>16&255)*r,255);this.framebuffer[p]=n|a<<8|l<<16|255<<24,f+=s,p++}d+=a,f=m,p+=-h+this.width}}drawScaledTextureClipAdd(t,e,i,n,o,r=1){const s=o.width/i,a=o.height/n;let l,h,c,u,m,f=0,d=0;if(e+n<0||e>this.height-1||t+i<0||t>this.width-1)return;e<0?(d=a*-e,l=n+e-Math.max(e+n-this.height,0),c=0):(c=e,l=n-Math.max(e+n-this.height,0)),t<0?(m=f=s*-t,h=i+t-Math.max(t+i-this.width,0),u=0):(m=0,u=t,h=i-Math.max(t+i-this.width,0));let p=u+c*this.width;for(let t=0;t<l;t++){for(let t=0;t<h;t++){const t=Math.min(0|f,o.width-1)+Math.min(0|d,o.height-1)*o.width,e=this.framebuffer[p],i=o.texture[t],n=Math.min((e>>0&255)+(i>>0&255)*r,255),a=Math.min((e>>8&255)+(i>>8&255)*r,255),l=Math.min((e>>16&255)+(i>>16&255)*r,255);this.framebuffer[p]=n|a<<8|l<<16|255<<24,f+=s,p++}d+=a,f=m,p+=-h+this.width}}drawTexture(t,e,i,n){const o=this.width,r=this.height;let s=Math.max(t,0)+Math.max(e,0)*this.width,a=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const l=Math.min(i.width,o-t)-Math.max(0,0-t),h=Math.min(i.height,r-e)-Math.max(0,0-e),c=i.width-l,u=this.width-l,m=1/255*n;for(let t=0;t<h;t++){for(let t=0;t<l;t++){const t=(i.texture[a]>>24&255)*m,e=1-t,n=(this.framebuffer[s]>>0&255)*e+(i.texture[a]>>0&255)*t,o=(this.framebuffer[s]>>8&255)*e+(i.texture[a]>>8&255)*t,r=(this.framebuffer[s]>>16&255)*e+(i.texture[a]>>16&255)*t;this.framebuffer[s]=n|o<<8|r<<16|255<<24,s++,a++}a+=c,s+=u}}drawTextureFullscreen(t,e){let i=0;const n=1-e;for(let o=0;o<this.width*this.height;o++){const o=(this.framebuffer[i]>>0&255)*n+(t.texture[i]>>0&255)*e,r=(this.framebuffer[i]>>8&255)*n+(t.texture[i]>>8&255)*e,s=(this.framebuffer[i]>>16&255)*n+(t.texture[i]>>16&255)*e;this.framebuffer[i]=o|r<<8|s<<16|255<<24,i++}}drawTexture3(t,e,i,n,o){const r=this.width,s=this.height;let a=Math.max(t,0)+Math.max(e,0)*this.width,l=Math.max(0,0-t)+Math.max(0,0-e)*i.width;const h=Math.min(i.width,r-t)-Math.max(0,0-t),c=Math.min(i.height,s-e)-Math.max(0,0-e),u=i.width-h,m=this.width-h,f=1/255*n,d=Math.floor(c*Math.max(Math.min(1,o),0));for(let t=0;t<d;t++){for(let t=0;t<h;t++){const t=(i.texture[l]>>24&255)*f,e=1-t,n=(this.framebuffer[a]>>0&255)*e+(i.texture[l]>>0&255)*t,o=(this.framebuffer[a]>>8&255)*e+(i.texture[l]>>8&255)*t,r=(this.framebuffer[a]>>16&255)*e+(i.texture[l]>>16&255)*t;this.framebuffer[a]=n|o<<8|r<<16|255<<24,a++,l++}l+=u,a+=m}}drawTextureNoClipAlpha(t,e,i){let n=t+e*this.width,o=0;const r=this.width-i.width;for(let t=0;t<i.height;t++){for(let t=0;t<i.width;t++){const t=i.texture[o];4278190080&t&&(this.framebuffer[n]=t),n++,o++}n+=r}}nearPlaneClipping(t,e,i){const n=-1.7;if(t.z<n&&e.z<n)this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(e),i);else{if(t.z>n&&e.z>n)return;if(t.z<n){const o=(n-t.z)/(e.z-t.z),r=new s(o*(e.x-t.x)+t.x,o*(e.y-t.y)+t.y,n);this.linerClipper.cohenSutherlandLineClipper(this.project(t),this.project(r),i)}else if(e.z<n){const o=(n-e.z)/(t.z-e.z),r=new s(o*(t.x-e.x)+e.x,o*(t.y-e.y)+e.y,n);this.linerClipper.cohenSutherlandLineClipper(this.project(e),this.project(r),i)}}}project(t){return new s(Math.round(this.width/2+292*t.x/-t.z),Math.round(this.height/2-292*t.y/-t.z),t.z)}clearDepthBuffer(){this.wBuffer.fill(-1/900)}drawBox(){const t=this.maxWindow.y-this.minWindow.y+1,e=this.maxWindow.x-this.minWindow.x+1;let i=this.minWindow.y*this.width+this.minWindow.x;for(let n=0;n<t;n++)this.framebuffer.fill(-13158601,i,i+e),i+=this.width}drawBox2(t,e,i,n,o){let r=e*this.width+t;for(let t=0;t<n;t++)this.framebuffer.fill(o,r,r+i),r+=this.width}wireFrameSphereClipping(t){this.wBuffer.fill(100);const e=[],i=16;for(let t=0;t<=16;t++)for(let n=0;n<i;n++)e.push(this.sphereFunction2(-t*Math.PI/16-Math.PI/2,2*-n*Math.PI/i));const n=[];for(let t=0;t<16;t++)for(let e=0;e<i;e++)n.push(i*t+(1+e)%i),n.push(i*t+(0+e)%i),n.push(i*t+i+(1+e)%i),n.push(i*t+i+(0+e)%i),n.push(i*t+i+(1+e)%i),n.push(i*t+(0+e)%i);const o=10.8+5*(Math.sin(.16*t)+1)/2;let r=h.constructScaleMatrix(o,o,o).multiplyMatrix(h.constructYRotationMatrix(.08*t));r=r.multiplyMatrix(h.constructXRotationMatrix(.08*t)),r=h.constructTranslationMatrix(0+20*Math.sin(.04*t),5*Math.sin(.06*t),-22).multiplyMatrix(r);const a=new Array;for(let t=0;t<e.length;t++){const i=r.multiplyHom(e[t]),n=i.x,o=i.y,l=i.z,h=.5*this.width+n/(.0078*-l),c=.5*this.height+o/(.0078*-l);a.push(new s(h,c,l))}const l=-1703936|this.height<<16|this.height;this.drawLineDDA(new s(this.minWindow.x-1,this.minWindow.y-1,0),new s(this.minWindow.x-1,this.maxWindow.y+1,0),l),this.drawLineDDA(new s(this.maxWindow.x+1,this.minWindow.y-1,0),new s(this.maxWindow.x+1,this.maxWindow.y+1,0),l),this.drawLineDDA(new s(this.minWindow.x-1,this.minWindow.y-1,0),new s(this.maxWindow.x+1,this.minWindow.y-1,0),l),this.drawLineDDA(new s(this.minWindow.x-1,this.maxWindow.y+1,0),new s(this.maxWindow.x+2,this.maxWindow.y+1,0),l),this.drawBox();for(let t=0;t<n.length;t+=3){const e=a[n[t]],i=a[n[t+1]],o=a[n[t+2]],r=-1;this.isTriangleCCW(e,i,o)&&(this.linerClipper.cohenSutherlandLineClipper(e,i,r),this.linerClipper.cohenSutherlandLineClipper(e,o,r),this.linerClipper.cohenSutherlandLineClipper(o,i,r))}}isTriangleCCW(t,e,i){const o=t.x*e.y-e.x*t.y+e.x*i.y-i.x*e.y+i.x*t.y-t.x*i.y;return this.cullMode===n.BACK?o<0:o>0}wireFrameTerrain(t,e){this.clearDepthBuffer();const i=[],n=[];for(let t=0;t<256;t++)for(let i=0;i<256;i++)n.push(new s(20*(i-128),128*(255&e.texture[i+256*t])/256-70,20*(t-128)));for(let t=0;t<256;t+=1)for(let e=0;e<255;e+=1)i.push(0+e+256*t),i.push(1+e+256*t);for(let t=0;t<256;t+=1)for(let e=0;e<255;e+=1)i.push(t+256*(e+0)),i.push(t+256*(e+1));const o=c.constructYRotationMatrix(.003*t),r=new Array,a=128*+Math.cos(1e-6*t)*20,l=128*Math.sin(1e-6*t)*20;n.forEach((t=>{const e=o.multiply(t),i=e.x+a,n=e.y,h=e.z+l;r.push(new s(i,n,h))}));for(let t=0;t<i.length;t+=2){const e=1-Math.min(255,.9*-r[i[t]].z)/255,n=255*e<<8|100*e|this.height*e<<16|255<<24;this.nearPlaneClipping(r[i[t]],r[i[t+1]],n)}}drawBoundingSphere(t,e,i){const n=[];for(let e=0;e<=8;e++)for(let i=0;i<8;i++){const o=this.sphereFunction2(-e*Math.PI/8-Math.PI/2,2*-i*Math.PI/8).mul(t.getRadius()+.01).add(t.getCenter());o.w=1,n.push(o)}const o=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)o.push(8*t+(1+e)%8),o.push(8*t+(0+e)%8),o.push(8*t+8+(1+e)%8),o.push(8*t+8+(0+e)%8),o.push(8*t+8+(1+e)%8),o.push(8*t+(0+e)%8);const r=e,a=new Array;for(let t=0;t<n.length;t++){const e=r.multiplyHom(n[t]);a.push(new s(e.x,e.y,e.z))}for(let t=0;t<o.length;t+=3){const e=a[o[t]],n=a[o[t+1]],r=a[o[t+2]];this.nearPlaneClipping(e,n,i),this.nearPlaneClipping(e,r,i),this.nearPlaneClipping(r,n,i)}}drawPlanedeformationTunnelAnim(t,e){let i=0;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++){const r=o-this.width/2,s=n-this.height/2,a=51.2/Math.max(1,Math.sqrt(r*r+s*s)),l=a+.002*t,h=16*(Math.atan2(r,s)/Math.PI+1)+69e-5*t,c=e.texture[(31&l)+32*(31&h)],m=1-u.cosineInterpolate(1,6,a),f=(c>>0&255)*m|(c>>8&255)*m<<8|(c>>16&255)*m<<16;this.framebuffer[i++]=f}}drawPlaneDeformation(t,e){const i=e.width,n=e.height;let o=0;for(let r=0;r<this.height;r++){const s=2*r/this.height-1;for(let r=0;r<this.width;r++){const a=(2*r/this.width-1)/Math.abs(s)*i*.05|0,l=1/Math.abs(s)*n*.05+.008*t|0,h=1-Math.max(Math.min(1/Math.abs(s)*.2,1),0);let c=e.texture[(255&a)+(255&l)*i];c=255<<24|(c>>16&255)*h<<16|(c>>8&255)*h<<8|(c>>0&255)*h<<0,this.framebuffer[o++]=c}}}torusFunction(t){return new s(10*Math.sin(t),0,10*Math.cos(t))}fakeSphere(t,e){e.textureCoordinate.u=.5+Math.asin(t.x)/Math.PI,e.textureCoordinate.v=.5-Math.asin(t.y)/Math.PI}fakeSphere2(t,e){e.u=.5+Math.asin(t.x)/Math.PI,e.v=.5-Math.asin(t.y)/Math.PI}drawLineDDA(t,e,i){this.lineRasterizer.drawLineDDA(t,e,i)}drawLineDDANoZ(t,e,i){this.lineRasterizerNo.drawLineDDANoZ(t,e,i)}sphereFunction2(t,e){return new o(Math.cos(t)*Math.cos(e),Math.cos(t)*Math.sin(e),Math.sin(t),1)}}class R{static toggleFullscreen(t){this.fullscreen?(R.exitFullscreen(),this.fullscreen=!1,this.setStyle(t,"cursor: zoom-in")):(R.enterFullscreen(t),this.fullscreen=!0,this.setStyle(t,"cursor: none"))}static setStyle(t,e){t.setAttribute("style",t.getAttribute("style")+";"+e)}static enterFullscreen(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}static exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}static fullscreen=!1}class T{scene;framebuffer;canvas;context;startTime;boundRenderLoop;constructor(t,e,i){this.scene=i,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.id="aisa-canvas",this.canvas.style.cssText="image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -o-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;",this.canvas.style.width=2*t+"px",this.canvas.style.height=2*e+"px",this.context=this.canvas.getContext("2d"),this.context.oImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.framebuffer=new _(t,e),this.boundRenderLoop=this.renderLoop.bind(this)}init(){this.appendTo(document.getElementById("aisa")),this.canvas.addEventListener("click",(t=>{t.preventDefault(),R.toggleFullscreen(this.canvas)})),this.scene.init(this.framebuffer).then((()=>{this.scene.onInit(),this.startTime=Date.now(),this.renderLoop()}))}renderLoop(){this.scene.render(this.framebuffer,Date.now()-this.startTime),this.flipBackbuffer(),requestAnimationFrame(this.boundRenderLoop)}flipBackbuffer(){this.context.putImageData(this.framebuffer.getImageData(),0,0)}appendTo(t){t.appendChild(this.canvas)}}var E=i(9842);class D{init(t){return Promise.all([])}onInit(){}}class k{static generateProceduralNoise(){return new Promise((t=>{const e=new I;e.texture=new Uint32Array(65536);const i=new m;i.setSeed(100);for(let t=0;t<65536;t++){const n=i.getFloat();e.texture[t]=200*n|255*n<<8|205*n<<16|255<<24}e.width=256,e.height=256,t(e)}))}static generateProceduralParticleTexture(){return new Promise((t=>{const e=new I;e.texture=new Uint32Array(65536),(new m).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const n=127-i,o=127-t,r=Math.sqrt(n*n+o*o)/127;let s=1-r;s*=s*s,r>1&&(s=0),s=Math.min(1,2.9*s),e.texture[i+256*t]=15466475|255*s<<24}e.width=256,e.height=256,t(e)}))}static generateProceduralParticleTexture2(){return new Promise((t=>{const e=new I;e.texture=new Uint32Array(65536),(new m).setSeed(100);for(let t=0;t<256;t++)for(let i=0;i<256;i++){const n=127-i,o=127-t,r=Math.sqrt(n*n+o*o)/127;let s=1-r;s*=s,r>1&&(s=0),s=Math.min(1,40*s),e.texture[i+256*t]=16764415|255*s<<24}e.width=256,e.height=256,t(e)}))}static load(t,e){return new Promise((i=>{const n=new Image;n.onload=()=>{const t=new I;t.texture=this.getImageData(n,e),t.width=n.width,t.height=n.height,i(t)},n.onerror=()=>i(),n.src=t}))}static getImageData(t,e=!1){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");n.drawImage(t,0,0);const o=n.getImageData(0,0,t.width,t.height).data,r=new Uint32Array(o.length/4);let s=0;for(let t=0;t<o.length;t+=4)r[s]=e?o[t+3]<<24|o[t+2]<<16|o[t+1]<<8|o[t+0]:255<<24|o[t+2]<<16|o[t+1]<<8|o[t+0],s++;return r}}class F{framebuffer;clipRegion;constructor(t){this.framebuffer=t,this.clipRegion=new Array(new A(t),new P(t),new S(t),new B(t))}clipConvexPolygon(t){let e=t;for(let t=0;t<this.clipRegion.length;t++){const i=this.clipRegion[t],n=e;e=new Array;let o=n[n.length-1];for(let t=0;t<n.length;t++){const r=n[t];i.isInside(r)?(i.isInside(o)||e.push(i.computeIntersection(o,r)),e.push(r)):i.isInside(o)&&e.push(i.computeIntersection(o,r)),o=r}}return e}}class L extends D{engine;lastTime=void 0;rasterizer;texture;texturingRenderingPipeline;clipper;init(t){this.texturingRenderingPipeline=new j(t),this.clipper=new F(t),this.engine=E.Engine.create();var e=E.Bodies.rectangle(400,-1700,90,90,{angle:Math.random()*Math.PI,velocity:{x:1,y:.2}}),n=E.Bodies.rectangle(450,-850,80,120,{angle:2*Math.random()*Math.PI}),o=E.Bodies.rectangle(365,-1070,200,200,{angle:Math.random()*Math.PI}),r=E.Bodies.rectangle(498,-1090,83,110,{angle:2*Math.random()*Math.PI}),s=E.Bodies.rectangle(400,610,810,60,{isStatic:!0});return E.Composite.add(this.engine.world,[e,n,o,r,s]),setInterval((()=>{let t=E.Bodies.rectangle(400,-850,80,80,{angle:2*Math.random()*Math.PI});E.Body.applyForce(t,t.position,{x:.1*Math.sin(Math.random()*Math.PI*2),y:.3}),E.Composite.add(this.engine.world,[t])}),400),Promise.all([k.load(i(1285),!0).then((t=>this.texture=t))])}render(t,i){const n=this.getDeltaTime(i);E.Engine.update(this.engine,1*n),t.clearColorBuffer(e.DARK_GRAY.toPackedFormat());const r=E.Composite.allBodies(this.engine.world);console.log(r.length);for(let e=0;e<r.length;e++){if(r[e].position.x<-80||r[e].position.x>750||r[e].position.y>700){E.Composite.remove(this.engine.world,[r[e]]);continue}const i=r[e].vertices;for(let e=0;e<i.length;e++){t.clearDepthBuffer();const e=new w;e.projection=this.toInteger(new o(i[0].x,i[0].y,-10).mul(.4).add(new o(30,-31,0,0))),e.textureCoordinate=new b(0,0);const n=new w;n.projection=this.toInteger(new o(i[1].x,i[1].y,-10).mul(.4).add(new o(30,-31,0,0))),n.textureCoordinate=new b(1,0);const r=new w;t.setTexture(this.texture),r.projection=this.toInteger(new o(i[2].x,i[2].y,-10).mul(.4).add(new o(30,-31,0,0))),r.textureCoordinate=new b(1,1),this.clipConvexPolygon(t,[e,n,r]),e.projection=this.toInteger(new o(i[2].x,i[2].y,-10).mul(.4).add(new o(30,-31,0,0))),e.textureCoordinate=new b(1,1),n.projection=this.toInteger(new o(i[3].x,i[3].y,-10).mul(.4).add(new o(30,-31,0,0))),n.textureCoordinate=new b(0,1),r.projection=this.toInteger(new o(i[0].x,i[0].y,-10).mul(.4).add(new o(30,-31,0,0))),r.textureCoordinate=new b(0,0),this.clipConvexPolygon(t,[e,n,r])}}}clipConvexPolygon(t,e){let i=e;for(let e=0;e<t.clipRegion.length;e++){const n=t.clipRegion[e],o=i;i=new Array;let r=o[o.length-1];for(let t=0;t<o.length;t++){const e=o[t];n.isInside2(e)?(n.isInside2(r)||i.push(n.computeIntersection2(r,e)),i.push(e)):n.isInside2(r)&&i.push(n.computeIntersection2(r,e)),r=e}}if(!(i.length<3))for(let e=0;e<i.length-2;e++)this.texturingRenderingPipeline.triangleRasterizer.drawTriangleDDA(t,i[0],i[1+e],i[2+e])}triangulateConvexPolygon(t,e){for(let i=0;i<e.length-2;i++)this.texturingRenderingPipeline.triangleRasterizer.drawTriangleDDA(t,e[0],e[1+i],e[2+i])}toInteger(t){return new o(0|t.x,0|t.y,0|t.z)}getDeltaTime(t){this.lastTime||(this.lastTime=t);const e=t-this.lastTime;return this.lastTime=t,e}}var O=i(3379),W=i.n(O),N=i(7795),V=i.n(N),H=i(569),q=i.n(H),G=i(3565),U=i.n(G),Z=i(9216),Y=i.n(Z),X=i(4589),K=i.n(X),Q=i(4035),$={};$.styleTagTransform=K(),$.setAttributes=U(),$.insert=q().bind(null,"head"),$.domAPI=V(),$.insertStyleElement=Y(),W()(Q.Z,$),Q.Z&&Q.Z.locals&&Q.Z.locals,class{static main(){new T(320,200,new L).init()}}.main()})()})();
//# sourceMappingURL=matterjs.js.map